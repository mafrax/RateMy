"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/ratings/flush";
exports.ids = ["pages/api/ratings/flush"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("bcryptjs");

/***/ }),

/***/ "next-auth/next":
/*!*********************************!*\
  !*** external "next-auth/next" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("next-auth/next");

/***/ }),

/***/ "next-auth/providers/apple":
/*!********************************************!*\
  !*** external "next-auth/providers/apple" ***!
  \********************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/apple");

/***/ }),

/***/ "next-auth/providers/credentials":
/*!**************************************************!*\
  !*** external "next-auth/providers/credentials" ***!
  \**************************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/credentials");

/***/ }),

/***/ "next-auth/providers/facebook":
/*!***********************************************!*\
  !*** external "next-auth/providers/facebook" ***!
  \***********************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/facebook");

/***/ }),

/***/ "next-auth/providers/google":
/*!*********************************************!*\
  !*** external "next-auth/providers/google" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/google");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fratings%2Fflush&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fratings%2Fflush.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fratings%2Fflush&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fratings%2Fflush.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_ratings_flush_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/ratings/flush.ts */ \"(api)/./pages/api/ratings/flush.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ratings_flush_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_ratings_flush_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/ratings/flush\",\n        pathname: \"/api/ratings/flush\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_ratings_flush_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnJhdGluZ3MlMkZmbHVzaCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGcmF0aW5ncyUyRmZsdXNoLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3lEO0FBQ3pEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyx3REFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsd0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8/NDA0NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL3JhdGluZ3MvZmx1c2gudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9yYXRpbmdzL2ZsdXNoXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcmF0aW5ncy9mbHVzaFwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fratings%2Fflush&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fratings%2Fflush.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/ratings/flush.ts":
/*!************************************!*\
  !*** ./pages/api/ratings/flush.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _src_lib_api_handler__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/src/lib/api-handler */ \"(api)/./src/lib/api-handler.ts\");\n/* harmony import */ var _src_repositories_rating_repository__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/src/repositories/rating.repository */ \"(api)/./src/repositories/rating.repository.ts\");\n/* harmony import */ var _src_repositories_video_repository__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/src/repositories/video.repository */ \"(api)/./src/repositories/video.repository.ts\");\n/* harmony import */ var _src_repositories_tag_repository__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/src/repositories/tag.repository */ \"(api)/./src/repositories/tag.repository.ts\");\n/* harmony import */ var _src_services_rating_cache_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/src/services/rating-cache.service */ \"(api)/./src/services/rating-cache.service.ts\");\n/* harmony import */ var _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @/src/lib/logger */ \"(api)/./src/lib/logger.ts\");\n\n\n\n\n\n\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_src_lib_api_handler__WEBPACK_IMPORTED_MODULE_0__.createApiRoute)({\n    POST: (0,_src_lib_api_handler__WEBPACK_IMPORTED_MODULE_0__.requireAuth)(async (ctx)=>{\n        const { user } = ctx;\n        const body = ctx.req.body;\n        try {\n            // Parse the ratings data - could come from JSON body or sendBeacon\n            let ratingsData;\n            if (typeof body === \"string\") {\n                ratingsData = JSON.parse(body);\n            } else {\n                ratingsData = body;\n            }\n            if (!Array.isArray(ratingsData) || ratingsData.length === 0) {\n                return {\n                    success: false,\n                    message: \"No ratings provided or invalid format\"\n                };\n            }\n            _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.info(\"Processing bulk rating flush\", {\n                userId: user?.id,\n                ratingsCount: ratingsData.length\n            });\n            // Validate and prepare ratings data\n            const validRatings = [];\n            const errors = [];\n            // First pass: validate all ratings\n            for (const ratingData of ratingsData){\n                try {\n                    // Validate rating data\n                    if (!ratingData.videoId || !ratingData.tagId || typeof ratingData.rating !== \"number\") {\n                        throw new Error(\"Invalid rating data format\");\n                    }\n                    // Ensure rating is within valid range (1-5)\n                    const level = Math.max(1, Math.min(5, Math.round(ratingData.rating)));\n                    validRatings.push({\n                        videoId: ratingData.videoId,\n                        userId: user?.id || \"\",\n                        tagId: ratingData.tagId,\n                        level\n                    });\n                } catch (error) {\n                    _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.error(\"Error validating rating in bulk flush\", {\n                        userId: user?.id,\n                        ratingData,\n                        error: error instanceof Error ? error.message : \"Unknown error\"\n                    });\n                    errors.push({\n                        videoId: ratingData.videoId,\n                        tagId: ratingData.tagId,\n                        error: error instanceof Error ? error.message : \"Unknown error\"\n                    });\n                }\n            }\n            // Early return if no valid ratings\n            if (validRatings.length === 0) {\n                return {\n                    success: false,\n                    message: \"No valid ratings to process\",\n                    data: {\n                        processed: ratingsData.length,\n                        successful: 0,\n                        failed: errors.length,\n                        errors\n                    }\n                };\n            }\n            // Get unique video IDs and tag IDs for validation\n            const videoIds = Array.from(new Set(validRatings.map((r)=>r.videoId)));\n            const tagIds = Array.from(new Set(validRatings.map((r)=>r.tagId)));\n            _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.info(\"Validating IDs for bulk rating flush\", {\n                userId: user?.id,\n                videoIds: videoIds.length,\n                tagIds: tagIds.length,\n                videoIdList: videoIds.slice(0, 5),\n                tagIdList: tagIds.slice(0, 5) // Log first 5 for debugging\n            });\n            // Validate videos and tags exist (batch validation)\n            const [existingVideos, existingTags] = await Promise.all([\n                Promise.all(videoIds.map((id)=>_src_repositories_video_repository__WEBPACK_IMPORTED_MODULE_2__.videoRepository.findById(id))),\n                Promise.all(tagIds.map((id)=>_src_repositories_tag_repository__WEBPACK_IMPORTED_MODULE_3__.tagRepository.findById(id)))\n            ]);\n            const validVideoIds = new Set(existingVideos.filter((v)=>v).map((v)=>v.id));\n            const validTagIds = new Set(existingTags.filter((t)=>t).map((t)=>t.id));\n            _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.info(\"ID validation results\", {\n                userId: user?.id,\n                validVideoIds: Array.from(validVideoIds).slice(0, 5),\n                validTagIds: Array.from(validTagIds).slice(0, 5),\n                invalidVideoIds: videoIds.filter((id)=>!validVideoIds.has(id)),\n                invalidTagIds: tagIds.filter((id)=>!validTagIds.has(id))\n            });\n            // Filter ratings to only include valid ones\n            const finalValidRatings = validRatings.filter((rating)=>validVideoIds.has(rating.videoId) && validTagIds.has(rating.tagId));\n            // Track invalid ratings\n            const invalidRatings = validRatings.filter((rating)=>!validVideoIds.has(rating.videoId) || !validTagIds.has(rating.tagId));\n            invalidRatings.forEach((rating)=>{\n                const reason = !validVideoIds.has(rating.videoId) ? `Video not found: ${rating.videoId}` : `Tag not found: ${rating.tagId}`;\n                errors.push({\n                    videoId: rating.videoId,\n                    tagId: rating.tagId,\n                    error: reason\n                });\n            });\n            let results = [];\n            // Perform bulk upsert if we have valid ratings\n            if (finalValidRatings.length > 0) {\n                try {\n                    const upsertedRatings = await _src_repositories_rating_repository__WEBPACK_IMPORTED_MODULE_1__.ratingRepository.bulkUpsertRatings(finalValidRatings);\n                    // Use actual database results instead of creating fake success responses\n                    results = upsertedRatings.map((rating)=>({\n                            videoId: rating.videoId,\n                            tagId: rating.tag.id,\n                            level: rating.level,\n                            success: true\n                        }));\n                    // Check for partial failures - ratings that were expected but not returned\n                    const upsertedIds = new Set(upsertedRatings.map((r)=>`${r.videoId}:${r.tag.id}`));\n                    finalValidRatings.forEach((expected)=>{\n                        const expectedId = `${expected.videoId}:${expected.tagId}`;\n                        if (!upsertedIds.has(expectedId)) {\n                            errors.push({\n                                videoId: expected.videoId,\n                                tagId: expected.tagId,\n                                error: \"Database upsert failed - no result returned\"\n                            });\n                        }\n                    });\n                    // Invalidate cache for affected videos and user\n                    const uniqueVideoIds = Array.from(new Set(finalValidRatings.map((r)=>r.videoId)));\n                    uniqueVideoIds.forEach((videoId)=>{\n                        _src_services_rating_cache_service__WEBPACK_IMPORTED_MODULE_4__.ratingCacheService.invalidateVideoCache(videoId);\n                    });\n                    _src_services_rating_cache_service__WEBPACK_IMPORTED_MODULE_4__.ratingCacheService.invalidateUserCache(user?.id || \"\");\n                    // Log bulk action\n                    (0,_src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logUserAction)(\"bulk_video_rated\", user?.id || \"\", {\n                        ratingsCount: finalValidRatings.length,\n                        videoIds: videoIds.length,\n                        cacheInvalidations: uniqueVideoIds.length + 1,\n                        bulkFlush: true\n                    });\n                } catch (bulkError) {\n                    _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.error(\"Error in bulk rating upsert during flush\", {\n                        userId: user?.id,\n                        ratingsCount: finalValidRatings.length,\n                        error: bulkError instanceof Error ? bulkError.message : \"Unknown error\"\n                    });\n                    // If bulk fails, add all as errors\n                    finalValidRatings.forEach((rating)=>{\n                        errors.push({\n                            videoId: rating.videoId,\n                            tagId: rating.tagId,\n                            error: \"Bulk upsert failed\"\n                        });\n                    });\n                }\n            }\n            _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.info(\"Bulk rating flush completed\", {\n                userId: user?.id,\n                successful: results.length,\n                failed: errors.length,\n                total: ratingsData.length\n            });\n            // Report success only if we processed some ratings successfully AND have no errors\n            const overallSuccess = results.length > 0 && errors.length === 0;\n            // If we have no successful results but have errors, it's a failure\n            const hasFailures = errors.length > 0;\n            const noSuccessfulResults = results.length === 0;\n            return {\n                success: overallSuccess,\n                data: {\n                    processed: ratingsData.length,\n                    successful: results.length,\n                    failed: errors.length,\n                    results,\n                    errors: errors.length > 0 ? errors : undefined\n                },\n                message: overallSuccess ? `Successfully processed ${results.length}/${ratingsData.length} ratings` : noSuccessfulResults && hasFailures ? `Failed to process all ratings: ${errors.map((e)=>e.error).join(\", \")}` : hasFailures ? `Partially failed: ${results.length} successful, ${errors.length} failed` : \"No ratings were processed\",\n                error: hasFailures && noSuccessfulResults ? `Invalid data: ${errors.slice(0, 3).map((e)=>`${e.videoId}:${e.tagId} - ${e.error}`).join(\"; \")}` : undefined\n            };\n        } catch (error) {\n            _src_lib_logger__WEBPACK_IMPORTED_MODULE_5__.logger.error(\"Error in bulk rating flush\", {\n                userId: user?.id,\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            });\n            return {\n                success: false,\n                message: \"Failed to process ratings\",\n                error: error instanceof Error ? error.message : \"Unknown error\"\n            };\n        }\n    })\n}, {\n    methods: [\n        \"POST\"\n    ],\n    requireAuth: true\n}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OEMsZUFBZUMsc0JBQ2xCLENBQUMsY0FBYyxFQUFFM0QsT0FBT3dCLEtBQUssQ0FBQyxHQUFHLEdBQUdKLEdBQUcsQ0FBQ3lDLENBQUFBLElBQUssQ0FBQyxFQUFFQSxFQUFFM0QsT0FBTyxDQUFDLENBQUMsRUFBRTJELEVBQUUxRCxLQUFLLENBQUMsR0FBRyxFQUFFMEQsRUFBRWpELEtBQUssQ0FBQyxDQUFDLEVBQUVrRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQ2pHRjtZQUNOO1FBRUYsRUFBRSxPQUFPaEQsT0FBTztZQUNkaEMsbURBQU1BLENBQUNnQyxLQUFLLENBQUMsOEJBQThCO2dCQUN6Q2hCLFFBQVFaLE1BQU1hO2dCQUNkZSxPQUFPQSxpQkFBaUJQLFFBQVFPLE1BQU1sQixPQUFPLEdBQUc7WUFDbEQ7WUFFQSxPQUFPO2dCQUNMRCxTQUFTO2dCQUNUQyxTQUFTO2dCQUNUa0IsT0FBT0EsaUJBQWlCUCxRQUFRTyxNQUFNbEIsT0FBTyxHQUFHO1lBQ2xEO1FBQ0Y7SUFDRjtBQUNGLEdBQUc7SUFDRHFFLFNBQVM7UUFBQztLQUFPO0lBQ2pCeEYsYUFBYTtBQUNmLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vcGFnZXMvYXBpL3JhdGluZ3MvZmx1c2gudHM/Y2FlMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVBcGlSb3V0ZSwgcmVxdWlyZUF1dGggfSBmcm9tICdAL3NyYy9saWIvYXBpLWhhbmRsZXInXG5pbXBvcnQgeyByYXRpbmdSZXBvc2l0b3J5IH0gZnJvbSAnQC9zcmMvcmVwb3NpdG9yaWVzL3JhdGluZy5yZXBvc2l0b3J5J1xuaW1wb3J0IHsgdmlkZW9SZXBvc2l0b3J5IH0gZnJvbSAnQC9zcmMvcmVwb3NpdG9yaWVzL3ZpZGVvLnJlcG9zaXRvcnknXG5pbXBvcnQgeyB0YWdSZXBvc2l0b3J5IH0gZnJvbSAnQC9zcmMvcmVwb3NpdG9yaWVzL3RhZy5yZXBvc2l0b3J5J1xuaW1wb3J0IHsgcmF0aW5nQ2FjaGVTZXJ2aWNlIH0gZnJvbSAnQC9zcmMvc2VydmljZXMvcmF0aW5nLWNhY2hlLnNlcnZpY2UnXG5pbXBvcnQgeyBsb2dnZXIsIGxvZ1VzZXJBY3Rpb24gfSBmcm9tICdAL3NyYy9saWIvbG9nZ2VyJ1xuXG5pbnRlcmZhY2UgUGVuZGluZ1JhdGluZyB7XG4gIHZpZGVvSWQ6IHN0cmluZ1xuICB0YWdJZDogc3RyaW5nXG4gIHJhdGluZzogbnVtYmVyXG4gIHRpbWVzdGFtcDogbnVtYmVyXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUFwaVJvdXRlKHtcbiAgUE9TVDogcmVxdWlyZUF1dGgoYXN5bmMgKGN0eCkgPT4ge1xuICAgIGNvbnN0IHsgdXNlciB9ID0gY3R4XG4gICAgY29uc3QgYm9keSA9IGN0eC5yZXEuYm9keVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFBhcnNlIHRoZSByYXRpbmdzIGRhdGEgLSBjb3VsZCBjb21lIGZyb20gSlNPTiBib2R5IG9yIHNlbmRCZWFjb25cbiAgICAgIGxldCByYXRpbmdzRGF0YTogUGVuZGluZ1JhdGluZ1tdXG4gICAgICBcbiAgICAgIGlmICh0eXBlb2YgYm9keSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmF0aW5nc0RhdGEgPSBKU09OLnBhcnNlKGJvZHkpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByYXRpbmdzRGF0YSA9IGJvZHlcbiAgICAgIH1cblxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJhdGluZ3NEYXRhKSB8fCByYXRpbmdzRGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnTm8gcmF0aW5ncyBwcm92aWRlZCBvciBpbnZhbGlkIGZvcm1hdCdcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbygnUHJvY2Vzc2luZyBidWxrIHJhdGluZyBmbHVzaCcsIHsgXG4gICAgICAgIHVzZXJJZDogdXNlcj8uaWQsIFxuICAgICAgICByYXRpbmdzQ291bnQ6IHJhdGluZ3NEYXRhLmxlbmd0aCBcbiAgICAgIH0pXG5cbiAgICAgIC8vIFZhbGlkYXRlIGFuZCBwcmVwYXJlIHJhdGluZ3MgZGF0YVxuICAgICAgY29uc3QgdmFsaWRSYXRpbmdzID0gW11cbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdXG5cbiAgICAgIC8vIEZpcnN0IHBhc3M6IHZhbGlkYXRlIGFsbCByYXRpbmdzXG4gICAgICBmb3IgKGNvbnN0IHJhdGluZ0RhdGEgb2YgcmF0aW5nc0RhdGEpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBWYWxpZGF0ZSByYXRpbmcgZGF0YVxuICAgICAgICAgIGlmICghcmF0aW5nRGF0YS52aWRlb0lkIHx8ICFyYXRpbmdEYXRhLnRhZ0lkIHx8IHR5cGVvZiByYXRpbmdEYXRhLnJhdGluZyAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCByYXRpbmcgZGF0YSBmb3JtYXQnKVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEVuc3VyZSByYXRpbmcgaXMgd2l0aGluIHZhbGlkIHJhbmdlICgxLTUpXG4gICAgICAgICAgY29uc3QgbGV2ZWwgPSBNYXRoLm1heCgxLCBNYXRoLm1pbig1LCBNYXRoLnJvdW5kKHJhdGluZ0RhdGEucmF0aW5nKSkpXG5cbiAgICAgICAgICB2YWxpZFJhdGluZ3MucHVzaCh7XG4gICAgICAgICAgICB2aWRlb0lkOiByYXRpbmdEYXRhLnZpZGVvSWQsXG4gICAgICAgICAgICB1c2VySWQ6IHVzZXI/LmlkIHx8ICcnLFxuICAgICAgICAgICAgdGFnSWQ6IHJhdGluZ0RhdGEudGFnSWQsXG4gICAgICAgICAgICBsZXZlbFxuICAgICAgICAgIH0pXG5cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHZhbGlkYXRpbmcgcmF0aW5nIGluIGJ1bGsgZmx1c2gnLCB7XG4gICAgICAgICAgICB1c2VySWQ6IHVzZXI/LmlkLFxuICAgICAgICAgICAgcmF0aW5nRGF0YSxcbiAgICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgICAgIH0pXG4gICAgICAgICAgXG4gICAgICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICAgICAgdmlkZW9JZDogcmF0aW5nRGF0YS52aWRlb0lkLFxuICAgICAgICAgICAgdGFnSWQ6IHJhdGluZ0RhdGEudGFnSWQsXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEVhcmx5IHJldHVybiBpZiBubyB2YWxpZCByYXRpbmdzXG4gICAgICBpZiAodmFsaWRSYXRpbmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdObyB2YWxpZCByYXRpbmdzIHRvIHByb2Nlc3MnLFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHByb2Nlc3NlZDogcmF0aW5nc0RhdGEubGVuZ3RoLFxuICAgICAgICAgICAgc3VjY2Vzc2Z1bDogMCxcbiAgICAgICAgICAgIGZhaWxlZDogZXJyb3JzLmxlbmd0aCxcbiAgICAgICAgICAgIGVycm9yc1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdW5pcXVlIHZpZGVvIElEcyBhbmQgdGFnIElEcyBmb3IgdmFsaWRhdGlvblxuICAgICAgY29uc3QgdmlkZW9JZHMgPSBBcnJheS5mcm9tKG5ldyBTZXQodmFsaWRSYXRpbmdzLm1hcChyID0+IHIudmlkZW9JZCkpKVxuICAgICAgY29uc3QgdGFnSWRzID0gQXJyYXkuZnJvbShuZXcgU2V0KHZhbGlkUmF0aW5ncy5tYXAociA9PiByLnRhZ0lkKSkpXG5cbiAgICAgIGxvZ2dlci5pbmZvKCdWYWxpZGF0aW5nIElEcyBmb3IgYnVsayByYXRpbmcgZmx1c2gnLCB7XG4gICAgICAgIHVzZXJJZDogdXNlcj8uaWQsXG4gICAgICAgIHZpZGVvSWRzOiB2aWRlb0lkcy5sZW5ndGgsXG4gICAgICAgIHRhZ0lkczogdGFnSWRzLmxlbmd0aCxcbiAgICAgICAgdmlkZW9JZExpc3Q6IHZpZGVvSWRzLnNsaWNlKDAsIDUpLCAvLyBMb2cgZmlyc3QgNSBmb3IgZGVidWdnaW5nXG4gICAgICAgIHRhZ0lkTGlzdDogdGFnSWRzLnNsaWNlKDAsIDUpICAgICAgLy8gTG9nIGZpcnN0IDUgZm9yIGRlYnVnZ2luZ1xuICAgICAgfSlcblxuICAgICAgLy8gVmFsaWRhdGUgdmlkZW9zIGFuZCB0YWdzIGV4aXN0IChiYXRjaCB2YWxpZGF0aW9uKVxuICAgICAgY29uc3QgW2V4aXN0aW5nVmlkZW9zLCBleGlzdGluZ1RhZ3NdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBQcm9taXNlLmFsbCh2aWRlb0lkcy5tYXAoaWQgPT4gdmlkZW9SZXBvc2l0b3J5LmZpbmRCeUlkKGlkKSkpLFxuICAgICAgICBQcm9taXNlLmFsbCh0YWdJZHMubWFwKGlkID0+IHRhZ1JlcG9zaXRvcnkuZmluZEJ5SWQoaWQpKSlcbiAgICAgIF0pXG5cbiAgICAgIGNvbnN0IHZhbGlkVmlkZW9JZHMgPSBuZXcgU2V0KGV4aXN0aW5nVmlkZW9zLmZpbHRlcih2ID0+IHYpLm1hcCh2ID0+IHYhLmlkKSlcbiAgICAgIGNvbnN0IHZhbGlkVGFnSWRzID0gbmV3IFNldChleGlzdGluZ1RhZ3MuZmlsdGVyKHQgPT4gdCkubWFwKHQgPT4gdCEuaWQpKVxuXG4gICAgICBsb2dnZXIuaW5mbygnSUQgdmFsaWRhdGlvbiByZXN1bHRzJywge1xuICAgICAgICB1c2VySWQ6IHVzZXI/LmlkLFxuICAgICAgICB2YWxpZFZpZGVvSWRzOiBBcnJheS5mcm9tKHZhbGlkVmlkZW9JZHMpLnNsaWNlKDAsIDUpLFxuICAgICAgICB2YWxpZFRhZ0lkczogQXJyYXkuZnJvbSh2YWxpZFRhZ0lkcykuc2xpY2UoMCwgNSksXG4gICAgICAgIGludmFsaWRWaWRlb0lkczogdmlkZW9JZHMuZmlsdGVyKGlkID0+ICF2YWxpZFZpZGVvSWRzLmhhcyhpZCkpLFxuICAgICAgICBpbnZhbGlkVGFnSWRzOiB0YWdJZHMuZmlsdGVyKGlkID0+ICF2YWxpZFRhZ0lkcy5oYXMoaWQpKVxuICAgICAgfSlcblxuICAgICAgLy8gRmlsdGVyIHJhdGluZ3MgdG8gb25seSBpbmNsdWRlIHZhbGlkIG9uZXNcbiAgICAgIGNvbnN0IGZpbmFsVmFsaWRSYXRpbmdzID0gdmFsaWRSYXRpbmdzLmZpbHRlcihyYXRpbmcgPT4gXG4gICAgICAgIHZhbGlkVmlkZW9JZHMuaGFzKHJhdGluZy52aWRlb0lkKSAmJiB2YWxpZFRhZ0lkcy5oYXMocmF0aW5nLnRhZ0lkKVxuICAgICAgKVxuXG4gICAgICAvLyBUcmFjayBpbnZhbGlkIHJhdGluZ3NcbiAgICAgIGNvbnN0IGludmFsaWRSYXRpbmdzID0gdmFsaWRSYXRpbmdzLmZpbHRlcihyYXRpbmcgPT4gXG4gICAgICAgICF2YWxpZFZpZGVvSWRzLmhhcyhyYXRpbmcudmlkZW9JZCkgfHwgIXZhbGlkVGFnSWRzLmhhcyhyYXRpbmcudGFnSWQpXG4gICAgICApXG5cbiAgICAgIGludmFsaWRSYXRpbmdzLmZvckVhY2gocmF0aW5nID0+IHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gIXZhbGlkVmlkZW9JZHMuaGFzKHJhdGluZy52aWRlb0lkKSBcbiAgICAgICAgICA/IGBWaWRlbyBub3QgZm91bmQ6ICR7cmF0aW5nLnZpZGVvSWR9YFxuICAgICAgICAgIDogYFRhZyBub3QgZm91bmQ6ICR7cmF0aW5nLnRhZ0lkfWBcbiAgICAgICAgXG4gICAgICAgIGVycm9ycy5wdXNoKHtcbiAgICAgICAgICB2aWRlb0lkOiByYXRpbmcudmlkZW9JZCxcbiAgICAgICAgICB0YWdJZDogcmF0aW5nLnRhZ0lkLFxuICAgICAgICAgIGVycm9yOiByZWFzb25cbiAgICAgICAgfSlcbiAgICAgIH0pXG5cbiAgICAgIGxldCByZXN1bHRzOiBBcnJheTx7XG4gICAgICAgIHZpZGVvSWQ6IHN0cmluZztcbiAgICAgICAgdGFnSWQ6IHN0cmluZztcbiAgICAgICAgbGV2ZWw6IG51bWJlcjtcbiAgICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICAgIH0+ID0gW11cbiAgICAgIFxuICAgICAgLy8gUGVyZm9ybSBidWxrIHVwc2VydCBpZiB3ZSBoYXZlIHZhbGlkIHJhdGluZ3NcbiAgICAgIGlmIChmaW5hbFZhbGlkUmF0aW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdXBzZXJ0ZWRSYXRpbmdzID0gYXdhaXQgcmF0aW5nUmVwb3NpdG9yeS5idWxrVXBzZXJ0UmF0aW5ncyhmaW5hbFZhbGlkUmF0aW5ncylcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBVc2UgYWN0dWFsIGRhdGFiYXNlIHJlc3VsdHMgaW5zdGVhZCBvZiBjcmVhdGluZyBmYWtlIHN1Y2Nlc3MgcmVzcG9uc2VzXG4gICAgICAgICAgcmVzdWx0cyA9IHVwc2VydGVkUmF0aW5ncy5tYXAocmF0aW5nID0+ICh7XG4gICAgICAgICAgICB2aWRlb0lkOiByYXRpbmcudmlkZW9JZCxcbiAgICAgICAgICAgIHRhZ0lkOiByYXRpbmcudGFnLmlkLFxuICAgICAgICAgICAgbGV2ZWw6IHJhdGluZy5sZXZlbCxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWVcbiAgICAgICAgICB9KSlcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDaGVjayBmb3IgcGFydGlhbCBmYWlsdXJlcyAtIHJhdGluZ3MgdGhhdCB3ZXJlIGV4cGVjdGVkIGJ1dCBub3QgcmV0dXJuZWRcbiAgICAgICAgICBjb25zdCB1cHNlcnRlZElkcyA9IG5ldyBTZXQodXBzZXJ0ZWRSYXRpbmdzLm1hcChyID0+IGAke3IudmlkZW9JZH06JHtyLnRhZy5pZH1gKSlcbiAgICAgICAgICBmaW5hbFZhbGlkUmF0aW5ncy5mb3JFYWNoKGV4cGVjdGVkID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkSWQgPSBgJHtleHBlY3RlZC52aWRlb0lkfToke2V4cGVjdGVkLnRhZ0lkfWBcbiAgICAgICAgICAgIGlmICghdXBzZXJ0ZWRJZHMuaGFzKGV4cGVjdGVkSWQpKSB7XG4gICAgICAgICAgICAgIGVycm9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgICB2aWRlb0lkOiBleHBlY3RlZC52aWRlb0lkLFxuICAgICAgICAgICAgICAgIHRhZ0lkOiBleHBlY3RlZC50YWdJZCxcbiAgICAgICAgICAgICAgICBlcnJvcjogJ0RhdGFiYXNlIHVwc2VydCBmYWlsZWQgLSBubyByZXN1bHQgcmV0dXJuZWQnXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcblxuICAgICAgICAgIC8vIEludmFsaWRhdGUgY2FjaGUgZm9yIGFmZmVjdGVkIHZpZGVvcyBhbmQgdXNlclxuICAgICAgICAgIGNvbnN0IHVuaXF1ZVZpZGVvSWRzID0gQXJyYXkuZnJvbShuZXcgU2V0KGZpbmFsVmFsaWRSYXRpbmdzLm1hcChyID0+IHIudmlkZW9JZCkpKVxuICAgICAgICAgIHVuaXF1ZVZpZGVvSWRzLmZvckVhY2godmlkZW9JZCA9PiB7XG4gICAgICAgICAgICByYXRpbmdDYWNoZVNlcnZpY2UuaW52YWxpZGF0ZVZpZGVvQ2FjaGUodmlkZW9JZClcbiAgICAgICAgICB9KVxuICAgICAgICAgIHJhdGluZ0NhY2hlU2VydmljZS5pbnZhbGlkYXRlVXNlckNhY2hlKHVzZXI/LmlkIHx8ICcnKVxuXG4gICAgICAgICAgLy8gTG9nIGJ1bGsgYWN0aW9uXG4gICAgICAgICAgbG9nVXNlckFjdGlvbignYnVsa192aWRlb19yYXRlZCcsIHVzZXI/LmlkIHx8ICcnLCB7XG4gICAgICAgICAgICByYXRpbmdzQ291bnQ6IGZpbmFsVmFsaWRSYXRpbmdzLmxlbmd0aCxcbiAgICAgICAgICAgIHZpZGVvSWRzOiB2aWRlb0lkcy5sZW5ndGgsXG4gICAgICAgICAgICBjYWNoZUludmFsaWRhdGlvbnM6IHVuaXF1ZVZpZGVvSWRzLmxlbmd0aCArIDEsIC8vIHZpZGVvcyArIHVzZXJcbiAgICAgICAgICAgIGJ1bGtGbHVzaDogdHJ1ZVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgfSBjYXRjaCAoYnVsa0Vycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBidWxrIHJhdGluZyB1cHNlcnQgZHVyaW5nIGZsdXNoJywge1xuICAgICAgICAgICAgdXNlcklkOiB1c2VyPy5pZCxcbiAgICAgICAgICAgIHJhdGluZ3NDb3VudDogZmluYWxWYWxpZFJhdGluZ3MubGVuZ3RoLFxuICAgICAgICAgICAgZXJyb3I6IGJ1bGtFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gYnVsa0Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgLy8gSWYgYnVsayBmYWlscywgYWRkIGFsbCBhcyBlcnJvcnNcbiAgICAgICAgICBmaW5hbFZhbGlkUmF0aW5ncy5mb3JFYWNoKHJhdGluZyA9PiB7XG4gICAgICAgICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgICAgICAgIHZpZGVvSWQ6IHJhdGluZy52aWRlb0lkLFxuICAgICAgICAgICAgICB0YWdJZDogcmF0aW5nLnRhZ0lkLFxuICAgICAgICAgICAgICBlcnJvcjogJ0J1bGsgdXBzZXJ0IGZhaWxlZCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2dnZXIuaW5mbygnQnVsayByYXRpbmcgZmx1c2ggY29tcGxldGVkJywge1xuICAgICAgICB1c2VySWQ6IHVzZXI/LmlkLFxuICAgICAgICBzdWNjZXNzZnVsOiByZXN1bHRzLmxlbmd0aCxcbiAgICAgICAgZmFpbGVkOiBlcnJvcnMubGVuZ3RoLFxuICAgICAgICB0b3RhbDogcmF0aW5nc0RhdGEubGVuZ3RoXG4gICAgICB9KVxuXG4gICAgICAvLyBSZXBvcnQgc3VjY2VzcyBvbmx5IGlmIHdlIHByb2Nlc3NlZCBzb21lIHJhdGluZ3Mgc3VjY2Vzc2Z1bGx5IEFORCBoYXZlIG5vIGVycm9yc1xuICAgICAgY29uc3Qgb3ZlcmFsbFN1Y2Nlc3MgPSByZXN1bHRzLmxlbmd0aCA+IDAgJiYgZXJyb3JzLmxlbmd0aCA9PT0gMFxuICAgICAgXG4gICAgICAvLyBJZiB3ZSBoYXZlIG5vIHN1Y2Nlc3NmdWwgcmVzdWx0cyBidXQgaGF2ZSBlcnJvcnMsIGl0J3MgYSBmYWlsdXJlXG4gICAgICBjb25zdCBoYXNGYWlsdXJlcyA9IGVycm9ycy5sZW5ndGggPiAwXG4gICAgICBjb25zdCBub1N1Y2Nlc3NmdWxSZXN1bHRzID0gcmVzdWx0cy5sZW5ndGggPT09IDBcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2Vzczogb3ZlcmFsbFN1Y2Nlc3MsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBwcm9jZXNzZWQ6IHJhdGluZ3NEYXRhLmxlbmd0aCxcbiAgICAgICAgICBzdWNjZXNzZnVsOiByZXN1bHRzLmxlbmd0aCxcbiAgICAgICAgICBmYWlsZWQ6IGVycm9ycy5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgICBlcnJvcnM6IGVycm9ycy5sZW5ndGggPiAwID8gZXJyb3JzIDogdW5kZWZpbmVkXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2U6IG92ZXJhbGxTdWNjZXNzIFxuICAgICAgICAgID8gYFN1Y2Nlc3NmdWxseSBwcm9jZXNzZWQgJHtyZXN1bHRzLmxlbmd0aH0vJHtyYXRpbmdzRGF0YS5sZW5ndGh9IHJhdGluZ3NgXG4gICAgICAgICAgOiBub1N1Y2Nlc3NmdWxSZXN1bHRzICYmIGhhc0ZhaWx1cmVzXG4gICAgICAgICAgICA/IGBGYWlsZWQgdG8gcHJvY2VzcyBhbGwgcmF0aW5nczogJHtlcnJvcnMubWFwKGUgPT4gZS5lcnJvcikuam9pbignLCAnKX1gXG4gICAgICAgICAgICA6IGhhc0ZhaWx1cmVzXG4gICAgICAgICAgICAgID8gYFBhcnRpYWxseSBmYWlsZWQ6ICR7cmVzdWx0cy5sZW5ndGh9IHN1Y2Nlc3NmdWwsICR7ZXJyb3JzLmxlbmd0aH0gZmFpbGVkYFxuICAgICAgICAgICAgICA6ICdObyByYXRpbmdzIHdlcmUgcHJvY2Vzc2VkJyxcbiAgICAgICAgZXJyb3I6IGhhc0ZhaWx1cmVzICYmIG5vU3VjY2Vzc2Z1bFJlc3VsdHMgXG4gICAgICAgICAgPyBgSW52YWxpZCBkYXRhOiAke2Vycm9ycy5zbGljZSgwLCAzKS5tYXAoZSA9PiBgJHtlLnZpZGVvSWR9OiR7ZS50YWdJZH0gLSAke2UuZXJyb3J9YCkuam9pbignOyAnKX1gXG4gICAgICAgICAgOiB1bmRlZmluZWRcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGluIGJ1bGsgcmF0aW5nIGZsdXNoJywge1xuICAgICAgICB1c2VySWQ6IHVzZXI/LmlkLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcidcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHByb2Nlc3MgcmF0aW5ncycsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ1xuICAgICAgfVxuICAgIH1cbiAgfSlcbn0sIHtcbiAgbWV0aG9kczogWydQT1NUJ10sXG4gIHJlcXVpcmVBdXRoOiB0cnVlXG59KSJdLCJuYW1lcyI6WyJjcmVhdGVBcGlSb3V0ZSIsInJlcXVpcmVBdXRoIiwicmF0aW5nUmVwb3NpdG9yeSIsInZpZGVvUmVwb3NpdG9yeSIsInRhZ1JlcG9zaXRvcnkiLCJyYXRpbmdDYWNoZVNlcnZpY2UiLCJsb2dnZXIiLCJsb2dVc2VyQWN0aW9uIiwiUE9TVCIsImN0eCIsInVzZXIiLCJib2R5IiwicmVxIiwicmF0aW5nc0RhdGEiLCJKU09OIiwicGFyc2UiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJzdWNjZXNzIiwibWVzc2FnZSIsImluZm8iLCJ1c2VySWQiLCJpZCIsInJhdGluZ3NDb3VudCIsInZhbGlkUmF0aW5ncyIsImVycm9ycyIsInJhdGluZ0RhdGEiLCJ2aWRlb0lkIiwidGFnSWQiLCJyYXRpbmciLCJFcnJvciIsImxldmVsIiwiTWF0aCIsIm1heCIsIm1pbiIsInJvdW5kIiwicHVzaCIsImVycm9yIiwiZGF0YSIsInByb2Nlc3NlZCIsInN1Y2Nlc3NmdWwiLCJmYWlsZWQiLCJ2aWRlb0lkcyIsImZyb20iLCJTZXQiLCJtYXAiLCJyIiwidGFnSWRzIiwidmlkZW9JZExpc3QiLCJzbGljZSIsInRhZ0lkTGlzdCIsImV4aXN0aW5nVmlkZW9zIiwiZXhpc3RpbmdUYWdzIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwidmFsaWRWaWRlb0lkcyIsImZpbHRlciIsInYiLCJ2YWxpZFRhZ0lkcyIsInQiLCJpbnZhbGlkVmlkZW9JZHMiLCJoYXMiLCJpbnZhbGlkVGFnSWRzIiwiZmluYWxWYWxpZFJhdGluZ3MiLCJpbnZhbGlkUmF0aW5ncyIsImZvckVhY2giLCJyZWFzb24iLCJyZXN1bHRzIiwidXBzZXJ0ZWRSYXRpbmdzIiwiYnVsa1Vwc2VydFJhdGluZ3MiLCJ0YWciLCJ1cHNlcnRlZElkcyIsImV4cGVjdGVkIiwiZXhwZWN0ZWRJZCIsInVuaXF1ZVZpZGVvSWRzIiwiaW52YWxpZGF0ZVZpZGVvQ2FjaGUiLCJpbnZhbGlkYXRlVXNlckNhY2hlIiwiY2FjaGVJbnZhbGlkYXRpb25zIiwiYnVsa0ZsdXNoIiwiYnVsa0Vycm9yIiwidG90YWwiLCJvdmVyYWxsU3VjY2VzcyIsImhhc0ZhaWx1cmVzIiwibm9TdWNjZXNzZnVsUmVzdWx0cyIsInVuZGVmaW5lZCIsImUiLCJqb2luIiwibWV0aG9kcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./pages/api/ratings/flush.ts\n");

/***/ }),

/***/ "(api)/./src/lib/api-handler.ts":
/*!********************************!*\
  !*** ./src/lib/api-handler.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   CRUD: () => (/* binding */ CRUD),\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   PATCH: () => (/* binding */ PATCH),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT),\n/* harmony export */   createApiRoute: () => (/* binding */ createApiRoute),\n/* harmony export */   errorResponse: () => (/* binding */ errorResponse),\n/* harmony export */   rateLimit: () => (/* binding */ rateLimit),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth),\n/* harmony export */   successResponse: () => (/* binding */ successResponse),\n/* harmony export */   validateBody: () => (/* binding */ validateBody),\n/* harmony export */   validateQuery: () => (/* binding */ validateQuery),\n/* harmony export */   withPagination: () => (/* binding */ withPagination)\n/* harmony export */ });\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/next */ \"next-auth/next\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_next__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./auth */ \"(api)/./src/lib/auth.ts\");\n/* harmony import */ var _errors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./errors */ \"(api)/./src/lib/errors.ts\");\n/* harmony import */ var _logger__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./constants */ \"(api)/./src/lib/constants.ts\");\n\n\n\n\n\n// Main API route wrapper\nfunction createApiRoute(handlers, config = {}) {\n    const { methods = Object.keys(handlers), requireAuth = false } = config;\n    return async (req, res)=>{\n        const startTime = Date.now();\n        const { method = \"GET\" } = req;\n        let user;\n        // Enhanced request logging\n        _logger__WEBPACK_IMPORTED_MODULE_3__.logger.debug(\"API Request Starting\", {\n            method,\n            url: req.url,\n            userAgent: req.headers[\"user-agent\"],\n            ip: req.connection.remoteAddress || req.headers[\"x-forwarded-for\"],\n            contentType: req.headers[\"content-type\"],\n            origin: req.headers.origin\n        });\n        try {\n            // Check if method is allowed\n            if (!methods.includes(method)) {\n                return res.status(_constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.METHOD_NOT_ALLOWED).json({\n                    success: false,\n                    message: `Method ${method} not allowed`,\n                    error: \"METHOD_NOT_ALLOWED\"\n                });\n            }\n            // Get user session if auth is required\n            if (requireAuth) {\n                const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_0__.getServerSession)(req, res, _auth__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n                if (!session?.user) {\n                    return res.status(_constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.UNAUTHORIZED).json({\n                        success: false,\n                        message: \"Authentication required\",\n                        error: \"UNAUTHORIZED\"\n                    });\n                }\n                user = session.user;\n            }\n            // Create API context\n            const ctx = {\n                req,\n                res,\n                user\n            };\n            // Get handler for method\n            const handler = handlers[method];\n            if (!handler) {\n                return res.status(_constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.METHOD_NOT_ALLOWED).json({\n                    success: false,\n                    message: `Handler for ${method} not found`,\n                    error: \"METHOD_NOT_ALLOWED\"\n                });\n            }\n            // Execute handler\n            const result = await handler(ctx);\n            // Log successful request\n            const duration = Date.now() - startTime;\n            (0,_logger__WEBPACK_IMPORTED_MODULE_3__.logApiRequest)(method, req.url || \"\", user?.id, duration);\n            // Send response if not already sent\n            if (!res.headersSent) {\n                res.status(_constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.OK).json(result);\n            }\n        } catch (error) {\n            const duration = Date.now() - startTime;\n            (0,_logger__WEBPACK_IMPORTED_MODULE_3__.logApiError)(method, req.url || \"\", error, user?.id);\n            // Handle known application errors\n            if ((0,_errors__WEBPACK_IMPORTED_MODULE_2__.isAppError)(error)) {\n                const serializedError = (0,_errors__WEBPACK_IMPORTED_MODULE_2__.serializeError)(error, false);\n                return res.status(error.statusCode).json({\n                    success: false,\n                    message: error.message,\n                    error: error.code,\n                    ...error.context && {\n                        context: error.context\n                    }\n                });\n            }\n            // Handle unknown errors\n            _logger__WEBPACK_IMPORTED_MODULE_3__.logger.error(\"Unhandled API error\", {\n                method,\n                url: req.url,\n                error: error instanceof Error ? error.message : error,\n                stack: error instanceof Error ? error.stack : undefined,\n                userId: user?.id\n            });\n            return res.status(_constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.INTERNAL_SERVER_ERROR).json({\n                success: false,\n                message: \"Internal server error\",\n                error: \"INTERNAL_SERVER_ERROR\"\n            });\n        }\n    };\n}\n// Utility to require authentication\nfunction requireAuth(handler) {\n    return async (ctx)=>{\n        if (!ctx.user) {\n            throw new _errors__WEBPACK_IMPORTED_MODULE_2__.AuthenticationError(\"Authentication required\");\n        }\n        return handler(ctx);\n    };\n}\n// Utility to validate request body\nfunction validateBody(schema, handler) {\n    return async (ctx)=>{\n        try {\n            const validatedBody = schema.parse(ctx.req.body);\n            return handler(ctx, validatedBody);\n        } catch (error) {\n            if (error instanceof Error && \"errors\" in error) {\n                const zodError = error;\n                const firstError = zodError.errors[0];\n                throw new _errors__WEBPACK_IMPORTED_MODULE_2__.AppError(firstError.message, \"VALIDATION_ERROR\", _constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.BAD_REQUEST, true, {\n                    field: firstError.path.join(\".\"),\n                    errors: zodError.errors\n                });\n            }\n            throw error;\n        }\n    };\n}\n// Utility to validate query parameters\nfunction validateQuery(schema, handler) {\n    return async (ctx)=>{\n        try {\n            const validatedQuery = schema.parse(ctx.req.query);\n            return handler(ctx, validatedQuery);\n        } catch (error) {\n            if (error instanceof Error && \"errors\" in error) {\n                const zodError = error;\n                const firstError = zodError.errors[0];\n                throw new _errors__WEBPACK_IMPORTED_MODULE_2__.AppError(firstError.message, \"VALIDATION_ERROR\", _constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.BAD_REQUEST, true, {\n                    field: firstError.path.join(\".\"),\n                    errors: zodError.errors\n                });\n            }\n            throw error;\n        }\n    };\n}\n// Utility for pagination\nfunction withPagination(handler) {\n    return async (ctx)=>{\n        const page = parseInt(ctx.req.query.page) || 1;\n        const limit = Math.min(parseInt(ctx.req.query.limit) || 12, 50) // Max 50 items per page\n        ;\n        return handler(ctx, {\n            page,\n            limit\n        });\n    };\n}\n// Response helpers\nfunction successResponse(data, message) {\n    return {\n        success: true,\n        data,\n        ...message && {\n            message\n        }\n    };\n}\nfunction errorResponse(message, code) {\n    return {\n        success: false,\n        message,\n        ...code && {\n            error: code\n        }\n    };\n}\n// Method-specific handlers\nconst GET = (handler)=>({\n        GET: handler\n    });\nconst POST = (handler)=>({\n        POST: handler\n    });\nconst PUT = (handler)=>({\n        PUT: handler\n    });\nconst DELETE = (handler)=>({\n        DELETE: handler\n    });\nconst PATCH = (handler)=>({\n        PATCH: handler\n    });\n// Combined method handlers\nconst CRUD = {\n    GET: (handler)=>handler,\n    POST: (handler)=>handler,\n    PUT: (handler)=>handler,\n    DELETE: (handler)=>handler\n};\n// Rate limiting (simple in-memory implementation for development)\nconst requestCounts = new Map();\nfunction rateLimit(windowMs = 15 * 60 * 1000, maxRequests = 100) {\n    return (handler)=>{\n        return async (ctx)=>{\n            const key = ctx.req.headers[\"x-forwarded-for\"] || ctx.req.connection.remoteAddress || \"unknown\";\n            const now = Date.now();\n            const windowStart = now - windowMs;\n            const requestData = requestCounts.get(key);\n            if (!requestData || requestData.resetTime < windowStart) {\n                requestCounts.set(key, {\n                    count: 1,\n                    resetTime: now\n                });\n                return handler(ctx);\n            }\n            if (requestData.count >= maxRequests) {\n                throw new _errors__WEBPACK_IMPORTED_MODULE_2__.AppError(\"Too many requests\", \"RATE_LIMIT_EXCEEDED\", _constants__WEBPACK_IMPORTED_MODULE_4__.HTTP_STATUS.TOO_MANY_REQUESTS);\n            }\n            requestData.count++;\n            return handler(ctx);\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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akNDLGNBQXNCLEdBQUc7SUFFekIsT0FBTyxDQUFDakQ7UUFDTixPQUFPLE9BQU9EO1lBQ1osTUFBTW1ELE1BQU1uRCxJQUFJekIsR0FBRyxDQUFDVSxPQUFPLENBQUMsa0JBQWtCLElBQ2pDZSxJQUFJekIsR0FBRyxDQUFDWSxVQUFVLENBQUNDLGFBQWEsSUFDaEM7WUFFYixNQUFNVCxNQUFNRCxLQUFLQyxHQUFHO1lBQ3BCLE1BQU15RSxjQUFjekUsTUFBTXNFO1lBRTFCLE1BQU1JLGNBQWNQLGNBQWNRLEdBQUcsQ0FBQ0g7WUFFdEMsSUFBSSxDQUFDRSxlQUFlQSxZQUFZRSxTQUFTLEdBQUdILGFBQWE7Z0JBQ3ZETixjQUFjVSxHQUFHLENBQUNMLEtBQUs7b0JBQUVNLE9BQU87b0JBQUdGLFdBQVc1RTtnQkFBSTtnQkFDbEQsT0FBT3NCLFFBQVFEO1lBQ2pCO1lBRUEsSUFBSXFELFlBQVlJLEtBQUssSUFBSVAsYUFBYTtnQkFDcEMsTUFBTSxJQUFJMUYsNkNBQVFBLENBQ2hCLHFCQUNBLHVCQUNBTyxtREFBV0EsQ0FBQzJGLGlCQUFpQjtZQUVqQztZQUVBTCxZQUFZSSxLQUFLO1lBQ2pCLE9BQU94RCxRQUFRRDtRQUNqQjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vc3JjL2xpYi9hcGktaGFuZGxlci50cz8xZTdlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0J1xuaW1wb3J0IHsgZ2V0U2VydmVyU2Vzc2lvbiB9IGZyb20gJ25leHQtYXV0aC9uZXh0J1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICcuL2F1dGgnXG5pbXBvcnQgeyBcbiAgQXBwRXJyb3IsIFxuICBpc0FwcEVycm9yLCBcbiAgc2VyaWFsaXplRXJyb3IsXG4gIEF1dGhlbnRpY2F0aW9uRXJyb3IgXG59IGZyb20gJy4vZXJyb3JzJ1xuaW1wb3J0IHsgbG9nZ2VyLCBsb2dBcGlSZXF1ZXN0LCBsb2dBcGlFcnJvciB9IGZyb20gJy4vbG9nZ2VyJ1xuaW1wb3J0IHsgSFRUUF9TVEFUVVMgfSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCB7IEFwaVJlc3BvbnNlIH0gZnJvbSAnLi4vdHlwZXMnXG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpQ29udGV4dCB7XG4gIHJlcTogTmV4dEFwaVJlcXVlc3RcbiAgcmVzOiBOZXh0QXBpUmVzcG9uc2VcbiAgdXNlcj86IHtcbiAgICBpZDogc3RyaW5nXG4gICAgZW1haWw6IHN0cmluZ1xuICAgIHVzZXJuYW1lOiBzdHJpbmdcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBBcGlIYW5kbGVyID0gKGN0eDogQXBpQ29udGV4dCkgPT4gUHJvbWlzZTxhbnk+XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXBpUm91dGVDb25maWcge1xuICBtZXRob2RzPzogc3RyaW5nW11cbiAgcmVxdWlyZUF1dGg/OiBib29sZWFuXG4gIHJhdGVMaW1pdD86IHtcbiAgICB3aW5kb3dNczogbnVtYmVyXG4gICAgbWF4UmVxdWVzdHM6IG51bWJlclxuICB9XG59XG5cbi8vIE1haW4gQVBJIHJvdXRlIHdyYXBwZXJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBcGlSb3V0ZShcbiAgaGFuZGxlcnM6IHsgW21ldGhvZDogc3RyaW5nXTogQXBpSGFuZGxlciB9LFxuICBjb25maWc6IEFwaVJvdXRlQ29uZmlnID0ge31cbikge1xuICBjb25zdCB7IFxuICAgIG1ldGhvZHMgPSBPYmplY3Qua2V5cyhoYW5kbGVycyksIFxuICAgIHJlcXVpcmVBdXRoID0gZmFsc2UgXG4gIH0gPSBjb25maWdcblxuICByZXR1cm4gYXN5bmMgKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKVxuICAgIGNvbnN0IHsgbWV0aG9kID0gJ0dFVCcgfSA9IHJlcVxuICAgIGxldCB1c2VyXG5cbiAgICAvLyBFbmhhbmNlZCByZXF1ZXN0IGxvZ2dpbmdcbiAgICBsb2dnZXIuZGVidWcoJ0FQSSBSZXF1ZXN0IFN0YXJ0aW5nJywge1xuICAgICAgbWV0aG9kLFxuICAgICAgdXJsOiByZXEudXJsLFxuICAgICAgdXNlckFnZW50OiByZXEuaGVhZGVyc1sndXNlci1hZ2VudCddLFxuICAgICAgaXA6IHJlcS5jb25uZWN0aW9uLnJlbW90ZUFkZHJlc3MgfHwgcmVxLmhlYWRlcnNbJ3gtZm9yd2FyZGVkLWZvciddLFxuICAgICAgY29udGVudFR5cGU6IHJlcS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSxcbiAgICAgIG9yaWdpbjogcmVxLmhlYWRlcnMub3JpZ2luXG4gICAgfSlcblxuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBtZXRob2QgaXMgYWxsb3dlZFxuICAgICAgaWYgKCFtZXRob2RzLmluY2x1ZGVzKG1ldGhvZCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuTUVUSE9EX05PVF9BTExPV0VEKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBgTWV0aG9kICR7bWV0aG9kfSBub3QgYWxsb3dlZGAsXG4gICAgICAgICAgZXJyb3I6ICdNRVRIT0RfTk9UX0FMTE9XRUQnXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB1c2VyIHNlc3Npb24gaWYgYXV0aCBpcyByZXF1aXJlZFxuICAgICAgaWYgKHJlcXVpcmVBdXRoKSB7XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKHJlcSwgcmVzLCBhdXRoT3B0aW9ucylcbiAgICAgICAgaWYgKCFzZXNzaW9uPy51c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuVU5BVVRIT1JJWkVEKS5qc29uKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIGVycm9yOiAnVU5BVVRIT1JJWkVEJ1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgdXNlciA9IHNlc3Npb24udXNlciBhcyBhbnlcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIEFQSSBjb250ZXh0XG4gICAgICBjb25zdCBjdHg6IEFwaUNvbnRleHQgPSB7IHJlcSwgcmVzLCB1c2VyIH1cblxuICAgICAgLy8gR2V0IGhhbmRsZXIgZm9yIG1ldGhvZFxuICAgICAgY29uc3QgaGFuZGxlciA9IGhhbmRsZXJzW21ldGhvZF1cbiAgICAgIGlmICghaGFuZGxlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5NRVRIT0RfTk9UX0FMTE9XRUQpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGBIYW5kbGVyIGZvciAke21ldGhvZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICBlcnJvcjogJ01FVEhPRF9OT1RfQUxMT1dFRCdcbiAgICAgICAgfSlcbiAgICAgIH1cblxuICAgICAgLy8gRXhlY3V0ZSBoYW5kbGVyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGN0eClcbiAgICAgIFxuICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgcmVxdWVzdFxuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgICBsb2dBcGlSZXF1ZXN0KG1ldGhvZCwgcmVxLnVybCB8fCAnJywgdXNlcj8uaWQsIGR1cmF0aW9uKVxuXG4gICAgICAvLyBTZW5kIHJlc3BvbnNlIGlmIG5vdCBhbHJlYWR5IHNlbnRcbiAgICAgIGlmICghcmVzLmhlYWRlcnNTZW50KSB7XG4gICAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuT0spLmpzb24ocmVzdWx0KVxuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZVxuICAgICAgbG9nQXBpRXJyb3IobWV0aG9kLCByZXEudXJsIHx8ICcnLCBlcnJvciBhcyBFcnJvciwgdXNlcj8uaWQpXG4gICAgICBcbiAgICAgIC8vIEhhbmRsZSBrbm93biBhcHBsaWNhdGlvbiBlcnJvcnNcbiAgICAgIGlmIChpc0FwcEVycm9yKGVycm9yKSkge1xuICAgICAgICBjb25zdCBzZXJpYWxpemVkRXJyb3IgPSBzZXJpYWxpemVFcnJvcihlcnJvciwgZmFsc2UpXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKGVycm9yLnN0YXR1c0NvZGUpLmpzb24oe1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZXJyb3I6IGVycm9yLmNvZGUsXG4gICAgICAgICAgLi4uKGVycm9yLmNvbnRleHQgJiYgeyBjb250ZXh0OiBlcnJvci5jb250ZXh0IH0pXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSB1bmtub3duIGVycm9yc1xuICAgICAgbG9nZ2VyLmVycm9yKCdVbmhhbmRsZWQgQVBJIGVycm9yJywgeyBcbiAgICAgICAgbWV0aG9kLCBcbiAgICAgICAgdXJsOiByZXEudXJsLCBcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogZXJyb3IsXG4gICAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWQsXG4gICAgICAgIHVzZXJJZDogdXNlcj8uaWQgXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5JTlRFUk5BTF9TRVJWRVJfRVJST1IpLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIGVycm9yOiAnSU5URVJOQUxfU0VSVkVSX0VSUk9SJ1xuICAgICAgfSlcbiAgICB9XG4gIH1cbn1cblxuLy8gVXRpbGl0eSB0byByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXG5leHBvcnQgZnVuY3Rpb24gcmVxdWlyZUF1dGgoaGFuZGxlcjogQXBpSGFuZGxlcik6IEFwaUhhbmRsZXIge1xuICByZXR1cm4gYXN5bmMgKGN0eDogQXBpQ29udGV4dCkgPT4ge1xuICAgIGlmICghY3R4LnVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBBdXRoZW50aWNhdGlvbkVycm9yKCdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcpXG4gICAgfVxuICAgIHJldHVybiBoYW5kbGVyKGN0eClcbiAgfVxufVxuXG4vLyBVdGlsaXR5IHRvIHZhbGlkYXRlIHJlcXVlc3QgYm9keVxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQm9keTxUPihcbiAgc2NoZW1hOiBhbnksXG4gIGhhbmRsZXI6IChjdHg6IEFwaUNvbnRleHQsIGJvZHk6IFQpID0+IFByb21pc2U8YW55PlxuKTogQXBpSGFuZGxlciB7XG4gIHJldHVybiBhc3luYyAoY3R4OiBBcGlDb250ZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRlZEJvZHkgPSBzY2hlbWEucGFyc2UoY3R4LnJlcS5ib2R5KVxuICAgICAgcmV0dXJuIGhhbmRsZXIoY3R4LCB2YWxpZGF0ZWRCb2R5KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiAnZXJyb3JzJyBpbiBlcnJvcikge1xuICAgICAgICBjb25zdCB6b2RFcnJvciA9IGVycm9yIGFzIGFueVxuICAgICAgICBjb25zdCBmaXJzdEVycm9yID0gem9kRXJyb3IuZXJyb3JzWzBdXG4gICAgICAgIHRocm93IG5ldyBBcHBFcnJvcihcbiAgICAgICAgICBmaXJzdEVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNULFxuICAgICAgICAgIHRydWUsXG4gICAgICAgICAgeyBmaWVsZDogZmlyc3RFcnJvci5wYXRoLmpvaW4oJy4nKSwgZXJyb3JzOiB6b2RFcnJvci5lcnJvcnMgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxufVxuXG4vLyBVdGlsaXR5IHRvIHZhbGlkYXRlIHF1ZXJ5IHBhcmFtZXRlcnNcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVF1ZXJ5PFQ+KFxuICBzY2hlbWE6IGFueSxcbiAgaGFuZGxlcjogKGN0eDogQXBpQ29udGV4dCwgcXVlcnk6IFQpID0+IFByb21pc2U8YW55PlxuKTogQXBpSGFuZGxlciB7XG4gIHJldHVybiBhc3luYyAoY3R4OiBBcGlDb250ZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZhbGlkYXRlZFF1ZXJ5ID0gc2NoZW1hLnBhcnNlKGN0eC5yZXEucXVlcnkpXG4gICAgICByZXR1cm4gaGFuZGxlcihjdHgsIHZhbGlkYXRlZFF1ZXJ5KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiAnZXJyb3JzJyBpbiBlcnJvcikge1xuICAgICAgICBjb25zdCB6b2RFcnJvciA9IGVycm9yIGFzIGFueVxuICAgICAgICBjb25zdCBmaXJzdEVycm9yID0gem9kRXJyb3IuZXJyb3JzWzBdXG4gICAgICAgIHRocm93IG5ldyBBcHBFcnJvcihcbiAgICAgICAgICBmaXJzdEVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgICAgIEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNULFxuICAgICAgICAgIHRydWUsXG4gICAgICAgICAgeyBmaWVsZDogZmlyc3RFcnJvci5wYXRoLmpvaW4oJy4nKSwgZXJyb3JzOiB6b2RFcnJvci5lcnJvcnMgfVxuICAgICAgICApXG4gICAgICB9XG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxufVxuXG4vLyBVdGlsaXR5IGZvciBwYWdpbmF0aW9uXG5leHBvcnQgZnVuY3Rpb24gd2l0aFBhZ2luYXRpb24oXG4gIGhhbmRsZXI6IChjdHg6IEFwaUNvbnRleHQsIHBhZ2luYXRpb246IHsgcGFnZTogbnVtYmVyOyBsaW1pdDogbnVtYmVyIH0pID0+IFByb21pc2U8YW55PlxuKTogQXBpSGFuZGxlciB7XG4gIHJldHVybiBhc3luYyAoY3R4OiBBcGlDb250ZXh0KSA9PiB7XG4gICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KGN0eC5yZXEucXVlcnkucGFnZSBhcyBzdHJpbmcpIHx8IDFcbiAgICBjb25zdCBsaW1pdCA9IE1hdGgubWluKHBhcnNlSW50KGN0eC5yZXEucXVlcnkubGltaXQgYXMgc3RyaW5nKSB8fCAxMiwgNTApIC8vIE1heCA1MCBpdGVtcyBwZXIgcGFnZVxuICAgIFxuICAgIHJldHVybiBoYW5kbGVyKGN0eCwgeyBwYWdlLCBsaW1pdCB9KVxuICB9XG59XG5cbi8vIFJlc3BvbnNlIGhlbHBlcnNcbmV4cG9ydCBmdW5jdGlvbiBzdWNjZXNzUmVzcG9uc2U8VD4oZGF0YTogVCwgbWVzc2FnZT86IHN0cmluZyk6IEFwaVJlc3BvbnNlPFQ+IHtcbiAgcmV0dXJuIHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIGRhdGEsXG4gICAgLi4uKG1lc3NhZ2UgJiYgeyBtZXNzYWdlIH0pXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVycm9yUmVzcG9uc2UobWVzc2FnZTogc3RyaW5nLCBjb2RlPzogc3RyaW5nKTogQXBpUmVzcG9uc2Uge1xuICByZXR1cm4ge1xuICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgIG1lc3NhZ2UsXG4gICAgLi4uKGNvZGUgJiYgeyBlcnJvcjogY29kZSB9KVxuICB9XG59XG5cbi8vIE1ldGhvZC1zcGVjaWZpYyBoYW5kbGVyc1xuZXhwb3J0IGNvbnN0IEdFVCA9IChoYW5kbGVyOiBBcGlIYW5kbGVyKSA9PiAoeyBHRVQ6IGhhbmRsZXIgfSlcbmV4cG9ydCBjb25zdCBQT1NUID0gKGhhbmRsZXI6IEFwaUhhbmRsZXIpID0+ICh7IFBPU1Q6IGhhbmRsZXIgfSlcbmV4cG9ydCBjb25zdCBQVVQgPSAoaGFuZGxlcjogQXBpSGFuZGxlcikgPT4gKHsgUFVUOiBoYW5kbGVyIH0pXG5leHBvcnQgY29uc3QgREVMRVRFID0gKGhhbmRsZXI6IEFwaUhhbmRsZXIpID0+ICh7IERFTEVURTogaGFuZGxlciB9KVxuZXhwb3J0IGNvbnN0IFBBVENIID0gKGhhbmRsZXI6IEFwaUhhbmRsZXIpID0+ICh7IFBBVENIOiBoYW5kbGVyIH0pXG5cbi8vIENvbWJpbmVkIG1ldGhvZCBoYW5kbGVyc1xuZXhwb3J0IGNvbnN0IENSVUQgPSB7XG4gIEdFVDogKGhhbmRsZXI6IEFwaUhhbmRsZXIpID0+IGhhbmRsZXIsXG4gIFBPU1Q6IChoYW5kbGVyOiBBcGlIYW5kbGVyKSA9PiBoYW5kbGVyLFxuICBQVVQ6IChoYW5kbGVyOiBBcGlIYW5kbGVyKSA9PiBoYW5kbGVyLFxuICBERUxFVEU6IChoYW5kbGVyOiBBcGlIYW5kbGVyKSA9PiBoYW5kbGVyLFxufVxuXG4vLyBSYXRlIGxpbWl0aW5nIChzaW1wbGUgaW4tbWVtb3J5IGltcGxlbWVudGF0aW9uIGZvciBkZXZlbG9wbWVudClcbmNvbnN0IHJlcXVlc3RDb3VudHMgPSBuZXcgTWFwPHN0cmluZywgeyBjb3VudDogbnVtYmVyOyByZXNldFRpbWU6IG51bWJlciB9PigpXG5cbmV4cG9ydCBmdW5jdGlvbiByYXRlTGltaXQoXG4gIHdpbmRvd01zOiBudW1iZXIgPSAxNSAqIDYwICogMTAwMCwgLy8gMTUgbWludXRlc1xuICBtYXhSZXF1ZXN0czogbnVtYmVyID0gMTAwXG4pIHtcbiAgcmV0dXJuIChoYW5kbGVyOiBBcGlIYW5kbGVyKTogQXBpSGFuZGxlciA9PiB7XG4gICAgcmV0dXJuIGFzeW5jIChjdHg6IEFwaUNvbnRleHQpID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IGN0eC5yZXEuaGVhZGVyc1sneC1mb3J3YXJkZWQtZm9yJ10gYXMgc3RyaW5nIHx8IFxuICAgICAgICAgICAgICAgICAgIGN0eC5yZXEuY29ubmVjdGlvbi5yZW1vdGVBZGRyZXNzIHx8IFxuICAgICAgICAgICAgICAgICAgICd1bmtub3duJ1xuICAgICAgXG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgICBjb25zdCB3aW5kb3dTdGFydCA9IG5vdyAtIHdpbmRvd01zXG4gICAgICBcbiAgICAgIGNvbnN0IHJlcXVlc3REYXRhID0gcmVxdWVzdENvdW50cy5nZXQoa2V5KVxuICAgICAgXG4gICAgICBpZiAoIXJlcXVlc3REYXRhIHx8IHJlcXVlc3REYXRhLnJlc2V0VGltZSA8IHdpbmRvd1N0YXJ0KSB7XG4gICAgICAgIHJlcXVlc3RDb3VudHMuc2V0KGtleSwgeyBjb3VudDogMSwgcmVzZXRUaW1lOiBub3cgfSlcbiAgICAgICAgcmV0dXJuIGhhbmRsZXIoY3R4KVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAocmVxdWVzdERhdGEuY291bnQgPj0gbWF4UmVxdWVzdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEFwcEVycm9yKFxuICAgICAgICAgICdUb28gbWFueSByZXF1ZXN0cycsXG4gICAgICAgICAgJ1JBVEVfTElNSVRfRVhDRUVERUQnLFxuICAgICAgICAgIEhUVFBfU1RBVFVTLlRPT19NQU5ZX1JFUVVFU1RTXG4gICAgICAgIClcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmVxdWVzdERhdGEuY291bnQrK1xuICAgICAgcmV0dXJuIGhhbmRsZXIoY3R4KVxuICAgIH1cbiAgfVxufSJdLCJuYW1lcyI6WyJnZXRTZXJ2ZXJTZXNzaW9uIiwiYXV0aE9wdGlvbnMiLCJBcHBFcnJvciIsImlzQXBwRXJyb3IiLCJzZXJpYWxpemVFcnJvciIsIkF1dGhlbnRpY2F0aW9uRXJyb3IiLCJsb2dnZXIiLCJsb2dBcGlSZXF1ZXN0IiwibG9nQXBpRXJyb3IiLCJIVFRQX1NUQVRVUyIsImNyZWF0ZUFwaVJvdXRlIiwiaGFuZGxlcnMiLCJjb25maWciLCJtZXRob2RzIiwiT2JqZWN0Iiwia2V5cyIsInJlcXVpcmVBdXRoIiwicmVxIiwicmVzIiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsIm1ldGhvZCIsInVzZXIiLCJkZWJ1ZyIsInVybCIsInVzZXJBZ2VudCIsImhlYWRlcnMiLCJpcCIsImNvbm5lY3Rpb24iLCJyZW1vdGVBZGRyZXNzIiwiY29udGVudFR5cGUiLCJvcmlnaW4iLCJpbmNsdWRlcyIsInN0YXR1cyIsIk1FVEhPRF9OT1RfQUxMT1dFRCIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsImVycm9yIiwic2Vzc2lvbiIsIlVOQVVUSE9SSVpFRCIsImN0eCIsImhhbmRsZXIiLCJyZXN1bHQiLCJkdXJhdGlvbiIsImlkIiwiaGVhZGVyc1NlbnQiLCJPSyIsInNlcmlhbGl6ZWRFcnJvciIsInN0YXR1c0NvZGUiLCJjb2RlIiwiY29udGV4dCIsIkVycm9yIiwic3RhY2siLCJ1bmRlZmluZWQiLCJ1c2VySWQiLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJ2YWxpZGF0ZUJvZHkiLCJzY2hlbWEiLCJ2YWxpZGF0ZWRCb2R5IiwicGFyc2UiLCJib2R5Iiwiem9kRXJyb3IiLCJmaXJzdEVycm9yIiwiZXJyb3JzIiwiQkFEX1JFUVVFU1QiLCJmaWVsZCIsInBhdGgiLCJqb2luIiwidmFsaWRhdGVRdWVyeSIsInZhbGlkYXRlZFF1ZXJ5IiwicXVlcnkiLCJ3aXRoUGFnaW5hdGlvbiIsInBhZ2UiLCJwYXJzZUludCIsImxpbWl0IiwiTWF0aCIsIm1pbiIsInN1Y2Nlc3NSZXNwb25zZSIsImRhdGEiLCJlcnJvclJlc3BvbnNlIiwiR0VUIiwiUE9TVCIsIlBVVCIsIkRFTEVURSIsIlBBVENIIiwiQ1JVRCIsInJlcXVlc3RDb3VudHMiLCJNYXAiLCJyYXRlTGltaXQiLCJ3aW5kb3dNcyIsIm1heFJlcXVlc3RzIiwia2V5Iiwid2luZG93U3RhcnQiLCJyZXF1ZXN0RGF0YSIsImdldCIsInJlc2V0VGltZSIsInNldCIsImNvdW50IiwiVE9PX01BTllfUkVRVUVTVFMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/api-handler.ts\n");

/***/ }),

/***/ "(api)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"next-auth/providers/credentials\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/google */ \"next-auth/providers/google\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_auth_providers_facebook__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next-auth/providers/facebook */ \"next-auth/providers/facebook\");\n/* harmony import */ var next_auth_providers_facebook__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_facebook__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_auth_providers_apple__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next-auth/providers/apple */ \"next-auth/providers/apple\");\n/* harmony import */ var next_auth_providers_apple__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_apple__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _db__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_5__);\n\n\n\n\n\n\nconst authOptions = {\n    providers: [\n        next_auth_providers_google__WEBPACK_IMPORTED_MODULE_1___default()({\n            clientId: process.env.GOOGLE_CLIENT_ID || \"dummy\",\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET || \"dummy\"\n        }),\n        next_auth_providers_facebook__WEBPACK_IMPORTED_MODULE_2___default()({\n            clientId: process.env.FACEBOOK_CLIENT_ID || \"dummy\",\n            clientSecret: process.env.FACEBOOK_CLIENT_SECRET || \"dummy\"\n        }),\n        next_auth_providers_apple__WEBPACK_IMPORTED_MODULE_3___default()({\n            clientId: process.env.APPLE_ID || \"dummy\",\n            clientSecret: process.env.APPLE_SECRET || \"dummy\"\n        }),\n        next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0___default()({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                try {\n                    if (!credentials?.email || !credentials?.password) {\n                        return null;\n                    }\n                    const user = await _db__WEBPACK_IMPORTED_MODULE_4__.db.user.findUnique({\n                        where: {\n                            email: credentials.email\n                        }\n                    });\n                    if (!user || !user.password) {\n                        return null;\n                    }\n                    const isPasswordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_5___default().compare(credentials.password, user.password);\n                    if (!isPasswordValid) {\n                        return null;\n                    }\n                    return {\n                        id: user.id,\n                        email: user.email,\n                        name: user.firstName ? `${user.firstName} ${user.lastName || \"\"}`.trim() : user.username,\n                        username: user.username,\n                        firstName: user.firstName,\n                        lastName: user.lastName\n                    };\n                } catch (error) {\n                    console.error(\"Auth error:\", error);\n                    return null;\n                }\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\",\n        maxAge: 30 * 24 * 60 * 60\n    },\n    pages: {\n        signIn: \"/auth/signin\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.username = user.username;\n                token.firstName = user.firstName;\n                token.lastName = user.lastName;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token && session.user) {\n                session.user.id = token.sub;\n                session.user.username = token.username;\n                session.user.firstName = token.firstName;\n                session.user.lastName = token.lastName;\n            }\n            return session;\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNYixTQUFTO2dCQUNoRE0sUUFBUVosSUFBSSxDQUFTTyxRQUFRLEdBQUdZLE1BQU1aLFFBQVE7WUFDbEQ7WUFDQSxPQUFPSztRQUNUO0lBQ0Y7QUFDRixFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8uL3NyYy9saWIvYXV0aC50cz82NjkyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBdXRoT3B0aW9ucyB9IGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCBDcmVkZW50aWFsc1Byb3ZpZGVyIGZyb20gJ25leHQtYXV0aC9wcm92aWRlcnMvY3JlZGVudGlhbHMnXG5pbXBvcnQgR29vZ2xlUHJvdmlkZXIgZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9nb29nbGUnXG5pbXBvcnQgRmFjZWJvb2tQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2ZhY2Vib29rJ1xuaW1wb3J0IEFwcGxlUHJvdmlkZXIgZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9hcHBsZSdcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi9kYidcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnXG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogTmV4dEF1dGhPcHRpb25zID0ge1xuICBwcm92aWRlcnM6IFtcbiAgICBHb29nbGVQcm92aWRlcih7XG4gICAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCB8fCAnZHVtbXknLFxuICAgICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVCB8fCAnZHVtbXknLFxuICAgIH0pLFxuICAgIEZhY2Vib29rUHJvdmlkZXIoe1xuICAgICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LkZBQ0VCT09LX0NMSUVOVF9JRCB8fCAnZHVtbXknLFxuICAgICAgY2xpZW50U2VjcmV0OiBwcm9jZXNzLmVudi5GQUNFQk9PS19DTElFTlRfU0VDUkVUIHx8ICdkdW1teScsXG4gICAgfSksXG4gICAgQXBwbGVQcm92aWRlcih7XG4gICAgICBjbGllbnRJZDogcHJvY2Vzcy5lbnYuQVBQTEVfSUQgfHwgJ2R1bW15JyxcbiAgICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuQVBQTEVfU0VDUkVUIHx8ICdkdW1teScsXG4gICAgfSksXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiAnY3JlZGVudGlhbHMnLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6ICdFbWFpbCcsIHR5cGU6ICdlbWFpbCcgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6ICdQYXNzd29yZCcsIHR5cGU6ICdwYXNzd29yZCcgfVxuICAgICAgfSxcbiAgICAgIGFzeW5jIGF1dGhvcml6ZShjcmVkZW50aWFscykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmICghY3JlZGVudGlhbHM/LmVtYWlsIHx8ICFjcmVkZW50aWFscz8ucGFzc3dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IGRiLnVzZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBlbWFpbDogY3JlZGVudGlhbHMuZW1haWxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgaWYgKCF1c2VyIHx8ICF1c2VyLnBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKGNyZWRlbnRpYWxzLnBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKVxuICAgICAgICAgIGlmICghaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgbmFtZTogdXNlci5maXJzdE5hbWUgPyBgJHt1c2VyLmZpcnN0TmFtZX0gJHt1c2VyLmxhc3ROYW1lIHx8ICcnfWAudHJpbSgpIDogdXNlci51c2VybmFtZSxcbiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB1c2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB1c2VyLmxhc3ROYW1lLFxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRoIGVycm9yOicsIGVycm9yKVxuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICBdLFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6ICdqd3QnLFxuICAgIG1heEFnZTogMzAgKiAyNCAqIDYwICogNjAsIC8vIDMwIGRheXNcbiAgfSxcbiAgcGFnZXM6IHtcbiAgICBzaWduSW46ICcvYXV0aC9zaWduaW4nXG4gIH0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLnVzZXJuYW1lID0gKHVzZXIgYXMgYW55KS51c2VybmFtZVxuICAgICAgICB0b2tlbi5maXJzdE5hbWUgPSAodXNlciBhcyBhbnkpLmZpcnN0TmFtZVxuICAgICAgICB0b2tlbi5sYXN0TmFtZSA9ICh1c2VyIGFzIGFueSkubGFzdE5hbWVcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b2tlblxuICAgIH0sXG4gICAgYXN5bmMgc2Vzc2lvbih7IHNlc3Npb24sIHRva2VuIH0pIHtcbiAgICAgIGlmICh0b2tlbiAmJiBzZXNzaW9uLnVzZXIpIHtcbiAgICAgICAgKHNlc3Npb24udXNlciBhcyBhbnkpLmlkID0gdG9rZW4uc3ViIVxuICAgICAgICA7KHNlc3Npb24udXNlciBhcyBhbnkpLnVzZXJuYW1lID0gdG9rZW4udXNlcm5hbWUgYXMgc3RyaW5nXG4gICAgICAgIDsoc2Vzc2lvbi51c2VyIGFzIGFueSkuZmlyc3ROYW1lID0gdG9rZW4uZmlyc3ROYW1lIGFzIHN0cmluZ1xuICAgICAgICA7KHNlc3Npb24udXNlciBhcyBhbnkpLmxhc3ROYW1lID0gdG9rZW4ubGFzdE5hbWUgYXMgc3RyaW5nXG4gICAgICB9XG4gICAgICByZXR1cm4gc2Vzc2lvblxuICAgIH1cbiAgfVxufSJdLCJuYW1lcyI6WyJDcmVkZW50aWFsc1Byb3ZpZGVyIiwiR29vZ2xlUHJvdmlkZXIiLCJGYWNlYm9va1Byb3ZpZGVyIiwiQXBwbGVQcm92aWRlciIsImRiIiwiYmNyeXB0IiwiYXV0aE9wdGlvbnMiLCJwcm92aWRlcnMiLCJjbGllbnRJZCIsInByb2Nlc3MiLCJlbnYiLCJHT09HTEVfQ0xJRU5UX0lEIiwiY2xpZW50U2VjcmV0IiwiR09PR0xFX0NMSUVOVF9TRUNSRVQiLCJGQUNFQk9PS19DTElFTlRfSUQiLCJGQUNFQk9PS19DTElFTlRfU0VDUkVUIiwiQVBQTEVfSUQiLCJBUFBMRV9TRUNSRVQiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsInBhc3N3b3JkIiwiYXV0aG9yaXplIiwidXNlciIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlzUGFzc3dvcmRWYWxpZCIsImNvbXBhcmUiLCJpZCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwidHJpbSIsInVzZXJuYW1lIiwiZXJyb3IiLCJjb25zb2xlIiwic2Vzc2lvbiIsInN0cmF0ZWd5IiwibWF4QWdlIiwicGFnZXMiLCJzaWduSW4iLCJjYWxsYmFja3MiLCJqd3QiLCJ0b2tlbiIsInN1YiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(api)/./src/lib/config.ts":
/*!***************************!*\
  !*** ./src/lib/config.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   getEnvVar: () => (/* binding */ getEnvVar),\n/* harmony export */   getEnvVarAsBoolean: () => (/* binding */ getEnvVarAsBoolean),\n/* harmony export */   getEnvVarAsNumber: () => (/* binding */ getEnvVarAsNumber),\n/* harmony export */   isDevelopment: () => (/* binding */ isDevelopment),\n/* harmony export */   isProduction: () => (/* binding */ isProduction),\n/* harmony export */   isTest: () => (/* binding */ isTest)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"(api)/./src/lib/constants.ts\");\n\nfunction getConfig() {\n    const env = \"development\" || 0;\n    const isDevelopment = env === _constants__WEBPACK_IMPORTED_MODULE_0__.NODE_ENV.DEVELOPMENT;\n    const isProduction = env === _constants__WEBPACK_IMPORTED_MODULE_0__.NODE_ENV.PRODUCTION;\n    // Validate required environment variables\n    const requiredVars = [\n        \"DATABASE_URL\",\n        \"NEXTAUTH_SECRET\",\n        \"NEXTAUTH_URL\"\n    ];\n    for (const varName of requiredVars){\n        if (!process.env[varName]) {\n            throw new Error(`Missing required environment variable: ${varName}`);\n        }\n    }\n    return {\n        app: {\n            name: process.env.APP_NAME || \"RateMe\",\n            version: process.env.APP_VERSION || \"1.0.0\",\n            env,\n            port: parseInt(process.env.PORT || \"3000\", 10),\n            url: process.env.NEXTAUTH_URL\n        },\n        database: {\n            url: process.env.DATABASE_URL\n        },\n        auth: {\n            secret: process.env.NEXTAUTH_SECRET,\n            url: process.env.NEXTAUTH_URL,\n            sessionMaxAge: parseInt(process.env.SESSION_MAX_AGE || \"2592000\", 10)\n        },\n        logging: {\n            level: process.env.LOG_LEVEL || (isDevelopment ? \"debug\" : \"info\"),\n            pretty: isDevelopment\n        },\n        redis: process.env.REDIS_URL ? {\n            url: process.env.REDIS_URL,\n            password: process.env.REDIS_PASSWORD\n        } : undefined,\n        external: {\n            youtube: process.env.YOUTUBE_API_KEY ? {\n                apiKey: process.env.YOUTUBE_API_KEY\n            } : undefined,\n            vimeo: process.env.VIMEO_CLIENT_ID && process.env.VIMEO_CLIENT_SECRET ? {\n                clientId: process.env.VIMEO_CLIENT_ID,\n                clientSecret: process.env.VIMEO_CLIENT_SECRET\n            } : undefined\n        }\n    };\n}\n// Export singleton config instance\nconst config = getConfig();\n// Type-safe environment variable access\nfunction getEnvVar(name, defaultValue) {\n    const value = process.env[name];\n    if (value === undefined) {\n        if (defaultValue !== undefined) {\n            return defaultValue;\n        }\n        throw new Error(`Environment variable ${name} is not set`);\n    }\n    return value;\n}\nfunction getEnvVarAsNumber(name, defaultValue) {\n    const value = process.env[name];\n    if (value === undefined) {\n        if (defaultValue !== undefined) {\n            return defaultValue;\n        }\n        throw new Error(`Environment variable ${name} is not set`);\n    }\n    const parsed = parseInt(value, 10);\n    if (isNaN(parsed)) {\n        throw new Error(`Environment variable ${name} is not a valid number: ${value}`);\n    }\n    return parsed;\n}\nfunction getEnvVarAsBoolean(name, defaultValue) {\n    const value = process.env[name];\n    if (value === undefined) {\n        if (defaultValue !== undefined) {\n            return defaultValue;\n        }\n        throw new Error(`Environment variable ${name} is not set`);\n    }\n    return value.toLowerCase() === \"true\";\n}\n// Environment checks\nconst isDevelopment = config.app.env === _constants__WEBPACK_IMPORTED_MODULE_0__.NODE_ENV.DEVELOPMENT;\nconst isProduction = config.app.env === _constants__WEBPACK_IMPORTED_MODULE_0__.NODE_ENV.PRODUCTION;\nconst isTest = config.app.env === _constants__WEBPACK_IMPORTED_MODULE_0__.NODE_ENV.TEST;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDL0IsSUFBSUcsTUFBTUQsU0FBUztRQUNqQixNQUFNLElBQUl6QyxNQUFNLENBQUMscUJBQXFCLEVBQUVFLEtBQUssd0JBQXdCLEVBQUVxQyxNQUFNLENBQUM7SUFDaEY7SUFDQSxPQUFPRTtBQUNUO0FBRU8sU0FBU0UsbUJBQW1CekMsSUFBWSxFQUFFb0MsWUFBc0I7SUFDckUsTUFBTUMsUUFBUTlDLFFBQVFELEdBQUcsQ0FBQ1UsS0FBSztJQUMvQixJQUFJcUMsVUFBVWIsV0FBVztRQUN2QixJQUFJWSxpQkFBaUJaLFdBQVc7WUFDOUIsT0FBT1k7UUFDVDtRQUNBLE1BQU0sSUFBSXRDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRUUsS0FBSyxXQUFXLENBQUM7SUFDM0Q7SUFDQSxPQUFPcUMsTUFBTUssV0FBVyxPQUFPO0FBQ2pDO0FBRUEscUJBQXFCO0FBQ2QsTUFBTWpELGdCQUFnQnlDLE9BQU9uQyxHQUFHLENBQUNULEdBQUcsS0FBS0YsZ0RBQVFBLENBQUNJLFdBQVc7QUFDN0QsTUFBTUUsZUFBZXdDLE9BQU9uQyxHQUFHLENBQUNULEdBQUcsS0FBS0YsZ0RBQVFBLENBQUNPLFVBQVU7QUFDM0QsTUFBTWdELFNBQVNULE9BQU9uQyxHQUFHLENBQUNULEdBQUcsS0FBS0YsZ0RBQVFBLENBQUN3RCxJQUFJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8uL3NyYy9saWIvY29uZmlnLnRzP2EzZWYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTk9ERV9FTlYgfSBmcm9tICcuL2NvbnN0YW50cydcblxuaW50ZXJmYWNlIENvbmZpZyB7XG4gIGFwcDoge1xuICAgIG5hbWU6IHN0cmluZ1xuICAgIHZlcnNpb246IHN0cmluZ1xuICAgIGVudjogc3RyaW5nXG4gICAgcG9ydDogbnVtYmVyXG4gICAgdXJsOiBzdHJpbmdcbiAgfVxuICBkYXRhYmFzZToge1xuICAgIHVybDogc3RyaW5nXG4gIH1cbiAgYXV0aDoge1xuICAgIHNlY3JldDogc3RyaW5nXG4gICAgdXJsOiBzdHJpbmdcbiAgICBzZXNzaW9uTWF4QWdlOiBudW1iZXJcbiAgfVxuICBsb2dnaW5nOiB7XG4gICAgbGV2ZWw6IHN0cmluZ1xuICAgIHByZXR0eTogYm9vbGVhblxuICB9XG4gIHJlZGlzPzoge1xuICAgIHVybDogc3RyaW5nXG4gICAgcGFzc3dvcmQ/OiBzdHJpbmdcbiAgfVxuICBleHRlcm5hbDoge1xuICAgIHlvdXR1YmU/OiB7XG4gICAgICBhcGlLZXk6IHN0cmluZ1xuICAgIH1cbiAgICB2aW1lbz86IHtcbiAgICAgIGNsaWVudElkOiBzdHJpbmdcbiAgICAgIGNsaWVudFNlY3JldDogc3RyaW5nXG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGdldENvbmZpZygpOiBDb25maWcge1xuICBjb25zdCBlbnYgPSBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCBOT0RFX0VOVi5ERVZFTE9QTUVOVFxuICBjb25zdCBpc0RldmVsb3BtZW50ID0gZW52ID09PSBOT0RFX0VOVi5ERVZFTE9QTUVOVFxuICBjb25zdCBpc1Byb2R1Y3Rpb24gPSBlbnYgPT09IE5PREVfRU5WLlBST0RVQ1RJT05cblxuICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbiAgY29uc3QgcmVxdWlyZWRWYXJzID0gW1xuICAgICdEQVRBQkFTRV9VUkwnLFxuICAgICdORVhUQVVUSF9TRUNSRVQnLFxuICAgICdORVhUQVVUSF9VUkwnLFxuICBdXG5cbiAgZm9yIChjb25zdCB2YXJOYW1lIG9mIHJlcXVpcmVkVmFycykge1xuICAgIGlmICghcHJvY2Vzcy5lbnZbdmFyTmFtZV0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyByZXF1aXJlZCBlbnZpcm9ubWVudCB2YXJpYWJsZTogJHt2YXJOYW1lfWApXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBhcHA6IHtcbiAgICAgIG5hbWU6IHByb2Nlc3MuZW52LkFQUF9OQU1FIHx8ICdSYXRlTWUnLFxuICAgICAgdmVyc2lvbjogcHJvY2Vzcy5lbnYuQVBQX1ZFUlNJT04gfHwgJzEuMC4wJyxcbiAgICAgIGVudixcbiAgICAgIHBvcnQ6IHBhcnNlSW50KHByb2Nlc3MuZW52LlBPUlQgfHwgJzMwMDAnLCAxMCksXG4gICAgICB1cmw6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCEsXG4gICAgfSxcbiAgICBkYXRhYmFzZToge1xuICAgICAgdXJsOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwhLFxuICAgIH0sXG4gICAgYXV0aDoge1xuICAgICAgc2VjcmV0OiBwcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQhLFxuICAgICAgdXJsOiBwcm9jZXNzLmVudi5ORVhUQVVUSF9VUkwhLFxuICAgICAgc2Vzc2lvbk1heEFnZTogcGFyc2VJbnQocHJvY2Vzcy5lbnYuU0VTU0lPTl9NQVhfQUdFIHx8ICcyNTkyMDAwJywgMTApLCAvLyAzMCBkYXlzXG4gICAgfSxcbiAgICBsb2dnaW5nOiB7XG4gICAgICBsZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIHx8IChpc0RldmVsb3BtZW50ID8gJ2RlYnVnJyA6ICdpbmZvJyksXG4gICAgICBwcmV0dHk6IGlzRGV2ZWxvcG1lbnQsXG4gICAgfSxcbiAgICByZWRpczogcHJvY2Vzcy5lbnYuUkVESVNfVVJMID8ge1xuICAgICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwsXG4gICAgICBwYXNzd29yZDogcHJvY2Vzcy5lbnYuUkVESVNfUEFTU1dPUkQsXG4gICAgfSA6IHVuZGVmaW5lZCxcbiAgICBleHRlcm5hbDoge1xuICAgICAgeW91dHViZTogcHJvY2Vzcy5lbnYuWU9VVFVCRV9BUElfS0VZID8ge1xuICAgICAgICBhcGlLZXk6IHByb2Nlc3MuZW52LllPVVRVQkVfQVBJX0tFWSxcbiAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgICB2aW1lbzogcHJvY2Vzcy5lbnYuVklNRU9fQ0xJRU5UX0lEICYmIHByb2Nlc3MuZW52LlZJTUVPX0NMSUVOVF9TRUNSRVQgPyB7XG4gICAgICAgIGNsaWVudElkOiBwcm9jZXNzLmVudi5WSU1FT19DTElFTlRfSUQsXG4gICAgICAgIGNsaWVudFNlY3JldDogcHJvY2Vzcy5lbnYuVklNRU9fQ0xJRU5UX1NFQ1JFVCxcbiAgICAgIH0gOiB1bmRlZmluZWQsXG4gICAgfSxcbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGNvbmZpZyBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGdldENvbmZpZygpXG5cbi8vIFR5cGUtc2FmZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBhY2Nlc3NcbmV4cG9ydCBmdW5jdGlvbiBnZXRFbnZWYXIobmFtZTogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCB2YWx1ZSA9IHByb2Nlc3MuZW52W25hbWVdXG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFZhbHVlXG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgRW52aXJvbm1lbnQgdmFyaWFibGUgJHtuYW1lfSBpcyBub3Qgc2V0YClcbiAgfVxuICByZXR1cm4gdmFsdWVcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVudlZhckFzTnVtYmVyKG5hbWU6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3QgdmFsdWUgPSBwcm9jZXNzLmVudltuYW1lXVxuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChkZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYEVudmlyb25tZW50IHZhcmlhYmxlICR7bmFtZX0gaXMgbm90IHNldGApXG4gIH1cbiAgY29uc3QgcGFyc2VkID0gcGFyc2VJbnQodmFsdWUsIDEwKVxuICBpZiAoaXNOYU4ocGFyc2VkKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRW52aXJvbm1lbnQgdmFyaWFibGUgJHtuYW1lfSBpcyBub3QgYSB2YWxpZCBudW1iZXI6ICR7dmFsdWV9YClcbiAgfVxuICByZXR1cm4gcGFyc2VkXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbnZWYXJBc0Jvb2xlYW4obmFtZTogc3RyaW5nLCBkZWZhdWx0VmFsdWU/OiBib29sZWFuKTogYm9vbGVhbiB7XG4gIGNvbnN0IHZhbHVlID0gcHJvY2Vzcy5lbnZbbmFtZV1cbiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0VmFsdWVcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBFbnZpcm9ubWVudCB2YXJpYWJsZSAke25hbWV9IGlzIG5vdCBzZXRgKVxuICB9XG4gIHJldHVybiB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJ1ZSdcbn1cblxuLy8gRW52aXJvbm1lbnQgY2hlY2tzXG5leHBvcnQgY29uc3QgaXNEZXZlbG9wbWVudCA9IGNvbmZpZy5hcHAuZW52ID09PSBOT0RFX0VOVi5ERVZFTE9QTUVOVFxuZXhwb3J0IGNvbnN0IGlzUHJvZHVjdGlvbiA9IGNvbmZpZy5hcHAuZW52ID09PSBOT0RFX0VOVi5QUk9EVUNUSU9OXG5leHBvcnQgY29uc3QgaXNUZXN0ID0gY29uZmlnLmFwcC5lbnYgPT09IE5PREVfRU5WLlRFU1QiXSwibmFtZXMiOlsiTk9ERV9FTlYiLCJnZXRDb25maWciLCJlbnYiLCJwcm9jZXNzIiwiREVWRUxPUE1FTlQiLCJpc0RldmVsb3BtZW50IiwiaXNQcm9kdWN0aW9uIiwiUFJPRFVDVElPTiIsInJlcXVpcmVkVmFycyIsInZhck5hbWUiLCJFcnJvciIsImFwcCIsIm5hbWUiLCJBUFBfTkFNRSIsInZlcnNpb24iLCJBUFBfVkVSU0lPTiIsInBvcnQiLCJwYXJzZUludCIsIlBPUlQiLCJ1cmwiLCJORVhUQVVUSF9VUkwiLCJkYXRhYmFzZSIsIkRBVEFCQVNFX1VSTCIsImF1dGgiLCJzZWNyZXQiLCJORVhUQVVUSF9TRUNSRVQiLCJzZXNzaW9uTWF4QWdlIiwiU0VTU0lPTl9NQVhfQUdFIiwibG9nZ2luZyIsImxldmVsIiwiTE9HX0xFVkVMIiwicHJldHR5IiwicmVkaXMiLCJSRURJU19VUkwiLCJwYXNzd29yZCIsIlJFRElTX1BBU1NXT1JEIiwidW5kZWZpbmVkIiwiZXh0ZXJuYWwiLCJ5b3V0dWJlIiwiWU9VVFVCRV9BUElfS0VZIiwiYXBpS2V5IiwidmltZW8iLCJWSU1FT19DTElFTlRfSUQiLCJWSU1FT19DTElFTlRfU0VDUkVUIiwiY2xpZW50SWQiLCJjbGllbnRTZWNyZXQiLCJjb25maWciLCJnZXRFbnZWYXIiLCJkZWZhdWx0VmFsdWUiLCJ2YWx1ZSIsImdldEVudlZhckFzTnVtYmVyIiwicGFyc2VkIiwiaXNOYU4iLCJnZXRFbnZWYXJBc0Jvb2xlYW4iLCJ0b0xvd2VyQ2FzZSIsImlzVGVzdCIsIlRFU1QiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/config.ts\n");

/***/ }),

/***/ "(api)/./src/lib/constants.ts":
/*!******************************!*\
  !*** ./src/lib/constants.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   API_ROUTES: () => (/* binding */ API_ROUTES),\n/* harmony export */   APP_DESCRIPTION: () => (/* binding */ APP_DESCRIPTION),\n/* harmony export */   APP_NAME: () => (/* binding */ APP_NAME),\n/* harmony export */   APP_VERSION: () => (/* binding */ APP_VERSION),\n/* harmony export */   CACHE_KEYS: () => (/* binding */ CACHE_KEYS),\n/* harmony export */   CACHE_TTL: () => (/* binding */ CACHE_TTL),\n/* harmony export */   DEFAULTS: () => (/* binding */ DEFAULTS),\n/* harmony export */   ERROR_CODES: () => (/* binding */ ERROR_CODES),\n/* harmony export */   EXTERNAL_SERVICES: () => (/* binding */ EXTERNAL_SERVICES),\n/* harmony export */   FEATURES: () => (/* binding */ FEATURES),\n/* harmony export */   HTTP_STATUS: () => (/* binding */ HTTP_STATUS),\n/* harmony export */   NODE_ENV: () => (/* binding */ NODE_ENV),\n/* harmony export */   PAGINATION: () => (/* binding */ PAGINATION),\n/* harmony export */   RATING_LEVELS: () => (/* binding */ RATING_LEVELS),\n/* harmony export */   SEO: () => (/* binding */ SEO),\n/* harmony export */   SOCIAL_PLATFORMS: () => (/* binding */ SOCIAL_PLATFORMS),\n/* harmony export */   UPLOAD_LIMITS: () => (/* binding */ UPLOAD_LIMITS),\n/* harmony export */   USER_LIMITS: () => (/* binding */ USER_LIMITS),\n/* harmony export */   VALIDATION_PATTERNS: () => (/* binding */ VALIDATION_PATTERNS),\n/* harmony export */   VIDEO_LIMITS: () => (/* binding */ VIDEO_LIMITS),\n/* harmony export */   VIDEO_PLATFORMS: () => (/* binding */ VIDEO_PLATFORMS)\n/* harmony export */ });\n// Application constants\nconst APP_NAME = \"RateMe\";\nconst APP_DESCRIPTION = \"A modern video rating platform\";\nconst APP_VERSION = \"1.0.0\";\n// API constants\nconst API_ROUTES = {\n    AUTH: {\n        SIGNIN: \"/api/auth/signin\",\n        SIGNUP: \"/api/auth/register\",\n        SIGNOUT: \"/api/auth/signout\"\n    },\n    VIDEOS: {\n        BASE: \"/api/videos\",\n        BY_ID: (id)=>`/api/videos/${id}`,\n        RATE: (id)=>`/api/videos/${id}/rate`\n    },\n    USERS: {\n        BASE: \"/api/users\",\n        BY_ID: (id)=>`/api/users/${id}`,\n        FOLLOW: (id)=>`/api/users/${id}/follow`\n    }\n};\n// UI constants\nconst PAGINATION = {\n    DEFAULT_PAGE_SIZE: 12,\n    MAX_PAGE_SIZE: 50\n};\nconst VIDEO_LIMITS = {\n    MAX_TITLE_LENGTH: 200,\n    MAX_DESCRIPTION_LENGTH: 1000\n};\nconst USER_LIMITS = {\n    MIN_USERNAME_LENGTH: 3,\n    MAX_USERNAME_LENGTH: 30,\n    MIN_PASSWORD_LENGTH: 6,\n    MAX_PASSWORD_LENGTH: 128\n};\n// Validation patterns\nconst VALIDATION_PATTERNS = {\n    EMAIL: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n    USERNAME: /^[a-zA-Z0-9_]{3,30}$/,\n    YOUTUBE_URL: /(?:https?:\\/\\/)?(?:www\\.)?(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([a-zA-Z0-9_-]{11})/,\n    VIMEO_URL: /(?:https?:\\/\\/)?(?:www\\.)?vimeo\\.com\\/(\\d+)/\n};\n// Error codes\nconst ERROR_CODES = {\n    // Authentication errors\n    INVALID_CREDENTIALS: \"INVALID_CREDENTIALS\",\n    USER_NOT_FOUND: \"USER_NOT_FOUND\",\n    USER_ALREADY_EXISTS: \"USER_ALREADY_EXISTS\",\n    UNAUTHORIZED: \"UNAUTHORIZED\",\n    SESSION_EXPIRED: \"SESSION_EXPIRED\",\n    // Validation errors\n    VALIDATION_ERROR: \"VALIDATION_ERROR\",\n    INVALID_INPUT: \"INVALID_INPUT\",\n    MISSING_REQUIRED_FIELD: \"MISSING_REQUIRED_FIELD\",\n    // Resource errors\n    RESOURCE_NOT_FOUND: \"RESOURCE_NOT_FOUND\",\n    RESOURCE_ALREADY_EXISTS: \"RESOURCE_ALREADY_EXISTS\",\n    RESOURCE_FORBIDDEN: \"RESOURCE_FORBIDDEN\",\n    // Server errors\n    INTERNAL_SERVER_ERROR: \"INTERNAL_SERVER_ERROR\",\n    DATABASE_ERROR: \"DATABASE_ERROR\",\n    EXTERNAL_SERVICE_ERROR: \"EXTERNAL_SERVICE_ERROR\",\n    // Rate limiting\n    RATE_LIMIT_EXCEEDED: \"RATE_LIMIT_EXCEEDED\"\n};\n// HTTP status codes\nconst HTTP_STATUS = {\n    OK: 200,\n    CREATED: 201,\n    NO_CONTENT: 204,\n    BAD_REQUEST: 400,\n    UNAUTHORIZED: 401,\n    FORBIDDEN: 403,\n    NOT_FOUND: 404,\n    METHOD_NOT_ALLOWED: 405,\n    CONFLICT: 409,\n    UNPROCESSABLE_ENTITY: 422,\n    TOO_MANY_REQUESTS: 429,\n    INTERNAL_SERVER_ERROR: 500,\n    BAD_GATEWAY: 502,\n    SERVICE_UNAVAILABLE: 503\n};\n// Cache keys\nconst CACHE_KEYS = {\n    VIDEOS: \"videos\",\n    USER: (id)=>`user:${id}`,\n    VIDEO: (id)=>`video:${id}`,\n    TAGS: \"tags\",\n    USER_VIDEOS: (userId)=>`user:${userId}:videos`\n};\n// Cache TTL (in seconds)\nconst CACHE_TTL = {\n    SHORT: 300,\n    MEDIUM: 1800,\n    LONG: 3600,\n    VERY_LONG: 86400\n};\n// Environment types\nconst NODE_ENV = {\n    DEVELOPMENT: \"development\",\n    PRODUCTION: \"production\",\n    TEST: \"test\"\n};\n// Supported video platforms\nconst VIDEO_PLATFORMS = {\n    YOUTUBE: \"youtube\",\n    VIMEO: \"vimeo\"\n};\n// Rating levels\nconst RATING_LEVELS = {\n    MIN: 1,\n    MAX: 5,\n    DEFAULT: 3\n};\n// Default values\nconst DEFAULTS = {\n    AVATAR_URL: \"/images/default-avatar.png\",\n    VIDEO_THUMBNAIL: \"/images/default-video-thumbnail.png\",\n    PAGINATION_LIMIT: PAGINATION.DEFAULT_PAGE_SIZE,\n    RATING_LEVEL: RATING_LEVELS.DEFAULT\n};\n// Feature flags\nconst FEATURES = {\n    VIDEO_UPLOAD: true,\n    USER_REGISTRATION: true,\n    VIDEO_RATING: true,\n    USER_FOLLOWING: true,\n    SEARCH: true,\n    ADMIN_PANEL: false\n};\n// External service URLs\nconst EXTERNAL_SERVICES = {\n    YOUTUBE_API: \"https://www.googleapis.com/youtube/v3\",\n    VIMEO_API: \"https://api.vimeo.com\"\n};\n// File upload limits\nconst UPLOAD_LIMITS = {\n    MAX_FILE_SIZE: 10 * 1024 * 1024,\n    ALLOWED_IMAGE_TYPES: [\n        \"image/jpeg\",\n        \"image/png\",\n        \"image/gif\",\n        \"image/webp\"\n    ],\n    ALLOWED_VIDEO_TYPES: [\n        \"video/mp4\",\n        \"video/webm\",\n        \"video/ogg\"\n    ]\n};\n// SEO constants\nconst SEO = {\n    DEFAULT_TITLE: APP_NAME,\n    TITLE_TEMPLATE: `%s | ${APP_NAME}`,\n    DEFAULT_DESCRIPTION: APP_DESCRIPTION,\n    TWITTER_HANDLE: \"@rateme\",\n    SITE_URL: process.env.NEXTAUTH_URL || \"http://localhost:3000\"\n};\n// Social sharing\nconst SOCIAL_PLATFORMS = {\n    TWITTER: \"twitter\",\n    FACEBOOK: \"facebook\",\n    LINKEDIN: \"linkedin\",\n    REDDIT: \"reddit\"\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDTEMsS0FBSztJQUNMQyxTQUFTO0FBQ1gsRUFBVTtBQUVWLGlCQUFpQjtBQUNWLE1BQU1DLFdBQVc7SUFDdEJDLFlBQVk7SUFDWkMsaUJBQWlCO0lBQ2pCQyxrQkFBa0J0RSxXQUFXQyxpQkFBaUI7SUFDOUNzRSxjQUFjUixjQUFjRyxPQUFPO0FBQ3JDLEVBQVU7QUFFVixnQkFBZ0I7QUFDVCxNQUFNTSxXQUFXO0lBQ3RCQyxjQUFjO0lBQ2RDLG1CQUFtQjtJQUNuQkMsY0FBYztJQUNkQyxnQkFBZ0I7SUFDaEJDLFFBQVE7SUFDUkMsYUFBYTtBQUNmLEVBQVU7QUFFVix3QkFBd0I7QUFDakIsTUFBTUMsb0JBQW9CO0lBQy9CQyxhQUFhO0lBQ2JDLFdBQVc7QUFDYixFQUFVO0FBRVYscUJBQXFCO0FBQ2QsTUFBTUMsZ0JBQWdCO0lBQzNCQyxlQUFlLEtBQUssT0FBTztJQUMzQkMscUJBQXFCO1FBQUM7UUFBYztRQUFhO1FBQWE7S0FBYTtJQUMzRUMscUJBQXFCO1FBQUM7UUFBYTtRQUFjO0tBQVk7QUFDL0QsRUFBVTtBQUVWLGdCQUFnQjtBQUNULE1BQU1DLE1BQU07SUFDakJDLGVBQWV0RztJQUNmdUcsZ0JBQWdCLENBQUMsS0FBSyxFQUFFdkcsU0FBUyxDQUFDO0lBQ2xDd0cscUJBQXFCdkc7SUFDckJ3RyxnQkFBZ0I7SUFDaEJDLFVBQVVDLFFBQVFDLEdBQUcsQ0FBQ0MsWUFBWSxJQUFJO0FBQ3hDLEVBQVU7QUFFVixpQkFBaUI7QUFDVixNQUFNQyxtQkFBbUI7SUFDOUJDLFNBQVM7SUFDVEMsVUFBVTtJQUNWQyxVQUFVO0lBQ1ZDLFFBQVE7QUFDVixFQUFVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8uL3NyYy9saWIvY29uc3RhbnRzLnRzP2ZiZjkiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQXBwbGljYXRpb24gY29uc3RhbnRzXG5leHBvcnQgY29uc3QgQVBQX05BTUUgPSAnUmF0ZU1lJ1xuZXhwb3J0IGNvbnN0IEFQUF9ERVNDUklQVElPTiA9ICdBIG1vZGVybiB2aWRlbyByYXRpbmcgcGxhdGZvcm0nXG5leHBvcnQgY29uc3QgQVBQX1ZFUlNJT04gPSAnMS4wLjAnXG5cbi8vIEFQSSBjb25zdGFudHNcbmV4cG9ydCBjb25zdCBBUElfUk9VVEVTID0ge1xuICBBVVRIOiB7XG4gICAgU0lHTklOOiAnL2FwaS9hdXRoL3NpZ25pbicsXG4gICAgU0lHTlVQOiAnL2FwaS9hdXRoL3JlZ2lzdGVyJyxcbiAgICBTSUdOT1VUOiAnL2FwaS9hdXRoL3NpZ25vdXQnLFxuICB9LFxuICBWSURFT1M6IHtcbiAgICBCQVNFOiAnL2FwaS92aWRlb3MnLFxuICAgIEJZX0lEOiAoaWQ6IHN0cmluZykgPT4gYC9hcGkvdmlkZW9zLyR7aWR9YCxcbiAgICBSQVRFOiAoaWQ6IHN0cmluZykgPT4gYC9hcGkvdmlkZW9zLyR7aWR9L3JhdGVgLFxuICB9LFxuICBVU0VSUzoge1xuICAgIEJBU0U6ICcvYXBpL3VzZXJzJyxcbiAgICBCWV9JRDogKGlkOiBzdHJpbmcpID0+IGAvYXBpL3VzZXJzLyR7aWR9YCxcbiAgICBGT0xMT1c6IChpZDogc3RyaW5nKSA9PiBgL2FwaS91c2Vycy8ke2lkfS9mb2xsb3dgLFxuICB9LFxufSBhcyBjb25zdFxuXG4vLyBVSSBjb25zdGFudHNcbmV4cG9ydCBjb25zdCBQQUdJTkFUSU9OID0ge1xuICBERUZBVUxUX1BBR0VfU0laRTogMTIsXG4gIE1BWF9QQUdFX1NJWkU6IDUwLFxufSBhcyBjb25zdFxuXG5leHBvcnQgY29uc3QgVklERU9fTElNSVRTID0ge1xuICBNQVhfVElUTEVfTEVOR1RIOiAyMDAsXG4gIE1BWF9ERVNDUklQVElPTl9MRU5HVEg6IDEwMDAsXG4gIC8vIFJlbW92ZWQgTUFYX1RBR1MgbGltaXQgdG8gYWxsb3cgdW5saW1pdGVkIHRhZ3Ncbn0gYXMgY29uc3RcblxuZXhwb3J0IGNvbnN0IFVTRVJfTElNSVRTID0ge1xuICBNSU5fVVNFUk5BTUVfTEVOR1RIOiAzLFxuICBNQVhfVVNFUk5BTUVfTEVOR1RIOiAzMCxcbiAgTUlOX1BBU1NXT1JEX0xFTkdUSDogNixcbiAgTUFYX1BBU1NXT1JEX0xFTkdUSDogMTI4LFxufSBhcyBjb25zdFxuXG4vLyBWYWxpZGF0aW9uIHBhdHRlcm5zXG5leHBvcnQgY29uc3QgVkFMSURBVElPTl9QQVRURVJOUyA9IHtcbiAgRU1BSUw6IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvLFxuICBVU0VSTkFNRTogL15bYS16QS1aMC05X117MywzMH0kLyxcbiAgWU9VVFVCRV9VUkw6IC8oPzpodHRwcz86XFwvXFwvKT8oPzp3d3dcXC4pPyg/OnlvdXR1YmVcXC5jb21cXC93YXRjaFxcP3Y9fHlvdXR1XFwuYmVcXC8pKFthLXpBLVowLTlfLV17MTF9KS8sXG4gIFZJTUVPX1VSTDogLyg/Omh0dHBzPzpcXC9cXC8pPyg/Ond3d1xcLik/dmltZW9cXC5jb21cXC8oXFxkKykvLFxufSBhcyBjb25zdFxuXG4vLyBFcnJvciBjb2Rlc1xuZXhwb3J0IGNvbnN0IEVSUk9SX0NPREVTID0ge1xuICAvLyBBdXRoZW50aWNhdGlvbiBlcnJvcnNcbiAgSU5WQUxJRF9DUkVERU5USUFMUzogJ0lOVkFMSURfQ1JFREVOVElBTFMnLFxuICBVU0VSX05PVF9GT1VORDogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgVVNFUl9BTFJFQURZX0VYSVNUUzogJ1VTRVJfQUxSRUFEWV9FWElTVFMnLFxuICBVTkFVVEhPUklaRUQ6ICdVTkFVVEhPUklaRUQnLFxuICBTRVNTSU9OX0VYUElSRUQ6ICdTRVNTSU9OX0VYUElSRUQnLFxuXG4gIC8vIFZhbGlkYXRpb24gZXJyb3JzXG4gIFZBTElEQVRJT05fRVJST1I6ICdWQUxJREFUSU9OX0VSUk9SJyxcbiAgSU5WQUxJRF9JTlBVVDogJ0lOVkFMSURfSU5QVVQnLFxuICBNSVNTSU5HX1JFUVVJUkVEX0ZJRUxEOiAnTUlTU0lOR19SRVFVSVJFRF9GSUVMRCcsXG5cbiAgLy8gUmVzb3VyY2UgZXJyb3JzXG4gIFJFU09VUkNFX05PVF9GT1VORDogJ1JFU09VUkNFX05PVF9GT1VORCcsXG4gIFJFU09VUkNFX0FMUkVBRFlfRVhJU1RTOiAnUkVTT1VSQ0VfQUxSRUFEWV9FWElTVFMnLFxuICBSRVNPVVJDRV9GT1JCSURERU46ICdSRVNPVVJDRV9GT1JCSURERU4nLFxuXG4gIC8vIFNlcnZlciBlcnJvcnNcbiAgSU5URVJOQUxfU0VSVkVSX0VSUk9SOiAnSU5URVJOQUxfU0VSVkVSX0VSUk9SJyxcbiAgREFUQUJBU0VfRVJST1I6ICdEQVRBQkFTRV9FUlJPUicsXG4gIEVYVEVSTkFMX1NFUlZJQ0VfRVJST1I6ICdFWFRFUk5BTF9TRVJWSUNFX0VSUk9SJyxcblxuICAvLyBSYXRlIGxpbWl0aW5nXG4gIFJBVEVfTElNSVRfRVhDRUVERUQ6ICdSQVRFX0xJTUlUX0VYQ0VFREVEJyxcbn0gYXMgY29uc3RcblxuLy8gSFRUUCBzdGF0dXMgY29kZXNcbmV4cG9ydCBjb25zdCBIVFRQX1NUQVRVUyA9IHtcbiAgT0s6IDIwMCxcbiAgQ1JFQVRFRDogMjAxLFxuICBOT19DT05URU5UOiAyMDQsXG4gIEJBRF9SRVFVRVNUOiA0MDAsXG4gIFVOQVVUSE9SSVpFRDogNDAxLFxuICBGT1JCSURERU46IDQwMyxcbiAgTk9UX0ZPVU5EOiA0MDQsXG4gIE1FVEhPRF9OT1RfQUxMT1dFRDogNDA1LFxuICBDT05GTElDVDogNDA5LFxuICBVTlBST0NFU1NBQkxFX0VOVElUWTogNDIyLFxuICBUT09fTUFOWV9SRVFVRVNUUzogNDI5LFxuICBJTlRFUk5BTF9TRVJWRVJfRVJST1I6IDUwMCxcbiAgQkFEX0dBVEVXQVk6IDUwMixcbiAgU0VSVklDRV9VTkFWQUlMQUJMRTogNTAzLFxufSBhcyBjb25zdFxuXG4vLyBDYWNoZSBrZXlzXG5leHBvcnQgY29uc3QgQ0FDSEVfS0VZUyA9IHtcbiAgVklERU9TOiAndmlkZW9zJyxcbiAgVVNFUjogKGlkOiBzdHJpbmcpID0+IGB1c2VyOiR7aWR9YCxcbiAgVklERU86IChpZDogc3RyaW5nKSA9PiBgdmlkZW86JHtpZH1gLFxuICBUQUdTOiAndGFncycsXG4gIFVTRVJfVklERU9TOiAodXNlcklkOiBzdHJpbmcpID0+IGB1c2VyOiR7dXNlcklkfTp2aWRlb3NgLFxufSBhcyBjb25zdFxuXG4vLyBDYWNoZSBUVEwgKGluIHNlY29uZHMpXG5leHBvcnQgY29uc3QgQ0FDSEVfVFRMID0ge1xuICBTSE9SVDogMzAwLCAvLyA1IG1pbnV0ZXNcbiAgTUVESVVNOiAxODAwLCAvLyAzMCBtaW51dGVzXG4gIExPTkc6IDM2MDAsIC8vIDEgaG91clxuICBWRVJZX0xPTkc6IDg2NDAwLCAvLyAyNCBob3Vyc1xufSBhcyBjb25zdFxuXG4vLyBFbnZpcm9ubWVudCB0eXBlc1xuZXhwb3J0IGNvbnN0IE5PREVfRU5WID0ge1xuICBERVZFTE9QTUVOVDogJ2RldmVsb3BtZW50JyxcbiAgUFJPRFVDVElPTjogJ3Byb2R1Y3Rpb24nLFxuICBURVNUOiAndGVzdCcsXG59IGFzIGNvbnN0XG5cbi8vIFN1cHBvcnRlZCB2aWRlbyBwbGF0Zm9ybXNcbmV4cG9ydCBjb25zdCBWSURFT19QTEFURk9STVMgPSB7XG4gIFlPVVRVQkU6ICd5b3V0dWJlJyxcbiAgVklNRU86ICd2aW1lbycsXG59IGFzIGNvbnN0XG5cbi8vIFJhdGluZyBsZXZlbHNcbmV4cG9ydCBjb25zdCBSQVRJTkdfTEVWRUxTID0ge1xuICBNSU46IDEsXG4gIE1BWDogNSxcbiAgREVGQVVMVDogMyxcbn0gYXMgY29uc3RcblxuLy8gRGVmYXVsdCB2YWx1ZXNcbmV4cG9ydCBjb25zdCBERUZBVUxUUyA9IHtcbiAgQVZBVEFSX1VSTDogJy9pbWFnZXMvZGVmYXVsdC1hdmF0YXIucG5nJyxcbiAgVklERU9fVEhVTUJOQUlMOiAnL2ltYWdlcy9kZWZhdWx0LXZpZGVvLXRodW1ibmFpbC5wbmcnLFxuICBQQUdJTkFUSU9OX0xJTUlUOiBQQUdJTkFUSU9OLkRFRkFVTFRfUEFHRV9TSVpFLFxuICBSQVRJTkdfTEVWRUw6IFJBVElOR19MRVZFTFMuREVGQVVMVCxcbn0gYXMgY29uc3RcblxuLy8gRmVhdHVyZSBmbGFnc1xuZXhwb3J0IGNvbnN0IEZFQVRVUkVTID0ge1xuICBWSURFT19VUExPQUQ6IHRydWUsXG4gIFVTRVJfUkVHSVNUUkFUSU9OOiB0cnVlLFxuICBWSURFT19SQVRJTkc6IHRydWUsXG4gIFVTRVJfRk9MTE9XSU5HOiB0cnVlLFxuICBTRUFSQ0g6IHRydWUsXG4gIEFETUlOX1BBTkVMOiBmYWxzZSxcbn0gYXMgY29uc3RcblxuLy8gRXh0ZXJuYWwgc2VydmljZSBVUkxzXG5leHBvcnQgY29uc3QgRVhURVJOQUxfU0VSVklDRVMgPSB7XG4gIFlPVVRVQkVfQVBJOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20veW91dHViZS92MycsXG4gIFZJTUVPX0FQSTogJ2h0dHBzOi8vYXBpLnZpbWVvLmNvbScsXG59IGFzIGNvbnN0XG5cbi8vIEZpbGUgdXBsb2FkIGxpbWl0c1xuZXhwb3J0IGNvbnN0IFVQTE9BRF9MSU1JVFMgPSB7XG4gIE1BWF9GSUxFX1NJWkU6IDEwICogMTAyNCAqIDEwMjQsIC8vIDEwTUJcbiAgQUxMT1dFRF9JTUFHRV9UWVBFUzogWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9naWYnLCAnaW1hZ2Uvd2VicCddLFxuICBBTExPV0VEX1ZJREVPX1RZUEVTOiBbJ3ZpZGVvL21wNCcsICd2aWRlby93ZWJtJywgJ3ZpZGVvL29nZyddLFxufSBhcyBjb25zdFxuXG4vLyBTRU8gY29uc3RhbnRzXG5leHBvcnQgY29uc3QgU0VPID0ge1xuICBERUZBVUxUX1RJVExFOiBBUFBfTkFNRSxcbiAgVElUTEVfVEVNUExBVEU6IGAlcyB8ICR7QVBQX05BTUV9YCxcbiAgREVGQVVMVF9ERVNDUklQVElPTjogQVBQX0RFU0NSSVBUSU9OLFxuICBUV0lUVEVSX0hBTkRMRTogJ0ByYXRlbWUnLFxuICBTSVRFX1VSTDogcHJvY2Vzcy5lbnYuTkVYVEFVVEhfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnLFxufSBhcyBjb25zdFxuXG4vLyBTb2NpYWwgc2hhcmluZ1xuZXhwb3J0IGNvbnN0IFNPQ0lBTF9QTEFURk9STVMgPSB7XG4gIFRXSVRURVI6ICd0d2l0dGVyJyxcbiAgRkFDRUJPT0s6ICdmYWNlYm9vaycsXG4gIExJTktFRElOOiAnbGlua2VkaW4nLFxuICBSRURESVQ6ICdyZWRkaXQnLFxufSBhcyBjb25zdCJdLCJuYW1lcyI6WyJBUFBfTkFNRSIsIkFQUF9ERVNDUklQVElPTiIsIkFQUF9WRVJTSU9OIiwiQVBJX1JPVVRFUyIsIkFVVEgiLCJTSUdOSU4iLCJTSUdOVVAiLCJTSUdOT1VUIiwiVklERU9TIiwiQkFTRSIsIkJZX0lEIiwiaWQiLCJSQVRFIiwiVVNFUlMiLCJGT0xMT1ciLCJQQUdJTkFUSU9OIiwiREVGQVVMVF9QQUdFX1NJWkUiLCJNQVhfUEFHRV9TSVpFIiwiVklERU9fTElNSVRTIiwiTUFYX1RJVExFX0xFTkdUSCIsIk1BWF9ERVNDUklQVElPTl9MRU5HVEgiLCJVU0VSX0xJTUlUUyIsIk1JTl9VU0VSTkFNRV9MRU5HVEgiLCJNQVhfVVNFUk5BTUVfTEVOR1RIIiwiTUlOX1BBU1NXT1JEX0xFTkdUSCIsIk1BWF9QQVNTV09SRF9MRU5HVEgiLCJWQUxJREFUSU9OX1BBVFRFUk5TIiwiRU1BSUwiLCJVU0VSTkFNRSIsIllPVVRVQkVfVVJMIiwiVklNRU9fVVJMIiwiRVJST1JfQ09ERVMiLCJJTlZBTElEX0NSRURFTlRJQUxTIiwiVVNFUl9OT1RfRk9VTkQiLCJVU0VSX0FMUkVBRFlfRVhJU1RTIiwiVU5BVVRIT1JJWkVEIiwiU0VTU0lPTl9FWFBJUkVEIiwiVkFMSURBVElPTl9FUlJPUiIsIklOVkFMSURfSU5QVVQiLCJNSVNTSU5HX1JFUVVJUkVEX0ZJRUxEIiwiUkVTT1VSQ0VfTk9UX0ZPVU5EIiwiUkVTT1VSQ0VfQUxSRUFEWV9FWElTVFMiLCJSRVNPVVJDRV9GT1JCSURERU4iLCJJTlRFUk5BTF9TRVJWRVJfRVJST1IiLCJEQVRBQkFTRV9FUlJPUiIsIkVYVEVSTkFMX1NFUlZJQ0VfRVJST1IiLCJSQVRFX0xJTUlUX0VYQ0VFREVEIiwiSFRUUF9TVEFUVVMiLCJPSyIsIkNSRUFURUQiLCJOT19DT05URU5UIiwiQkFEX1JFUVVFU1QiLCJGT1JCSURERU4iLCJOT1RfRk9VTkQiLCJNRVRIT0RfTk9UX0FMTE9XRUQiLCJDT05GTElDVCIsIlVOUFJPQ0VTU0FCTEVfRU5USVRZIiwiVE9PX01BTllfUkVRVUVTVFMiLCJCQURfR0FURVdBWSIsIlNFUlZJQ0VfVU5BVkFJTEFCTEUiLCJDQUNIRV9LRVlTIiwiVVNFUiIsIlZJREVPIiwiVEFHUyIsIlVTRVJfVklERU9TIiwidXNlcklkIiwiQ0FDSEVfVFRMIiwiU0hPUlQiLCJNRURJVU0iLCJMT05HIiwiVkVSWV9MT05HIiwiTk9ERV9FTlYiLCJERVZFTE9QTUVOVCIsIlBST0RVQ1RJT04iLCJURVNUIiwiVklERU9fUExBVEZPUk1TIiwiWU9VVFVCRSIsIlZJTUVPIiwiUkFUSU5HX0xFVkVMUyIsIk1JTiIsIk1BWCIsIkRFRkFVTFQiLCJERUZBVUxUUyIsIkFWQVRBUl9VUkwiLCJWSURFT19USFVNQk5BSUwiLCJQQUdJTkFUSU9OX0xJTUlUIiwiUkFUSU5HX0xFVkVMIiwiRkVBVFVSRVMiLCJWSURFT19VUExPQUQiLCJVU0VSX1JFR0lTVFJBVElPTiIsIlZJREVPX1JBVElORyIsIlVTRVJfRk9MTE9XSU5HIiwiU0VBUkNIIiwiQURNSU5fUEFORUwiLCJFWFRFUk5BTF9TRVJWSUNFUyIsIllPVVRVQkVfQVBJIiwiVklNRU9fQVBJIiwiVVBMT0FEX0xJTUlUUyIsIk1BWF9GSUxFX1NJWkUiLCJBTExPV0VEX0lNQUdFX1RZUEVTIiwiQUxMT1dFRF9WSURFT19UWVBFUyIsIlNFTyIsIkRFRkFVTFRfVElUTEUiLCJUSVRMRV9URU1QTEFURSIsIkRFRkFVTFRfREVTQ1JJUFRJT04iLCJUV0lUVEVSX0hBTkRMRSIsIlNJVEVfVVJMIiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1VSTCIsIlNPQ0lBTF9QTEFURk9STVMiLCJUV0lUVEVSIiwiRkFDRUJPT0siLCJMSU5LRURJTiIsIlJFRERJVCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/constants.ts\n");

/***/ }),

/***/ "(api)/./src/lib/db.ts":
/*!***********************!*\
  !*** ./src/lib/db.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   db: () => (/* binding */ db)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst globalForPrisma = globalThis;\nconst db = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = db;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2RiLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE2QztBQUU3QyxNQUFNQyxrQkFBa0JDO0FBSWpCLE1BQU1DLEtBQUtGLGdCQUFnQkcsTUFBTSxJQUFJLElBQUlKLHdEQUFZQSxHQUFFO0FBRTlELElBQUlLLElBQXlCLEVBQWNKLGdCQUFnQkcsTUFBTSxHQUFHRCIsInNvdXJjZXMiOlsid2VicGFjazovL3JhdGVteS1uZXh0anMvLi9zcmMvbGliL2RiLnRzPzllNGYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCBkYiA9IGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPz8gbmV3IFByaXNtYUNsaWVudCgpXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID0gZGIiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwiZ2xvYmFsRm9yUHJpc21hIiwiZ2xvYmFsVGhpcyIsImRiIiwicHJpc21hIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/db.ts\n");

/***/ }),

/***/ "(api)/./src/lib/errors.ts":
/*!***************************!*\
  !*** ./src/lib/errors.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AppError: () => (/* binding */ AppError),\n/* harmony export */   AuthenticationError: () => (/* binding */ AuthenticationError),\n/* harmony export */   AuthorizationError: () => (/* binding */ AuthorizationError),\n/* harmony export */   ConflictError: () => (/* binding */ ConflictError),\n/* harmony export */   DatabaseError: () => (/* binding */ DatabaseError),\n/* harmony export */   ExternalServiceError: () => (/* binding */ ExternalServiceError),\n/* harmony export */   NotFoundError: () => (/* binding */ NotFoundError),\n/* harmony export */   RateLimitError: () => (/* binding */ RateLimitError),\n/* harmony export */   ValidationError: () => (/* binding */ ValidationError),\n/* harmony export */   asyncWrapper: () => (/* binding */ asyncWrapper),\n/* harmony export */   createConflictError: () => (/* binding */ createConflictError),\n/* harmony export */   createNotFoundError: () => (/* binding */ createNotFoundError),\n/* harmony export */   createValidationError: () => (/* binding */ createValidationError),\n/* harmony export */   extractErrorCode: () => (/* binding */ extractErrorCode),\n/* harmony export */   extractErrorMessage: () => (/* binding */ extractErrorMessage),\n/* harmony export */   extractStatusCode: () => (/* binding */ extractStatusCode),\n/* harmony export */   handlePromiseRejection: () => (/* binding */ handlePromiseRejection),\n/* harmony export */   isAppError: () => (/* binding */ isAppError),\n/* harmony export */   isOperationalError: () => (/* binding */ isOperationalError),\n/* harmony export */   serializeError: () => (/* binding */ serializeError)\n/* harmony export */ });\n/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ \"(api)/./src/lib/constants.ts\");\n\nclass AppError extends Error {\n    constructor(message, code = _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.INTERNAL_SERVER_ERROR, statusCode = _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.INTERNAL_SERVER_ERROR, isOperational = true, context){\n        super(message);\n        this.name = this.constructor.name;\n        this.code = code;\n        this.statusCode = statusCode;\n        this.isOperational = isOperational;\n        this.context = context;\n        Error.captureStackTrace(this, this.constructor);\n    }\n}\n// Specific error classes\nclass ValidationError extends AppError {\n    constructor(message, field, context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.VALIDATION_ERROR, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.BAD_REQUEST, true, {\n            field,\n            ...context\n        });\n    }\n}\nclass AuthenticationError extends AppError {\n    constructor(message = \"Authentication failed\", context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.UNAUTHORIZED, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.UNAUTHORIZED, true, context);\n    }\n}\nclass AuthorizationError extends AppError {\n    constructor(message = \"Access forbidden\", context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.RESOURCE_FORBIDDEN, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.FORBIDDEN, true, context);\n    }\n}\nclass NotFoundError extends AppError {\n    constructor(resource = \"Resource\", context){\n        super(`${resource} not found`, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.RESOURCE_NOT_FOUND, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.NOT_FOUND, true, context);\n    }\n}\nclass ConflictError extends AppError {\n    constructor(message, context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.RESOURCE_ALREADY_EXISTS, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.CONFLICT, true, context);\n    }\n}\nclass DatabaseError extends AppError {\n    constructor(message, context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.DATABASE_ERROR, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.INTERNAL_SERVER_ERROR, true, context);\n    }\n}\nclass ExternalServiceError extends AppError {\n    constructor(service, message, context){\n        super(`External service error (${service}): ${message}`, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.EXTERNAL_SERVICE_ERROR, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.BAD_GATEWAY, true, context);\n    }\n}\nclass RateLimitError extends AppError {\n    constructor(message = \"Rate limit exceeded\", context){\n        super(message, _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.RATE_LIMIT_EXCEEDED, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.TOO_MANY_REQUESTS, true, context);\n    }\n}\n// Error factory functions\nfunction createValidationError(field, message, value) {\n    return new ValidationError(message, field, {\n        value\n    });\n}\nfunction createNotFoundError(resource, id) {\n    return new NotFoundError(resource, {\n        id\n    });\n}\nfunction createConflictError(resource, field, value) {\n    return new ConflictError(`${resource} with ${field} '${value}' already exists`, {\n        resource,\n        field,\n        value\n    });\n}\n// Error handling utilities\nfunction isAppError(error) {\n    return error instanceof AppError;\n}\nfunction isOperationalError(error) {\n    if (isAppError(error)) {\n        return error.isOperational;\n    }\n    return false;\n}\nfunction extractErrorMessage(error) {\n    if (error instanceof Error) {\n        return error.message;\n    }\n    if (typeof error === \"string\") {\n        return error;\n    }\n    return \"An unknown error occurred\";\n}\nfunction extractErrorCode(error) {\n    if (isAppError(error)) {\n        return error.code;\n    }\n    return _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.INTERNAL_SERVER_ERROR;\n}\nfunction extractStatusCode(error) {\n    if (isAppError(error)) {\n        return error.statusCode;\n    }\n    return _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.INTERNAL_SERVER_ERROR;\n}\nfunction serializeError(error, includeStack = false) {\n    const serialized = {\n        message: extractErrorMessage(error),\n        code: extractErrorCode(error),\n        statusCode: extractStatusCode(error)\n    };\n    if (isAppError(error) && error.context) {\n        serialized.context = error.context;\n    }\n    if (includeStack && error instanceof Error) {\n        serialized.stack = error.stack;\n    }\n    return serialized;\n}\n// Async error wrapper\nfunction asyncWrapper(fn) {\n    return async (...args)=>{\n        try {\n            return await fn(...args);\n        } catch (error) {\n            if (isOperationalError(error)) {\n                throw error;\n            }\n            // Convert non-operational errors to operational ones\n            throw new AppError(extractErrorMessage(error), _constants__WEBPACK_IMPORTED_MODULE_0__.ERROR_CODES.INTERNAL_SERVER_ERROR, _constants__WEBPACK_IMPORTED_MODULE_0__.HTTP_STATUS.INTERNAL_SERVER_ERROR, false, {\n                originalError: error\n            });\n        }\n    };\n}\n// Promise error handler\nfunction handlePromiseRejection(promise) {\n    return promise.catch((error)=>{\n        if (!isOperationalError(error)) {\n            // Log unexpected errors\n            console.error(\"Unhandled promise rejection:\", error);\n        }\n        throw error;\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBcUI7QUFDMUM7QUFXTyxTQUFTMEMsZUFBZUwsS0FBVSxFQUFFTSxlQUF3QixLQUFLO0lBQ3RFLE1BQU1DLGFBQThCO1FBQ2xDOUMsU0FBU3lDLG9CQUFvQkY7UUFDN0J0QyxNQUFNeUMsaUJBQWlCSDtRQUN2QnBDLFlBQVl3QyxrQkFBa0JKO0lBQ2hDO0lBRUEsSUFBSUQsV0FBV0MsVUFBVUEsTUFBTWxDLE9BQU8sRUFBRTtRQUN0Q3lDLFdBQVd6QyxPQUFPLEdBQUdrQyxNQUFNbEMsT0FBTztJQUNwQztJQUVBLElBQUl3QyxnQkFBZ0JOLGlCQUFpQnpDLE9BQU87UUFDMUNnRCxXQUFXQyxLQUFLLEdBQUdSLE1BQU1RLEtBQUs7SUFDaEM7SUFFQSxPQUFPRDtBQUNUO0FBRUEsc0JBQXNCO0FBQ2YsU0FBU0UsYUFDZEMsRUFBOEI7SUFFOUIsT0FBTyxPQUFPLEdBQUdDO1FBQ2YsSUFBSTtZQUNGLE9BQU8sTUFBTUQsTUFBTUM7UUFDckIsRUFBRSxPQUFPWCxPQUFPO1lBQ2QsSUFBSUMsbUJBQW1CRCxRQUFRO2dCQUM3QixNQUFNQTtZQUNSO1lBRUEscURBQXFEO1lBQ3JELE1BQU0sSUFBSTFDLFNBQ1I0QyxvQkFBb0JGLFFBQ3BCNUMsbURBQVdBLENBQUNPLHFCQUFxQixFQUNqQ04sbURBQVdBLENBQUNNLHFCQUFxQixFQUNqQyxPQUNBO2dCQUFFaUQsZUFBZVo7WUFBTTtRQUUzQjtJQUNGO0FBQ0Y7QUFFQSx3QkFBd0I7QUFDakIsU0FBU2EsdUJBQXVCQyxPQUFxQjtJQUMxRCxPQUFPQSxRQUFRQyxLQUFLLENBQUMsQ0FBQ2Y7UUFDcEIsSUFBSSxDQUFDQyxtQkFBbUJELFFBQVE7WUFDOUIsd0JBQXdCO1lBQ3hCZ0IsUUFBUWhCLEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQ2hEO1FBQ0EsTUFBTUE7SUFDUjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8uL3NyYy9saWIvZXJyb3JzLnRzPzQ1MWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRVJST1JfQ09ERVMsIEhUVFBfU1RBVFVTIH0gZnJvbSAnLi9jb25zdGFudHMnXG5cbmV4cG9ydCBjbGFzcyBBcHBFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHJlYWRvbmx5IGNvZGU6IHN0cmluZ1xuICBwdWJsaWMgcmVhZG9ubHkgc3RhdHVzQ29kZTogbnVtYmVyXG4gIHB1YmxpYyByZWFkb25seSBpc09wZXJhdGlvbmFsOiBib29sZWFuXG4gIHB1YmxpYyByZWFkb25seSBjb250ZXh0PzogYW55XG5cbiAgY29uc3RydWN0b3IoXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGNvZGU6IHN0cmluZyA9IEVSUk9SX0NPREVTLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICBzdGF0dXNDb2RlOiBudW1iZXIgPSBIVFRQX1NUQVRVUy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgaXNPcGVyYXRpb25hbDogYm9vbGVhbiA9IHRydWUsXG4gICAgY29udGV4dD86IGFueVxuICApIHtcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIFxuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZVxuICAgIHRoaXMuY29kZSA9IGNvZGVcbiAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlXG4gICAgdGhpcy5pc09wZXJhdGlvbmFsID0gaXNPcGVyYXRpb25hbFxuICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHRcblxuICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIHRoaXMuY29uc3RydWN0b3IpXG4gIH1cbn1cblxuLy8gU3BlY2lmaWMgZXJyb3IgY2xhc3Nlc1xuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nLCBmaWVsZD86IHN0cmluZywgY29udGV4dD86IGFueSkge1xuICAgIHN1cGVyKFxuICAgICAgbWVzc2FnZSxcbiAgICAgIEVSUk9SX0NPREVTLlZBTElEQVRJT05fRVJST1IsXG4gICAgICBIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCxcbiAgICAgIHRydWUsXG4gICAgICB7IGZpZWxkLCAuLi5jb250ZXh0IH1cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEF1dGhlbnRpY2F0aW9uRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZyA9ICdBdXRoZW50aWNhdGlvbiBmYWlsZWQnLCBjb250ZXh0PzogYW55KSB7XG4gICAgc3VwZXIoXG4gICAgICBtZXNzYWdlLFxuICAgICAgRVJST1JfQ09ERVMuVU5BVVRIT1JJWkVELFxuICAgICAgSFRUUF9TVEFUVVMuVU5BVVRIT1JJWkVELFxuICAgICAgdHJ1ZSxcbiAgICAgIGNvbnRleHRcbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEF1dGhvcml6YXRpb25FcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ0FjY2VzcyBmb3JiaWRkZW4nLCBjb250ZXh0PzogYW55KSB7XG4gICAgc3VwZXIoXG4gICAgICBtZXNzYWdlLFxuICAgICAgRVJST1JfQ09ERVMuUkVTT1VSQ0VfRk9SQklEREVOLFxuICAgICAgSFRUUF9TVEFUVVMuRk9SQklEREVOLFxuICAgICAgdHJ1ZSxcbiAgICAgIGNvbnRleHRcbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5vdEZvdW5kRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKHJlc291cmNlOiBzdHJpbmcgPSAnUmVzb3VyY2UnLCBjb250ZXh0PzogYW55KSB7XG4gICAgc3VwZXIoXG4gICAgICBgJHtyZXNvdXJjZX0gbm90IGZvdW5kYCxcbiAgICAgIEVSUk9SX0NPREVTLlJFU09VUkNFX05PVF9GT1VORCxcbiAgICAgIEhUVFBfU1RBVFVTLk5PVF9GT1VORCxcbiAgICAgIHRydWUsXG4gICAgICBjb250ZXh0XG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25mbGljdEVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBhbnkpIHtcbiAgICBzdXBlcihcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBFUlJPUl9DT0RFUy5SRVNPVVJDRV9BTFJFQURZX0VYSVNUUyxcbiAgICAgIEhUVFBfU1RBVFVTLkNPTkZMSUNULFxuICAgICAgdHJ1ZSxcbiAgICAgIGNvbnRleHRcbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIERhdGFiYXNlRXJyb3IgZXh0ZW5kcyBBcHBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IGFueSkge1xuICAgIHN1cGVyKFxuICAgICAgbWVzc2FnZSxcbiAgICAgIEVSUk9SX0NPREVTLkRBVEFCQVNFX0VSUk9SLFxuICAgICAgSFRUUF9TVEFUVVMuSU5URVJOQUxfU0VSVkVSX0VSUk9SLFxuICAgICAgdHJ1ZSxcbiAgICAgIGNvbnRleHRcbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV4dGVybmFsU2VydmljZUVycm9yIGV4dGVuZHMgQXBwRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihzZXJ2aWNlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IGFueSkge1xuICAgIHN1cGVyKFxuICAgICAgYEV4dGVybmFsIHNlcnZpY2UgZXJyb3IgKCR7c2VydmljZX0pOiAke21lc3NhZ2V9YCxcbiAgICAgIEVSUk9SX0NPREVTLkVYVEVSTkFMX1NFUlZJQ0VfRVJST1IsXG4gICAgICBIVFRQX1NUQVRVUy5CQURfR0FURVdBWSxcbiAgICAgIHRydWUsXG4gICAgICBjb250ZXh0XG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSYXRlTGltaXRFcnJvciBleHRlbmRzIEFwcEVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZTogc3RyaW5nID0gJ1JhdGUgbGltaXQgZXhjZWVkZWQnLCBjb250ZXh0PzogYW55KSB7XG4gICAgc3VwZXIoXG4gICAgICBtZXNzYWdlLFxuICAgICAgRVJST1JfQ09ERVMuUkFURV9MSU1JVF9FWENFRURFRCxcbiAgICAgIEhUVFBfU1RBVFVTLlRPT19NQU5ZX1JFUVVFU1RTLFxuICAgICAgdHJ1ZSxcbiAgICAgIGNvbnRleHRcbiAgICApXG4gIH1cbn1cblxuLy8gRXJyb3IgZmFjdG9yeSBmdW5jdGlvbnNcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVWYWxpZGF0aW9uRXJyb3IoZmllbGQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCB2YWx1ZT86IGFueSk6IFZhbGlkYXRpb25FcnJvciB7XG4gIHJldHVybiBuZXcgVmFsaWRhdGlvbkVycm9yKG1lc3NhZ2UsIGZpZWxkLCB7IHZhbHVlIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVOb3RGb3VuZEVycm9yKHJlc291cmNlOiBzdHJpbmcsIGlkPzogc3RyaW5nKTogTm90Rm91bmRFcnJvciB7XG4gIHJldHVybiBuZXcgTm90Rm91bmRFcnJvcihyZXNvdXJjZSwgeyBpZCB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uZmxpY3RFcnJvcihyZXNvdXJjZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nLCB2YWx1ZTogYW55KTogQ29uZmxpY3RFcnJvciB7XG4gIHJldHVybiBuZXcgQ29uZmxpY3RFcnJvcihcbiAgICBgJHtyZXNvdXJjZX0gd2l0aCAke2ZpZWxkfSAnJHt2YWx1ZX0nIGFscmVhZHkgZXhpc3RzYCxcbiAgICB7IHJlc291cmNlLCBmaWVsZCwgdmFsdWUgfVxuICApXG59XG5cbi8vIEVycm9yIGhhbmRsaW5nIHV0aWxpdGllc1xuZXhwb3J0IGZ1bmN0aW9uIGlzQXBwRXJyb3IoZXJyb3I6IGFueSk6IGVycm9yIGlzIEFwcEVycm9yIHtcbiAgcmV0dXJuIGVycm9yIGluc3RhbmNlb2YgQXBwRXJyb3Jcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzT3BlcmF0aW9uYWxFcnJvcihlcnJvcjogYW55KTogYm9vbGVhbiB7XG4gIGlmIChpc0FwcEVycm9yKGVycm9yKSkge1xuICAgIHJldHVybiBlcnJvci5pc09wZXJhdGlvbmFsXG4gIH1cbiAgcmV0dXJuIGZhbHNlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0RXJyb3JNZXNzYWdlKGVycm9yOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIHJldHVybiBlcnJvci5tZXNzYWdlXG4gIH1cbiAgaWYgKHR5cGVvZiBlcnJvciA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gZXJyb3JcbiAgfVxuICByZXR1cm4gJ0FuIHVua25vd24gZXJyb3Igb2NjdXJyZWQnXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0RXJyb3JDb2RlKGVycm9yOiBhbnkpOiBzdHJpbmcge1xuICBpZiAoaXNBcHBFcnJvcihlcnJvcikpIHtcbiAgICByZXR1cm4gZXJyb3IuY29kZVxuICB9XG4gIHJldHVybiBFUlJPUl9DT0RFUy5JTlRFUk5BTF9TRVJWRVJfRVJST1Jcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RTdGF0dXNDb2RlKGVycm9yOiBhbnkpOiBudW1iZXIge1xuICBpZiAoaXNBcHBFcnJvcihlcnJvcikpIHtcbiAgICByZXR1cm4gZXJyb3Iuc3RhdHVzQ29kZVxuICB9XG4gIHJldHVybiBIVFRQX1NUQVRVUy5JTlRFUk5BTF9TRVJWRVJfRVJST1Jcbn1cblxuLy8gRXJyb3Igc2VyaWFsaXphdGlvblxuZXhwb3J0IGludGVyZmFjZSBTZXJpYWxpemVkRXJyb3Ige1xuICBtZXNzYWdlOiBzdHJpbmdcbiAgY29kZTogc3RyaW5nXG4gIHN0YXR1c0NvZGU6IG51bWJlclxuICBjb250ZXh0PzogYW55XG4gIHN0YWNrPzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVFcnJvcihlcnJvcjogYW55LCBpbmNsdWRlU3RhY2s6IGJvb2xlYW4gPSBmYWxzZSk6IFNlcmlhbGl6ZWRFcnJvciB7XG4gIGNvbnN0IHNlcmlhbGl6ZWQ6IFNlcmlhbGl6ZWRFcnJvciA9IHtcbiAgICBtZXNzYWdlOiBleHRyYWN0RXJyb3JNZXNzYWdlKGVycm9yKSxcbiAgICBjb2RlOiBleHRyYWN0RXJyb3JDb2RlKGVycm9yKSxcbiAgICBzdGF0dXNDb2RlOiBleHRyYWN0U3RhdHVzQ29kZShlcnJvciksXG4gIH1cblxuICBpZiAoaXNBcHBFcnJvcihlcnJvcikgJiYgZXJyb3IuY29udGV4dCkge1xuICAgIHNlcmlhbGl6ZWQuY29udGV4dCA9IGVycm9yLmNvbnRleHRcbiAgfVxuXG4gIGlmIChpbmNsdWRlU3RhY2sgJiYgZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIHNlcmlhbGl6ZWQuc3RhY2sgPSBlcnJvci5zdGFja1xuICB9XG5cbiAgcmV0dXJuIHNlcmlhbGl6ZWRcbn1cblxuLy8gQXN5bmMgZXJyb3Igd3JhcHBlclxuZXhwb3J0IGZ1bmN0aW9uIGFzeW5jV3JhcHBlcjxUIGV4dGVuZHMgYW55W10sIFI+KFxuICBmbjogKC4uLmFyZ3M6IFQpID0+IFByb21pc2U8Uj5cbikge1xuICByZXR1cm4gYXN5bmMgKC4uLmFyZ3M6IFQpOiBQcm9taXNlPFI+ID0+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGZuKC4uLmFyZ3MpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChpc09wZXJhdGlvbmFsRXJyb3IoZXJyb3IpKSB7XG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENvbnZlcnQgbm9uLW9wZXJhdGlvbmFsIGVycm9ycyB0byBvcGVyYXRpb25hbCBvbmVzXG4gICAgICB0aHJvdyBuZXcgQXBwRXJyb3IoXG4gICAgICAgIGV4dHJhY3RFcnJvck1lc3NhZ2UoZXJyb3IpLFxuICAgICAgICBFUlJPUl9DT0RFUy5JTlRFUk5BTF9TRVJWRVJfRVJST1IsXG4gICAgICAgIEhUVFBfU1RBVFVTLklOVEVSTkFMX1NFUlZFUl9FUlJPUixcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHsgb3JpZ2luYWxFcnJvcjogZXJyb3IgfVxuICAgICAgKVxuICAgIH1cbiAgfVxufVxuXG4vLyBQcm9taXNlIGVycm9yIGhhbmRsZXJcbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVQcm9taXNlUmVqZWN0aW9uKHByb21pc2U6IFByb21pc2U8YW55Pik6IFByb21pc2U8YW55PiB7XG4gIHJldHVybiBwcm9taXNlLmNhdGNoKChlcnJvcikgPT4ge1xuICAgIGlmICghaXNPcGVyYXRpb25hbEVycm9yKGVycm9yKSkge1xuICAgICAgLy8gTG9nIHVuZXhwZWN0ZWQgZXJyb3JzXG4gICAgICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb246JywgZXJyb3IpXG4gICAgfVxuICAgIHRocm93IGVycm9yXG4gIH0pXG59Il0sIm5hbWVzIjpbIkVSUk9SX0NPREVTIiwiSFRUUF9TVEFUVVMiLCJBcHBFcnJvciIsIkVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwiY29kZSIsIklOVEVSTkFMX1NFUlZFUl9FUlJPUiIsInN0YXR1c0NvZGUiLCJpc09wZXJhdGlvbmFsIiwiY29udGV4dCIsIm5hbWUiLCJjYXB0dXJlU3RhY2tUcmFjZSIsIlZhbGlkYXRpb25FcnJvciIsImZpZWxkIiwiVkFMSURBVElPTl9FUlJPUiIsIkJBRF9SRVFVRVNUIiwiQXV0aGVudGljYXRpb25FcnJvciIsIlVOQVVUSE9SSVpFRCIsIkF1dGhvcml6YXRpb25FcnJvciIsIlJFU09VUkNFX0ZPUkJJRERFTiIsIkZPUkJJRERFTiIsIk5vdEZvdW5kRXJyb3IiLCJyZXNvdXJjZSIsIlJFU09VUkNFX05PVF9GT1VORCIsIk5PVF9GT1VORCIsIkNvbmZsaWN0RXJyb3IiLCJSRVNPVVJDRV9BTFJFQURZX0VYSVNUUyIsIkNPTkZMSUNUIiwiRGF0YWJhc2VFcnJvciIsIkRBVEFCQVNFX0VSUk9SIiwiRXh0ZXJuYWxTZXJ2aWNlRXJyb3IiLCJzZXJ2aWNlIiwiRVhURVJOQUxfU0VSVklDRV9FUlJPUiIsIkJBRF9HQVRFV0FZIiwiUmF0ZUxpbWl0RXJyb3IiLCJSQVRFX0xJTUlUX0VYQ0VFREVEIiwiVE9PX01BTllfUkVRVUVTVFMiLCJjcmVhdGVWYWxpZGF0aW9uRXJyb3IiLCJ2YWx1ZSIsImNyZWF0ZU5vdEZvdW5kRXJyb3IiLCJpZCIsImNyZWF0ZUNvbmZsaWN0RXJyb3IiLCJpc0FwcEVycm9yIiwiZXJyb3IiLCJpc09wZXJhdGlvbmFsRXJyb3IiLCJleHRyYWN0RXJyb3JNZXNzYWdlIiwiZXh0cmFjdEVycm9yQ29kZSIsImV4dHJhY3RTdGF0dXNDb2RlIiwic2VyaWFsaXplRXJyb3IiLCJpbmNsdWRlU3RhY2siLCJzZXJpYWxpemVkIiwic3RhY2siLCJhc3luY1dyYXBwZXIiLCJmbiIsImFyZ3MiLCJvcmlnaW5hbEVycm9yIiwiaGFuZGxlUHJvbWlzZVJlamVjdGlvbiIsInByb21pc2UiLCJjYXRjaCIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/errors.ts\n");

/***/ }),

/***/ "(api)/./src/lib/logger.ts":
/*!***************************!*\
  !*** ./src/lib/logger.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LogLevel: () => (/* binding */ LogLevel),\n/* harmony export */   logApiError: () => (/* binding */ logApiError),\n/* harmony export */   logApiRequest: () => (/* binding */ logApiRequest),\n/* harmony export */   logDatabaseConnection: () => (/* binding */ logDatabaseConnection),\n/* harmony export */   logDatabaseQuery: () => (/* binding */ logDatabaseQuery),\n/* harmony export */   logError: () => (/* binding */ logError),\n/* harmony export */   logHealthCheck: () => (/* binding */ logHealthCheck),\n/* harmony export */   logNetworkInfo: () => (/* binding */ logNetworkInfo),\n/* harmony export */   logStartup: () => (/* binding */ logStartup),\n/* harmony export */   logSystemEvent: () => (/* binding */ logSystemEvent),\n/* harmony export */   logUserAction: () => (/* binding */ logUserAction),\n/* harmony export */   logger: () => (/* binding */ logger)\n/* harmony export */ });\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ \"(api)/./src/lib/config.ts\");\n\nvar LogLevel;\n(function(LogLevel) {\n    LogLevel[LogLevel[\"ERROR\"] = 0] = \"ERROR\";\n    LogLevel[LogLevel[\"WARN\"] = 1] = \"WARN\";\n    LogLevel[LogLevel[\"INFO\"] = 2] = \"INFO\";\n    LogLevel[LogLevel[\"DEBUG\"] = 3] = \"DEBUG\";\n})(LogLevel || (LogLevel = {}));\nclass ConsoleLogger {\n    constructor(level){\n        this.level = this.parseLogLevel(level);\n    }\n    parseLogLevel(level) {\n        switch(level.toLowerCase()){\n            case \"error\":\n                return 0;\n            case \"warn\":\n                return 1;\n            case \"info\":\n                return 2;\n            case \"debug\":\n                return 3;\n            default:\n                return 2;\n        }\n    }\n    shouldLog(level) {\n        return level <= this.level;\n    }\n    formatMessage(level, message, context) {\n        const timestamp = new Date().toISOString();\n        const baseMessage = `[${timestamp}] ${level.toUpperCase()}: ${message}`;\n        if (context && Object.keys(context).length > 0) {\n            if (_config__WEBPACK_IMPORTED_MODULE_0__.config.logging.pretty) {\n                return `${baseMessage}\\n${JSON.stringify(context, null, 2)}`;\n            } else {\n                return `${baseMessage} ${JSON.stringify(context)}`;\n            }\n        }\n        return baseMessage;\n    }\n    error(message, context) {\n        if (this.shouldLog(0)) {\n            console.error(this.formatMessage(\"error\", message, context));\n        }\n    }\n    warn(message, context) {\n        if (this.shouldLog(1)) {\n            console.warn(this.formatMessage(\"warn\", message, context));\n        }\n    }\n    info(message, context) {\n        if (this.shouldLog(2)) {\n            console.info(this.formatMessage(\"info\", message, context));\n        }\n    }\n    debug(message, context) {\n        if (this.shouldLog(3)) {\n            console.debug(this.formatMessage(\"debug\", message, context));\n        }\n    }\n}\n// Create singleton logger instance\nconst logger = new ConsoleLogger(_config__WEBPACK_IMPORTED_MODULE_0__.config.logging.level);\n// Utility functions for structured logging\nfunction logError(error, context) {\n    logger.error(error.message, {\n        ...context,\n        stack: error.stack,\n        name: error.name\n    });\n}\nfunction logApiRequest(method, url, userId, duration) {\n    logger.info(\"API Request\", {\n        method,\n        url,\n        userId,\n        duration: duration ? `${duration}ms` : undefined\n    });\n}\nfunction logApiError(method, url, error, userId) {\n    logger.error(\"API Error\", {\n        method,\n        url,\n        userId,\n        error: error.message,\n        stack: error.stack\n    });\n}\nfunction logDatabaseQuery(query, duration, error) {\n    if (error) {\n        logger.error(\"Database Query Error\", {\n            query,\n            duration: duration ? `${duration}ms` : undefined,\n            error: error.message\n        });\n    } else {\n        logger.debug(\"Database Query\", {\n            query,\n            duration: duration ? `${duration}ms` : undefined\n        });\n    }\n}\nfunction logUserAction(action, userId, context) {\n    logger.info(\"User Action\", {\n        action,\n        userId,\n        ...context\n    });\n}\nfunction logSystemEvent(event, context) {\n    logger.info(\"System Event\", {\n        event,\n        ...context\n    });\n}\nfunction logStartup(component, status, context) {\n    const level = status === \"failed\" ? \"error\" : \"info\";\n    logger[level](` ${component} ${status.toUpperCase()}`, {\n        component,\n        status,\n        timestamp: new Date().toISOString(),\n        ...context\n    });\n}\nfunction logHealthCheck(component, healthy, context) {\n    const status = healthy ? \"healthy\" : \"unhealthy\";\n    const level = healthy ? \"info\" : \"error\";\n    logger[level](` Health Check: ${component} is ${status}`, {\n        component,\n        healthy,\n        ...context\n    });\n}\nfunction logNetworkInfo(port, host = \"localhost\", context) {\n    logger.info(\"\\uD83C\\uDF10 Server Network Configuration\", {\n        port,\n        host,\n        url: `http://${host}:${port}`,\n        ...context\n    });\n}\nfunction logDatabaseConnection(status, context) {\n    const level = status === \"failed\" ? \"error\" : \"info\";\n    const emoji = status === \"connected\" ? \"\" : status === \"connecting\" ? \"\\uD83D\\uDD04\" : \"\";\n    logger[level](`${emoji} Database ${status.toUpperCase()}`, {\n        status,\n        ...context\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFDWjtBQUNGO0FBRU8sU0FBU3NDLGVBQWVGLFNBQWlCLEVBQUVHLE9BQWdCLEVBQUV2QyxPQUFvQjtJQUN0RixNQUFNcUMsU0FBU0UsVUFBVSxZQUFZO0lBQ3JDLE1BQU03QyxRQUFRNkMsVUFBVSxTQUFTO0lBQ2pDckIsTUFBTSxDQUFDeEIsTUFBTSxDQUFDLENBQUMsaUJBQWlCLEVBQUUwQyxVQUFVLElBQUksRUFBRUMsT0FBTyxDQUFDLEVBQUU7UUFDMUREO1FBQ0FHO1FBQ0EsR0FBR3ZDLE9BQU87SUFDWjtBQUNGO0FBRU8sU0FBU3dDLGVBQWVDLElBQVksRUFBRUMsT0FBTyxXQUFXLEVBQUUxQyxPQUFvQjtJQUNuRmtCLE9BQU9GLElBQUksQ0FBQyw2Q0FBbUM7UUFDN0N5QjtRQUNBQztRQUNBbEIsS0FBSyxDQUFDLE9BQU8sRUFBRWtCLEtBQUssQ0FBQyxFQUFFRCxLQUFLLENBQUM7UUFDN0IsR0FBR3pDLE9BQU87SUFDWjtBQUNGO0FBRU8sU0FBUzJDLHNCQUFzQk4sTUFBNkMsRUFBRXJDLE9BQW9CO0lBQ3ZHLE1BQU1OLFFBQVEyQyxXQUFXLFdBQVcsVUFBVTtJQUM5QyxNQUFNTyxRQUFRUCxXQUFXLGNBQWMsTUFBTUEsV0FBVyxlQUFlLGlCQUFPO0lBQzlFbkIsTUFBTSxDQUFDeEIsTUFBTSxDQUFDLENBQUMsRUFBRWtELE1BQU0sVUFBVSxFQUFFUCxPQUFPaEMsV0FBVyxHQUFHLENBQUMsRUFBRTtRQUN6RGdDO1FBQ0EsR0FBR3JDLE9BQU87SUFDWjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmF0ZW15LW5leHRqcy8uL3NyYy9saWIvbG9nZ2VyLnRzP2I0OWUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi9jb25maWcnXG5cbmV4cG9ydCBlbnVtIExvZ0xldmVsIHtcbiAgRVJST1IgPSAwLFxuICBXQVJOID0gMSxcbiAgSU5GTyA9IDIsXG4gIERFQlVHID0gMyxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2dDb250ZXh0IHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nZ2VyIHtcbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWRcbiAgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KTogdm9pZFxuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkXG4gIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkXG59XG5cbmNsYXNzIENvbnNvbGVMb2dnZXIgaW1wbGVtZW50cyBMb2dnZXIge1xuICBwcml2YXRlIGxldmVsOiBMb2dMZXZlbFxuXG4gIGNvbnN0cnVjdG9yKGxldmVsOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxldmVsID0gdGhpcy5wYXJzZUxvZ0xldmVsKGxldmVsKVxuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZUxvZ0xldmVsKGxldmVsOiBzdHJpbmcpOiBMb2dMZXZlbCB7XG4gICAgc3dpdGNoIChsZXZlbC50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBjYXNlICdlcnJvcic6IHJldHVybiBMb2dMZXZlbC5FUlJPUlxuICAgICAgY2FzZSAnd2Fybic6IHJldHVybiBMb2dMZXZlbC5XQVJOXG4gICAgICBjYXNlICdpbmZvJzogcmV0dXJuIExvZ0xldmVsLklORk9cbiAgICAgIGNhc2UgJ2RlYnVnJzogcmV0dXJuIExvZ0xldmVsLkRFQlVHXG4gICAgICBkZWZhdWx0OiByZXR1cm4gTG9nTGV2ZWwuSU5GT1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkTG9nKGxldmVsOiBMb2dMZXZlbCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBsZXZlbCA8PSB0aGlzLmxldmVsXG4gIH1cblxuICBwcml2YXRlIGZvcm1hdE1lc3NhZ2UobGV2ZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHN0cmluZyB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgY29uc3QgYmFzZU1lc3NhZ2UgPSBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbC50b1VwcGVyQ2FzZSgpfTogJHttZXNzYWdlfWBcbiAgICBcbiAgICBpZiAoY29udGV4dCAmJiBPYmplY3Qua2V5cyhjb250ZXh0KS5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAoY29uZmlnLmxvZ2dpbmcucHJldHR5KSB7XG4gICAgICAgIHJldHVybiBgJHtiYXNlTWVzc2FnZX1cXG4ke0pTT04uc3RyaW5naWZ5KGNvbnRleHQsIG51bGwsIDIpfWBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBgJHtiYXNlTWVzc2FnZX0gJHtKU09OLnN0cmluZ2lmeShjb250ZXh0KX1gXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBiYXNlTWVzc2FnZVxuICB9XG5cbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNob3VsZExvZyhMb2dMZXZlbC5FUlJPUikpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IodGhpcy5mb3JtYXRNZXNzYWdlKCdlcnJvcicsIG1lc3NhZ2UsIGNvbnRleHQpKVxuICAgIH1cbiAgfVxuXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNob3VsZExvZyhMb2dMZXZlbC5XQVJOKSkge1xuICAgICAgY29uc29sZS53YXJuKHRoaXMuZm9ybWF0TWVzc2FnZSgnd2FybicsIG1lc3NhZ2UsIGNvbnRleHQpKVxuICAgIH1cbiAgfVxuXG4gIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNob3VsZExvZyhMb2dMZXZlbC5JTkZPKSkge1xuICAgICAgY29uc29sZS5pbmZvKHRoaXMuZm9ybWF0TWVzc2FnZSgnaW5mbycsIG1lc3NhZ2UsIGNvbnRleHQpKVxuICAgIH1cbiAgfVxuXG4gIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaG91bGRMb2coTG9nTGV2ZWwuREVCVUcpKSB7XG4gICAgICBjb25zb2xlLmRlYnVnKHRoaXMuZm9ybWF0TWVzc2FnZSgnZGVidWcnLCBtZXNzYWdlLCBjb250ZXh0KSlcbiAgICB9XG4gIH1cbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBsb2dnZXIgaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBsb2dnZXI6IExvZ2dlciA9IG5ldyBDb25zb2xlTG9nZ2VyKGNvbmZpZy5sb2dnaW5nLmxldmVsKVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3Igc3RydWN0dXJlZCBsb2dnaW5nXG5leHBvcnQgZnVuY3Rpb24gbG9nRXJyb3IoZXJyb3I6IEVycm9yLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xuICBsb2dnZXIuZXJyb3IoZXJyb3IubWVzc2FnZSwge1xuICAgIC4uLmNvbnRleHQsXG4gICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgIG5hbWU6IGVycm9yLm5hbWUsXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dBcGlSZXF1ZXN0KG1ldGhvZDogc3RyaW5nLCB1cmw6IHN0cmluZywgdXNlcklkPzogc3RyaW5nLCBkdXJhdGlvbj86IG51bWJlcikge1xuICBsb2dnZXIuaW5mbygnQVBJIFJlcXVlc3QnLCB7XG4gICAgbWV0aG9kLFxuICAgIHVybCxcbiAgICB1c2VySWQsXG4gICAgZHVyYXRpb246IGR1cmF0aW9uID8gYCR7ZHVyYXRpb259bXNgIDogdW5kZWZpbmVkLFxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nQXBpRXJyb3IobWV0aG9kOiBzdHJpbmcsIHVybDogc3RyaW5nLCBlcnJvcjogRXJyb3IsIHVzZXJJZD86IHN0cmluZykge1xuICBsb2dnZXIuZXJyb3IoJ0FQSSBFcnJvcicsIHtcbiAgICBtZXRob2QsXG4gICAgdXJsLFxuICAgIHVzZXJJZCxcbiAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICBzdGFjazogZXJyb3Iuc3RhY2ssXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dEYXRhYmFzZVF1ZXJ5KHF1ZXJ5OiBzdHJpbmcsIGR1cmF0aW9uPzogbnVtYmVyLCBlcnJvcj86IEVycm9yKSB7XG4gIGlmIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRGF0YWJhc2UgUXVlcnkgRXJyb3InLCB7XG4gICAgICBxdWVyeSxcbiAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiA/IGAke2R1cmF0aW9ufW1zYCA6IHVuZGVmaW5lZCxcbiAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgIH0pXG4gIH0gZWxzZSB7XG4gICAgbG9nZ2VyLmRlYnVnKCdEYXRhYmFzZSBRdWVyeScsIHtcbiAgICAgIHF1ZXJ5LFxuICAgICAgZHVyYXRpb246IGR1cmF0aW9uID8gYCR7ZHVyYXRpb259bXNgIDogdW5kZWZpbmVkLFxuICAgIH0pXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ1VzZXJBY3Rpb24oYWN0aW9uOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xuICBsb2dnZXIuaW5mbygnVXNlciBBY3Rpb24nLCB7XG4gICAgYWN0aW9uLFxuICAgIHVzZXJJZCxcbiAgICAuLi5jb250ZXh0LFxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nU3lzdGVtRXZlbnQoZXZlbnQ6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQpIHtcbiAgbG9nZ2VyLmluZm8oJ1N5c3RlbSBFdmVudCcsIHtcbiAgICBldmVudCxcbiAgICAuLi5jb250ZXh0LFxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nU3RhcnR1cChjb21wb25lbnQ6IHN0cmluZywgc3RhdHVzOiAnc3RhcnRpbmcnIHwgJ3JlYWR5JyB8ICdmYWlsZWQnLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xuICBjb25zdCBsZXZlbCA9IHN0YXR1cyA9PT0gJ2ZhaWxlZCcgPyAnZXJyb3InIDogJ2luZm8nXG4gIGxvZ2dlcltsZXZlbF0oYPCfmoAgJHtjb21wb25lbnR9ICR7c3RhdHVzLnRvVXBwZXJDYXNlKCl9YCwge1xuICAgIGNvbXBvbmVudCxcbiAgICBzdGF0dXMsXG4gICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgLi4uY29udGV4dCxcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0hlYWx0aENoZWNrKGNvbXBvbmVudDogc3RyaW5nLCBoZWFsdGh5OiBib29sZWFuLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xuICBjb25zdCBzdGF0dXMgPSBoZWFsdGh5ID8gJ2hlYWx0aHknIDogJ3VuaGVhbHRoeSdcbiAgY29uc3QgbGV2ZWwgPSBoZWFsdGh5ID8gJ2luZm8nIDogJ2Vycm9yJ1xuICBsb2dnZXJbbGV2ZWxdKGDwn5KaIEhlYWx0aCBDaGVjazogJHtjb21wb25lbnR9IGlzICR7c3RhdHVzfWAsIHtcbiAgICBjb21wb25lbnQsXG4gICAgaGVhbHRoeSxcbiAgICAuLi5jb250ZXh0LFxuICB9KVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nTmV0d29ya0luZm8ocG9ydDogbnVtYmVyLCBob3N0ID0gJ2xvY2FsaG9zdCcsIGNvbnRleHQ/OiBMb2dDb250ZXh0KSB7XG4gIGxvZ2dlci5pbmZvKCfwn4yQIFNlcnZlciBOZXR3b3JrIENvbmZpZ3VyYXRpb24nLCB7XG4gICAgcG9ydCxcbiAgICBob3N0LFxuICAgIHVybDogYGh0dHA6Ly8ke2hvc3R9OiR7cG9ydH1gLFxuICAgIC4uLmNvbnRleHQsXG4gIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dEYXRhYmFzZUNvbm5lY3Rpb24oc3RhdHVzOiAnY29ubmVjdGluZycgfCAnY29ubmVjdGVkJyB8ICdmYWlsZWQnLCBjb250ZXh0PzogTG9nQ29udGV4dCkge1xuICBjb25zdCBsZXZlbCA9IHN0YXR1cyA9PT0gJ2ZhaWxlZCcgPyAnZXJyb3InIDogJ2luZm8nXG4gIGNvbnN0IGVtb2ppID0gc3RhdHVzID09PSAnY29ubmVjdGVkJyA/ICfinIUnIDogc3RhdHVzID09PSAnY29ubmVjdGluZycgPyAn8J+UhCcgOiAn4p2MJ1xuICBsb2dnZXJbbGV2ZWxdKGAke2Vtb2ppfSBEYXRhYmFzZSAke3N0YXR1cy50b1VwcGVyQ2FzZSgpfWAsIHtcbiAgICBzdGF0dXMsXG4gICAgLi4uY29udGV4dCxcbiAgfSlcbn0iXSwibmFtZXMiOlsiY29uZmlnIiwiTG9nTGV2ZWwiLCJDb25zb2xlTG9nZ2VyIiwiY29uc3RydWN0b3IiLCJsZXZlbCIsInBhcnNlTG9nTGV2ZWwiLCJ0b0xvd2VyQ2FzZSIsInNob3VsZExvZyIsImZvcm1hdE1lc3NhZ2UiLCJtZXNzYWdlIiwiY29udGV4dCIsInRpbWVzdGFtcCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImJhc2VNZXNzYWdlIiwidG9VcHBlckNhc2UiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwibG9nZ2luZyIsInByZXR0eSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlcnJvciIsImNvbnNvbGUiLCJ3YXJuIiwiaW5mbyIsImRlYnVnIiwibG9nZ2VyIiwibG9nRXJyb3IiLCJzdGFjayIsIm5hbWUiLCJsb2dBcGlSZXF1ZXN0IiwibWV0aG9kIiwidXJsIiwidXNlcklkIiwiZHVyYXRpb24iLCJ1bmRlZmluZWQiLCJsb2dBcGlFcnJvciIsImxvZ0RhdGFiYXNlUXVlcnkiLCJxdWVyeSIsImxvZ1VzZXJBY3Rpb24iLCJhY3Rpb24iLCJsb2dTeXN0ZW1FdmVudCIsImV2ZW50IiwibG9nU3RhcnR1cCIsImNvbXBvbmVudCIsInN0YXR1cyIsImxvZ0hlYWx0aENoZWNrIiwiaGVhbHRoeSIsImxvZ05ldHdvcmtJbmZvIiwicG9ydCIsImhvc3QiLCJsb2dEYXRhYmFzZUNvbm5lY3Rpb24iLCJlbW9qaSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/logger.ts\n");

/***/ }),

/***/ "(api)/./src/lib/performance-monitor.ts":
/*!****************************************!*\
  !*** ./src/lib/performance-monitor.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PerformanceMonitor: () => (/* binding */ PerformanceMonitor),\n/* harmony export */   performanceMonitor: () => (/* binding */ performanceMonitor),\n/* harmony export */   timeRatingOperation: () => (/* binding */ timeRatingOperation)\n/* harmony export */ });\n/* harmony import */ var _logger__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./logger */ \"(api)/./src/lib/logger.ts\");\n\nclass PerformanceMonitor {\n    // Start timing an operation\n    start(operationId, operation, metadata) {\n        this.timers.set(operationId, performance.now());\n        if (metadata) {\n            _logger__WEBPACK_IMPORTED_MODULE_0__.logger.debug(`Performance monitor: Starting ${operation}`, metadata);\n        }\n    }\n    // End timing an operation and record the metric\n    end(operationId, operation, metadata) {\n        const startTime = this.timers.get(operationId);\n        if (!startTime) {\n            _logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(`Performance monitor: No start time found for operation ${operationId}`);\n            return 0;\n        }\n        const duration = performance.now() - startTime;\n        this.timers.delete(operationId);\n        const metric = {\n            operation,\n            duration,\n            timestamp: Date.now(),\n            metadata\n        };\n        this.metrics.push(metric);\n        // Keep only the most recent metrics\n        if (this.metrics.length > this.maxMetrics) {\n            this.metrics = this.metrics.slice(-this.maxMetrics);\n        }\n        // Log slow operations (> 1000ms)\n        if (duration > 1000) {\n            _logger__WEBPACK_IMPORTED_MODULE_0__.logger.warn(`Slow operation detected: ${operation}`, {\n                duration,\n                operationId,\n                ...metadata\n            });\n        } else if (duration > 100) {\n            // Log medium operations for debugging\n            _logger__WEBPACK_IMPORTED_MODULE_0__.logger.debug(`Performance: ${operation} took ${duration.toFixed(2)}ms`, {\n                operationId,\n                ...metadata\n            });\n        }\n        return duration;\n    }\n    // Time a function execution\n    async timeFunction(operation, fn, metadata) {\n        const operationId = `${operation}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        this.start(operationId, operation, metadata);\n        try {\n            const result = await fn();\n            const duration = this.end(operationId, operation, metadata);\n            return {\n                result,\n                duration\n            };\n        } catch (error) {\n            const duration = this.end(operationId, operation, {\n                ...metadata,\n                error: true\n            });\n            throw error;\n        }\n    }\n    // Get performance statistics\n    getStats(operation) {\n        const filteredMetrics = operation ? this.metrics.filter((m)=>m.operation === operation) : this.metrics;\n        if (filteredMetrics.length === 0) {\n            return {\n                totalOperations: 0,\n                averageDuration: 0,\n                minDuration: 0,\n                maxDuration: 0,\n                recentOperations: 0,\n                slowOperations: 0\n            };\n        }\n        const durations = filteredMetrics.map((m)=>m.duration);\n        const recentCutoff = Date.now() - 5 * 60 * 1000 // Last 5 minutes\n        ;\n        return {\n            totalOperations: filteredMetrics.length,\n            averageDuration: durations.reduce((a, b)=>a + b, 0) / durations.length,\n            minDuration: Math.min(...durations),\n            maxDuration: Math.max(...durations),\n            recentOperations: filteredMetrics.filter((m)=>m.timestamp > recentCutoff).length,\n            slowOperations: filteredMetrics.filter((m)=>m.duration > 1000).length\n        };\n    }\n    // Get recent slow operations\n    getSlowOperations(limit = 10) {\n        return this.metrics.filter((m)=>m.duration > 1000).sort((a, b)=>b.timestamp - a.timestamp).slice(0, limit).map((m)=>({\n                operation: m.operation,\n                duration: m.duration,\n                timestamp: m.timestamp,\n                metadata: m.metadata\n            }));\n    }\n    // Get operation breakdown\n    getOperationBreakdown() {\n        const breakdown = {};\n        this.metrics.forEach((metric)=>{\n            if (!breakdown[metric.operation]) {\n                breakdown[metric.operation] = {\n                    count: 0,\n                    totalDuration: 0,\n                    averageDuration: 0,\n                    maxDuration: 0\n                };\n            }\n            const op = breakdown[metric.operation];\n            op.count += 1;\n            op.totalDuration += metric.duration;\n            op.maxDuration = Math.max(op.maxDuration, metric.duration);\n        });\n        // Calculate averages\n        Object.values(breakdown).forEach((op)=>{\n            op.averageDuration = op.totalDuration / op.count;\n        });\n        return breakdown;\n    }\n    // Clear all metrics\n    clear() {\n        this.metrics = [];\n        this.timers.clear();\n        _logger__WEBPACK_IMPORTED_MODULE_0__.logger.info(\"Performance monitor cleared\");\n    }\n    // Export metrics for analysis\n    exportMetrics() {\n        return [\n            ...this.metrics\n        ];\n    }\n    constructor(){\n        this.metrics = [];\n        this.maxMetrics = 1000 // Keep last 1000 operations\n        ;\n        this.timers = new Map();\n    }\n}\n// Export singleton instance\nconst performanceMonitor = new PerformanceMonitor();\n// Helper function for timing rating operations specifically\nconst timeRatingOperation = async (operation, fn, metadata)=>{\n    const { result } = await performanceMonitor.timeFunction(`rating_${operation}`, fn, metadata);\n    return result;\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UyxJQUFJNEQ7O0FBaUx2QjtBQUVBLDRCQUE0QjtBQUNyQixNQUFNQyxxQkFBcUIsSUFBSWxFLHFCQUFvQjtBQUUxRCw0REFBNEQ7QUFDckQsTUFBTW1FLHNCQUFzQixPQUNqQ2hFLFdBQ0F1QixJQUNBdEI7SUFFQSxNQUFNLEVBQUUyQixNQUFNLEVBQUUsR0FBRyxNQUFNbUMsbUJBQW1CekMsWUFBWSxDQUN0RCxDQUFDLE9BQU8sRUFBRXRCLFVBQVUsQ0FBQyxFQUNyQnVCLElBQ0F0QjtJQUVGLE9BQU8yQjtBQUNULEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vc3JjL2xpYi9wZXJmb3JtYW5jZS1tb25pdG9yLnRzPzNjNTMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXInXG5cbmludGVyZmFjZSBQZXJmb3JtYW5jZU1ldHJpYyB7XG4gIG9wZXJhdGlvbjogc3RyaW5nXG4gIGR1cmF0aW9uOiBudW1iZXJcbiAgdGltZXN0YW1wOiBudW1iZXJcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG59XG5cbmV4cG9ydCBjbGFzcyBQZXJmb3JtYW5jZU1vbml0b3Ige1xuICBwcml2YXRlIG1ldHJpY3M6IFBlcmZvcm1hbmNlTWV0cmljW10gPSBbXVxuICBwcml2YXRlIG1heE1ldHJpY3MgPSAxMDAwIC8vIEtlZXAgbGFzdCAxMDAwIG9wZXJhdGlvbnNcbiAgcHJpdmF0ZSB0aW1lcnMgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpXG5cbiAgLy8gU3RhcnQgdGltaW5nIGFuIG9wZXJhdGlvblxuICBzdGFydChvcGVyYXRpb25JZDogc3RyaW5nLCBvcGVyYXRpb246IHN0cmluZywgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogdm9pZCB7XG4gICAgdGhpcy50aW1lcnMuc2V0KG9wZXJhdGlvbklkLCBwZXJmb3JtYW5jZS5ub3coKSlcbiAgICBpZiAobWV0YWRhdGEpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUGVyZm9ybWFuY2UgbW9uaXRvcjogU3RhcnRpbmcgJHtvcGVyYXRpb259YCwgbWV0YWRhdGEpXG4gICAgfVxuICB9XG5cbiAgLy8gRW5kIHRpbWluZyBhbiBvcGVyYXRpb24gYW5kIHJlY29yZCB0aGUgbWV0cmljXG4gIGVuZChvcGVyYXRpb25JZDogc3RyaW5nLCBvcGVyYXRpb246IHN0cmluZywgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogbnVtYmVyIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSB0aGlzLnRpbWVycy5nZXQob3BlcmF0aW9uSWQpXG4gICAgaWYgKCFzdGFydFRpbWUpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBQZXJmb3JtYW5jZSBtb25pdG9yOiBObyBzdGFydCB0aW1lIGZvdW5kIGZvciBvcGVyYXRpb24gJHtvcGVyYXRpb25JZH1gKVxuICAgICAgcmV0dXJuIDBcbiAgICB9XG5cbiAgICBjb25zdCBkdXJhdGlvbiA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lXG4gICAgdGhpcy50aW1lcnMuZGVsZXRlKG9wZXJhdGlvbklkKVxuXG4gICAgY29uc3QgbWV0cmljOiBQZXJmb3JtYW5jZU1ldHJpYyA9IHtcbiAgICAgIG9wZXJhdGlvbixcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgbWV0YWRhdGFcbiAgICB9XG5cbiAgICB0aGlzLm1ldHJpY3MucHVzaChtZXRyaWMpXG5cbiAgICAvLyBLZWVwIG9ubHkgdGhlIG1vc3QgcmVjZW50IG1ldHJpY3NcbiAgICBpZiAodGhpcy5tZXRyaWNzLmxlbmd0aCA+IHRoaXMubWF4TWV0cmljcykge1xuICAgICAgdGhpcy5tZXRyaWNzID0gdGhpcy5tZXRyaWNzLnNsaWNlKC10aGlzLm1heE1ldHJpY3MpXG4gICAgfVxuXG4gICAgLy8gTG9nIHNsb3cgb3BlcmF0aW9ucyAoPiAxMDAwbXMpXG4gICAgaWYgKGR1cmF0aW9uID4gMTAwMCkge1xuICAgICAgbG9nZ2VyLndhcm4oYFNsb3cgb3BlcmF0aW9uIGRldGVjdGVkOiAke29wZXJhdGlvbn1gLCB7XG4gICAgICAgIGR1cmF0aW9uLFxuICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgLi4ubWV0YWRhdGFcbiAgICAgIH0pXG4gICAgfSBlbHNlIGlmIChkdXJhdGlvbiA+IDEwMCkge1xuICAgICAgLy8gTG9nIG1lZGl1bSBvcGVyYXRpb25zIGZvciBkZWJ1Z2dpbmdcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgUGVyZm9ybWFuY2U6ICR7b3BlcmF0aW9ufSB0b29rICR7ZHVyYXRpb24udG9GaXhlZCgyKX1tc2AsIHtcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgIC4uLm1ldGFkYXRhXG4gICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiBkdXJhdGlvblxuICB9XG5cbiAgLy8gVGltZSBhIGZ1bmN0aW9uIGV4ZWN1dGlvblxuICBhc3luYyB0aW1lRnVuY3Rpb248VD4oXG4gICAgb3BlcmF0aW9uOiBzdHJpbmcsXG4gICAgZm46ICgpID0+IFByb21pc2U8VD4gfCBULFxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuICApOiBQcm9taXNlPHsgcmVzdWx0OiBUOyBkdXJhdGlvbjogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGAke29wZXJhdGlvbn0tJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gXG4gICAgXG4gICAgdGhpcy5zdGFydChvcGVyYXRpb25JZCwgb3BlcmF0aW9uLCBtZXRhZGF0YSlcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZm4oKVxuICAgICAgY29uc3QgZHVyYXRpb24gPSB0aGlzLmVuZChvcGVyYXRpb25JZCwgb3BlcmF0aW9uLCBtZXRhZGF0YSlcbiAgICAgIHJldHVybiB7IHJlc3VsdCwgZHVyYXRpb24gfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IHRoaXMuZW5kKG9wZXJhdGlvbklkLCBvcGVyYXRpb24sIHsgLi4ubWV0YWRhdGEsIGVycm9yOiB0cnVlIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIC8vIEdldCBwZXJmb3JtYW5jZSBzdGF0aXN0aWNzXG4gIGdldFN0YXRzKG9wZXJhdGlvbj86IHN0cmluZyk6IHtcbiAgICB0b3RhbE9wZXJhdGlvbnM6IG51bWJlclxuICAgIGF2ZXJhZ2VEdXJhdGlvbjogbnVtYmVyXG4gICAgbWluRHVyYXRpb246IG51bWJlclxuICAgIG1heER1cmF0aW9uOiBudW1iZXJcbiAgICByZWNlbnRPcGVyYXRpb25zOiBudW1iZXJcbiAgICBzbG93T3BlcmF0aW9uczogbnVtYmVyXG4gIH0ge1xuICAgIGNvbnN0IGZpbHRlcmVkTWV0cmljcyA9IG9wZXJhdGlvbiBcbiAgICAgID8gdGhpcy5tZXRyaWNzLmZpbHRlcihtID0+IG0ub3BlcmF0aW9uID09PSBvcGVyYXRpb24pXG4gICAgICA6IHRoaXMubWV0cmljc1xuXG4gICAgaWYgKGZpbHRlcmVkTWV0cmljcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsT3BlcmF0aW9uczogMCxcbiAgICAgICAgYXZlcmFnZUR1cmF0aW9uOiAwLFxuICAgICAgICBtaW5EdXJhdGlvbjogMCxcbiAgICAgICAgbWF4RHVyYXRpb246IDAsXG4gICAgICAgIHJlY2VudE9wZXJhdGlvbnM6IDAsXG4gICAgICAgIHNsb3dPcGVyYXRpb25zOiAwXG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgZHVyYXRpb25zID0gZmlsdGVyZWRNZXRyaWNzLm1hcChtID0+IG0uZHVyYXRpb24pXG4gICAgY29uc3QgcmVjZW50Q3V0b2ZmID0gRGF0ZS5ub3coKSAtIDUgKiA2MCAqIDEwMDAgLy8gTGFzdCA1IG1pbnV0ZXNcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxPcGVyYXRpb25zOiBmaWx0ZXJlZE1ldHJpY3MubGVuZ3RoLFxuICAgICAgYXZlcmFnZUR1cmF0aW9uOiBkdXJhdGlvbnMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBkdXJhdGlvbnMubGVuZ3RoLFxuICAgICAgbWluRHVyYXRpb246IE1hdGgubWluKC4uLmR1cmF0aW9ucyksXG4gICAgICBtYXhEdXJhdGlvbjogTWF0aC5tYXgoLi4uZHVyYXRpb25zKSxcbiAgICAgIHJlY2VudE9wZXJhdGlvbnM6IGZpbHRlcmVkTWV0cmljcy5maWx0ZXIobSA9PiBtLnRpbWVzdGFtcCA+IHJlY2VudEN1dG9mZikubGVuZ3RoLFxuICAgICAgc2xvd09wZXJhdGlvbnM6IGZpbHRlcmVkTWV0cmljcy5maWx0ZXIobSA9PiBtLmR1cmF0aW9uID4gMTAwMCkubGVuZ3RoXG4gICAgfVxuICB9XG5cbiAgLy8gR2V0IHJlY2VudCBzbG93IG9wZXJhdGlvbnNcbiAgZ2V0U2xvd09wZXJhdGlvbnMobGltaXQgPSAxMCk6IEFycmF5PHtcbiAgICBvcGVyYXRpb246IHN0cmluZ1xuICAgIGR1cmF0aW9uOiBudW1iZXJcbiAgICB0aW1lc3RhbXA6IG51bWJlclxuICAgIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMubWV0cmljc1xuICAgICAgLmZpbHRlcihtID0+IG0uZHVyYXRpb24gPiAxMDAwKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIudGltZXN0YW1wIC0gYS50aW1lc3RhbXApXG4gICAgICAuc2xpY2UoMCwgbGltaXQpXG4gICAgICAubWFwKG0gPT4gKHtcbiAgICAgICAgb3BlcmF0aW9uOiBtLm9wZXJhdGlvbixcbiAgICAgICAgZHVyYXRpb246IG0uZHVyYXRpb24sXG4gICAgICAgIHRpbWVzdGFtcDogbS50aW1lc3RhbXAsXG4gICAgICAgIG1ldGFkYXRhOiBtLm1ldGFkYXRhXG4gICAgICB9KSlcbiAgfVxuXG4gIC8vIEdldCBvcGVyYXRpb24gYnJlYWtkb3duXG4gIGdldE9wZXJhdGlvbkJyZWFrZG93bigpOiBSZWNvcmQ8c3RyaW5nLCB7XG4gICAgY291bnQ6IG51bWJlclxuICAgIHRvdGFsRHVyYXRpb246IG51bWJlclxuICAgIGF2ZXJhZ2VEdXJhdGlvbjogbnVtYmVyXG4gICAgbWF4RHVyYXRpb246IG51bWJlclxuICB9PiB7XG4gICAgY29uc3QgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCB7XG4gICAgICBjb3VudDogbnVtYmVyXG4gICAgICB0b3RhbER1cmF0aW9uOiBudW1iZXJcbiAgICAgIGF2ZXJhZ2VEdXJhdGlvbjogbnVtYmVyXG4gICAgICBtYXhEdXJhdGlvbjogbnVtYmVyXG4gICAgfT4gPSB7fVxuXG4gICAgdGhpcy5tZXRyaWNzLmZvckVhY2gobWV0cmljID0+IHtcbiAgICAgIGlmICghYnJlYWtkb3duW21ldHJpYy5vcGVyYXRpb25dKSB7XG4gICAgICAgIGJyZWFrZG93blttZXRyaWMub3BlcmF0aW9uXSA9IHtcbiAgICAgICAgICBjb3VudDogMCxcbiAgICAgICAgICB0b3RhbER1cmF0aW9uOiAwLFxuICAgICAgICAgIGF2ZXJhZ2VEdXJhdGlvbjogMCxcbiAgICAgICAgICBtYXhEdXJhdGlvbjogMFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9wID0gYnJlYWtkb3duW21ldHJpYy5vcGVyYXRpb25dXG4gICAgICBvcC5jb3VudCArPSAxXG4gICAgICBvcC50b3RhbER1cmF0aW9uICs9IG1ldHJpYy5kdXJhdGlvblxuICAgICAgb3AubWF4RHVyYXRpb24gPSBNYXRoLm1heChvcC5tYXhEdXJhdGlvbiwgbWV0cmljLmR1cmF0aW9uKVxuICAgIH0pXG5cbiAgICAvLyBDYWxjdWxhdGUgYXZlcmFnZXNcbiAgICBPYmplY3QudmFsdWVzKGJyZWFrZG93bikuZm9yRWFjaChvcCA9PiB7XG4gICAgICBvcC5hdmVyYWdlRHVyYXRpb24gPSBvcC50b3RhbER1cmF0aW9uIC8gb3AuY291bnRcbiAgICB9KVxuXG4gICAgcmV0dXJuIGJyZWFrZG93blxuICB9XG5cbiAgLy8gQ2xlYXIgYWxsIG1ldHJpY3NcbiAgY2xlYXIoKTogdm9pZCB7XG4gICAgdGhpcy5tZXRyaWNzID0gW11cbiAgICB0aGlzLnRpbWVycy5jbGVhcigpXG4gICAgbG9nZ2VyLmluZm8oJ1BlcmZvcm1hbmNlIG1vbml0b3IgY2xlYXJlZCcpXG4gIH1cblxuICAvLyBFeHBvcnQgbWV0cmljcyBmb3IgYW5hbHlzaXNcbiAgZXhwb3J0TWV0cmljcygpOiBQZXJmb3JtYW5jZU1ldHJpY1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubWV0cmljc11cbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgcGVyZm9ybWFuY2VNb25pdG9yID0gbmV3IFBlcmZvcm1hbmNlTW9uaXRvcigpXG5cbi8vIEhlbHBlciBmdW5jdGlvbiBmb3IgdGltaW5nIHJhdGluZyBvcGVyYXRpb25zIHNwZWNpZmljYWxseVxuZXhwb3J0IGNvbnN0IHRpbWVSYXRpbmdPcGVyYXRpb24gPSBhc3luYyA8VD4oXG4gIG9wZXJhdGlvbjogc3RyaW5nLFxuICBmbjogKCkgPT4gUHJvbWlzZTxUPiB8IFQsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKTogUHJvbWlzZTxUPiA9PiB7XG4gIGNvbnN0IHsgcmVzdWx0IH0gPSBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IudGltZUZ1bmN0aW9uKFxuICAgIGByYXRpbmdfJHtvcGVyYXRpb259YCxcbiAgICBmbixcbiAgICBtZXRhZGF0YVxuICApXG4gIHJldHVybiByZXN1bHRcbn0iXSwibmFtZXMiOlsibG9nZ2VyIiwiUGVyZm9ybWFuY2VNb25pdG9yIiwic3RhcnQiLCJvcGVyYXRpb25JZCIsIm9wZXJhdGlvbiIsIm1ldGFkYXRhIiwidGltZXJzIiwic2V0IiwicGVyZm9ybWFuY2UiLCJub3ciLCJkZWJ1ZyIsImVuZCIsInN0YXJ0VGltZSIsImdldCIsIndhcm4iLCJkdXJhdGlvbiIsImRlbGV0ZSIsIm1ldHJpYyIsInRpbWVzdGFtcCIsIkRhdGUiLCJtZXRyaWNzIiwicHVzaCIsImxlbmd0aCIsIm1heE1ldHJpY3MiLCJzbGljZSIsInRvRml4ZWQiLCJ0aW1lRnVuY3Rpb24iLCJmbiIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0ciIsInJlc3VsdCIsImVycm9yIiwiZ2V0U3RhdHMiLCJmaWx0ZXJlZE1ldHJpY3MiLCJmaWx0ZXIiLCJtIiwidG90YWxPcGVyYXRpb25zIiwiYXZlcmFnZUR1cmF0aW9uIiwibWluRHVyYXRpb24iLCJtYXhEdXJhdGlvbiIsInJlY2VudE9wZXJhdGlvbnMiLCJzbG93T3BlcmF0aW9ucyIsImR1cmF0aW9ucyIsIm1hcCIsInJlY2VudEN1dG9mZiIsInJlZHVjZSIsImEiLCJiIiwibWluIiwibWF4IiwiZ2V0U2xvd09wZXJhdGlvbnMiLCJsaW1pdCIsInNvcnQiLCJnZXRPcGVyYXRpb25CcmVha2Rvd24iLCJicmVha2Rvd24iLCJmb3JFYWNoIiwiY291bnQiLCJ0b3RhbER1cmF0aW9uIiwib3AiLCJPYmplY3QiLCJ2YWx1ZXMiLCJjbGVhciIsImluZm8iLCJleHBvcnRNZXRyaWNzIiwiTWFwIiwicGVyZm9ybWFuY2VNb25pdG9yIiwidGltZVJhdGluZ09wZXJhdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/performance-monitor.ts\n");

/***/ }),

/***/ "(api)/./src/repositories/base.repository.ts":
/*!*********************************************!*\
  !*** ./src/repositories/base.repository.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   BaseRepository: () => (/* binding */ BaseRepository)\n/* harmony export */ });\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/logger */ \"(api)/./src/lib/logger.ts\");\n\n\nclass BaseRepository {\n    async findById(id) {\n        try {\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].findUnique({\n                where: {\n                    id\n                }\n            });\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error finding ${this.tableName} by id`, {\n                id,\n                error\n            });\n            throw error;\n        }\n    }\n    async findMany(filters) {\n        try {\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].findMany(filters);\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error finding many ${this.tableName}`, {\n                filters,\n                error\n            });\n            throw error;\n        }\n    }\n    async create(data) {\n        try {\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].create({\n                data\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.info(`Created ${this.tableName}`, {\n                id: result.id\n            });\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error creating ${this.tableName}`, {\n                data,\n                error\n            });\n            throw error;\n        }\n    }\n    async update(id, data) {\n        try {\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].update({\n                where: {\n                    id\n                },\n                data\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.info(`Updated ${this.tableName}`, {\n                id\n            });\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error updating ${this.tableName}`, {\n                id,\n                data,\n                error\n            });\n            throw error;\n        }\n    }\n    async delete(id) {\n        try {\n            await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].delete({\n                where: {\n                    id\n                }\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.info(`Deleted ${this.tableName}`, {\n                id\n            });\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error deleting ${this.tableName}`, {\n                id,\n                error\n            });\n            throw error;\n        }\n    }\n    async count(filters) {\n        try {\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].count(filters);\n            return result;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error counting ${this.tableName}`, {\n                filters,\n                error\n            });\n            throw error;\n        }\n    }\n    async findManyWithPagination(filters = {}, page = 1, limit = 10) {\n        try {\n            const skip = (page - 1) * limit;\n            const [items, total] = await Promise.all([\n                _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].findMany({\n                    ...filters,\n                    skip,\n                    take: limit\n                }),\n                _lib_db__WEBPACK_IMPORTED_MODULE_0__.db[this.tableName].count({\n                    where: filters.where\n                })\n            ]);\n            const totalPages = Math.ceil(total / limit);\n            return {\n                items,\n                total,\n                totalPages\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(`Error finding ${this.tableName} with pagination`, {\n                filters,\n                page,\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcmVwb3NpdG9yaWVzL2Jhc2UucmVwb3NpdG9yeS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEI7QUFDUTtBQUcvQixNQUFlRTtJQUdwQixNQUFNQyxTQUFTQyxFQUFVLEVBQXFCO1FBQzVDLElBQUk7WUFDRixNQUFNQyxTQUFTLE1BQU0sdUNBQVcsQ0FBQyxJQUFJLENBQUNDLFNBQVMsQ0FBQyxDQUFDQyxVQUFVLENBQUM7Z0JBQzFEQyxPQUFPO29CQUFFSjtnQkFBRztZQUNkO1lBQ0EsT0FBT0M7UUFDVCxFQUFFLE9BQU9JLE9BQU87WUFDZFIsK0NBQU1BLENBQUNRLEtBQUssQ0FBQyxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUNILFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtnQkFBRUY7Z0JBQUlLO1lBQU07WUFDbEUsTUFBTUE7UUFDUjtJQUNGO0lBRUEsTUFBTUMsU0FBU0MsT0FBYSxFQUFnQjtRQUMxQyxJQUFJO1lBQ0YsTUFBTU4sU0FBUyxNQUFNLHVDQUFXLENBQUMsSUFBSSxDQUFDQyxTQUFTLENBQUMsQ0FBQ0ksUUFBUSxDQUFDQztZQUMxRCxPQUFPTjtRQUNULEVBQUUsT0FBT0ksT0FBTztZQUNkUiwrQ0FBTUEsQ0FBQ1EsS0FBSyxDQUFDLENBQUMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDSCxTQUFTLENBQUMsQ0FBQyxFQUFFO2dCQUFFSztnQkFBU0Y7WUFBTTtZQUN0RSxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNRyxPQUFPQyxJQUErQyxFQUFjO1FBQ3hFLElBQUk7WUFDRixNQUFNUixTQUFTLE1BQU0sdUNBQVcsQ0FBQyxJQUFJLENBQUNDLFNBQVMsQ0FBQyxDQUFDTSxNQUFNLENBQUM7Z0JBQ3REQztZQUNGO1lBQ0FaLCtDQUFNQSxDQUFDYSxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDUixTQUFTLENBQUMsQ0FBQyxFQUFFO2dCQUFFRixJQUFJQyxPQUFPRCxFQUFFO1lBQUM7WUFDekQsT0FBT0M7UUFD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cG9zaXRvcmllcy9iYXNlLnJlcG9zaXRvcnkudHM/YWEwMiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkYiB9IGZyb20gJy4uL2xpYi9kYidcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL2xpYi9sb2dnZXInXG5pbXBvcnQgeyBSZXBvc2l0b3J5IH0gZnJvbSAnLi4vdHlwZXMnXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBCYXNlUmVwb3NpdG9yeTxUPiBpbXBsZW1lbnRzIFJlcG9zaXRvcnk8VD4ge1xuICBwcm90ZWN0ZWQgYWJzdHJhY3QgdGFibGVOYW1lOiBzdHJpbmdcblxuICBhc3luYyBmaW5kQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxUIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoZGIgYXMgYW55KVt0aGlzLnRhYmxlTmFtZV0uZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZmluZGluZyAke3RoaXMudGFibGVOYW1lfSBieSBpZGAsIHsgaWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRNYW55KGZpbHRlcnM/OiBhbnkpOiBQcm9taXNlPFRbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoZGIgYXMgYW55KVt0aGlzLnRhYmxlTmFtZV0uZmluZE1hbnkoZmlsdGVycylcbiAgICAgIHJldHVybiByZXN1bHRcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBmaW5kaW5nIG1hbnkgJHt0aGlzLnRhYmxlTmFtZX1gLCB7IGZpbHRlcnMsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZShkYXRhOiBPbWl0PFQsICdpZCcgfCAnY3JlYXRlZEF0JyB8ICd1cGRhdGVkQXQnPik6IFByb21pc2U8VD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAoZGIgYXMgYW55KVt0aGlzLnRhYmxlTmFtZV0uY3JlYXRlKHtcbiAgICAgICAgZGF0YVxuICAgICAgfSlcbiAgICAgIGxvZ2dlci5pbmZvKGBDcmVhdGVkICR7dGhpcy50YWJsZU5hbWV9YCwgeyBpZDogcmVzdWx0LmlkIH0pXG4gICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgY3JlYXRpbmcgJHt0aGlzLnRhYmxlTmFtZX1gLCB7IGRhdGEsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZShpZDogc3RyaW5nLCBkYXRhOiBQYXJ0aWFsPFQ+KTogUHJvbWlzZTxUPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChkYiBhcyBhbnkpW3RoaXMudGFibGVOYW1lXS51cGRhdGUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBkYXRhXG4gICAgICB9KVxuICAgICAgbG9nZ2VyLmluZm8oYFVwZGF0ZWQgJHt0aGlzLnRhYmxlTmFtZX1gLCB7IGlkIH0pXG4gICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgdXBkYXRpbmcgJHt0aGlzLnRhYmxlTmFtZX1gLCB7IGlkLCBkYXRhLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBkZWxldGUoaWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCAoZGIgYXMgYW55KVt0aGlzLnRhYmxlTmFtZV0uZGVsZXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQgfVxuICAgICAgfSlcbiAgICAgIGxvZ2dlci5pbmZvKGBEZWxldGVkICR7dGhpcy50YWJsZU5hbWV9YCwgeyBpZCB9KVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIGRlbGV0aW5nICR7dGhpcy50YWJsZU5hbWV9YCwgeyBpZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY291bnQoZmlsdGVycz86IGFueSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChkYiBhcyBhbnkpW3RoaXMudGFibGVOYW1lXS5jb3VudChmaWx0ZXJzKVxuICAgICAgcmV0dXJuIHJlc3VsdFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIGNvdW50aW5nICR7dGhpcy50YWJsZU5hbWV9YCwgeyBmaWx0ZXJzLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgYXN5bmMgZmluZE1hbnlXaXRoUGFnaW5hdGlvbihcbiAgICBmaWx0ZXJzOiBhbnkgPSB7fSxcbiAgICBwYWdlOiBudW1iZXIgPSAxLFxuICAgIGxpbWl0OiBudW1iZXIgPSAxMFxuICApOiBQcm9taXNlPHsgaXRlbXM6IFRbXTsgdG90YWw6IG51bWJlcjsgdG90YWxQYWdlczogbnVtYmVyIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdFxuICAgICAgY29uc3QgW2l0ZW1zLCB0b3RhbF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIChkYiBhcyBhbnkpW3RoaXMudGFibGVOYW1lXS5maW5kTWFueSh7XG4gICAgICAgICAgLi4uZmlsdGVycyxcbiAgICAgICAgICBza2lwLFxuICAgICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICB9KSxcbiAgICAgICAgKGRiIGFzIGFueSlbdGhpcy50YWJsZU5hbWVdLmNvdW50KHtcbiAgICAgICAgICB3aGVyZTogZmlsdGVycy53aGVyZSxcbiAgICAgICAgfSksXG4gICAgICBdKVxuXG4gICAgICBjb25zdCB0b3RhbFBhZ2VzID0gTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGl0ZW1zLFxuICAgICAgICB0b3RhbCxcbiAgICAgICAgdG90YWxQYWdlcyxcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBmaW5kaW5nICR7dGhpcy50YWJsZU5hbWV9IHdpdGggcGFnaW5hdGlvbmAsIHtcbiAgICAgICAgZmlsdGVycyxcbiAgICAgICAgcGFnZSxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIGVycm9yLFxuICAgICAgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG59Il0sIm5hbWVzIjpbImRiIiwibG9nZ2VyIiwiQmFzZVJlcG9zaXRvcnkiLCJmaW5kQnlJZCIsImlkIiwicmVzdWx0IiwidGFibGVOYW1lIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiZXJyb3IiLCJmaW5kTWFueSIsImZpbHRlcnMiLCJjcmVhdGUiLCJkYXRhIiwiaW5mbyIsInVwZGF0ZSIsImRlbGV0ZSIsImNvdW50IiwiZmluZE1hbnlXaXRoUGFnaW5hdGlvbiIsInBhZ2UiLCJsaW1pdCIsInNraXAiLCJpdGVtcyIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsInRha2UiLCJ0b3RhbFBhZ2VzIiwiTWF0aCIsImNlaWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/repositories/base.repository.ts\n");

/***/ }),

/***/ "(api)/./src/repositories/rating.repository.ts":
/*!***********************************************!*\
  !*** ./src/repositories/rating.repository.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RatingRepositoryImpl: () => (/* binding */ RatingRepositoryImpl),\n/* harmony export */   ratingRepository: () => (/* binding */ ratingRepository)\n/* harmony export */ });\n/* harmony import */ var _base_repository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base.repository */ \"(api)/./src/repositories/base.repository.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_performance_monitor__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/performance-monitor */ \"(api)/./src/lib/performance-monitor.ts\");\n\n\n\n\nclass RatingRepositoryImpl extends _base_repository__WEBPACK_IMPORTED_MODULE_0__.BaseRepository {\n    async findByVideoId(videoId) {\n        try {\n            const ratings = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.findMany({\n                where: {\n                    videoId\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tag: true\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            return ratings;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding ratings by video id\", {\n                videoId,\n                error\n            });\n            throw error;\n        }\n    }\n    async findByUserId(userId) {\n        try {\n            const ratings = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.findMany({\n                where: {\n                    userId\n                },\n                include: {\n                    video: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    username: true,\n                                    firstName: true,\n                                    lastName: true,\n                                    avatar: true\n                                }\n                            }\n                        }\n                    },\n                    tag: true\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            return ratings;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding ratings by user id\", {\n                userId,\n                error\n            });\n            throw error;\n        }\n    }\n    async findByUserAndVideo(userId, videoId) {\n        try {\n            const ratings = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.findMany({\n                where: {\n                    userId,\n                    videoId\n                },\n                include: {\n                    tag: true\n                }\n            });\n            return ratings;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding ratings by user and video\", {\n                userId,\n                videoId,\n                error\n            });\n            throw error;\n        }\n    }\n    async upsertRating(videoId, userId, tagId, level) {\n        try {\n            const rating = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.upsert({\n                where: {\n                    videoId_userId_tagId: {\n                        videoId,\n                        userId,\n                        tagId\n                    }\n                },\n                update: {\n                    level\n                },\n                create: {\n                    videoId,\n                    userId,\n                    tagId,\n                    level\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tag: true\n                }\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Upserted rating\", {\n                videoId,\n                userId,\n                tagId,\n                level\n            });\n            return rating;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error upserting rating\", {\n                videoId,\n                userId,\n                tagId,\n                level,\n                error\n            });\n            throw error;\n        }\n    }\n    async deleteRating(videoId, userId, tagId) {\n        try {\n            await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.delete({\n                where: {\n                    videoId_userId_tagId: {\n                        videoId,\n                        userId,\n                        tagId\n                    }\n                }\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Deleted rating\", {\n                videoId,\n                userId,\n                tagId\n            });\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error deleting rating\", {\n                videoId,\n                userId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getAverageRating(videoId, tagId) {\n        try {\n            const where = {\n                videoId\n            };\n            if (tagId) {\n                where.tagId = tagId;\n            }\n            const result = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.aggregate({\n                where,\n                _avg: {\n                    level: true\n                }\n            });\n            return result._avg.level || 0;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting average rating\", {\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getRatingDistribution(videoId, tagId) {\n        try {\n            const where = {\n                videoId\n            };\n            if (tagId) {\n                where.tagId = tagId;\n            }\n            const distribution = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.groupBy({\n                by: [\n                    \"level\"\n                ],\n                where,\n                _count: {\n                    level: true\n                },\n                orderBy: {\n                    level: \"asc\"\n                }\n            });\n            return distribution.map((item)=>({\n                    level: item.level,\n                    count: item._count.level\n                }));\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting rating distribution\", {\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getUserRatingForVideo(userId, videoId, tagId) {\n        try {\n            const rating = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.findUnique({\n                where: {\n                    videoId_userId_tagId: {\n                        videoId,\n                        userId,\n                        tagId\n                    }\n                },\n                include: {\n                    tag: true\n                }\n            });\n            return rating;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting user rating for video\", {\n                userId,\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getTopRatedVideos(limit = 10, tagId) {\n        try {\n            const where = {};\n            if (tagId) {\n                where.tagId = tagId;\n            }\n            const topRated = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.groupBy({\n                by: [\n                    \"videoId\"\n                ],\n                where,\n                _avg: {\n                    level: true\n                },\n                _count: {\n                    level: true\n                },\n                having: {\n                    level: {\n                        _count: {\n                            gte: 3 // At least 3 ratings to be considered\n                        }\n                    }\n                },\n                orderBy: {\n                    _avg: {\n                        level: \"desc\"\n                    }\n                },\n                take: limit\n            });\n            return topRated.map((item)=>({\n                    videoId: item.videoId,\n                    averageRating: item._avg.level || 0,\n                    ratingCount: item._count.level\n                }));\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting top rated videos\", {\n                limit,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async bulkUpsertRatings(ratings) {\n        return (0,_lib_performance_monitor__WEBPACK_IMPORTED_MODULE_3__.timeRatingOperation)(\"bulk_upsert\", async ()=>{\n            try {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Starting bulk rating upsert\", {\n                    count: ratings.length\n                });\n                // Use transaction for consistency\n                const result = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.$transaction(async (tx)=>{\n                    const upsertPromises = ratings.map((rating)=>tx.rating.upsert({\n                            where: {\n                                videoId_userId_tagId: {\n                                    videoId: rating.videoId,\n                                    userId: rating.userId,\n                                    tagId: rating.tagId\n                                }\n                            },\n                            update: {\n                                level: rating.level,\n                                updatedAt: new Date()\n                            },\n                            create: {\n                                videoId: rating.videoId,\n                                userId: rating.userId,\n                                tagId: rating.tagId,\n                                level: rating.level\n                            },\n                            include: {\n                                user: {\n                                    select: {\n                                        id: true,\n                                        username: true,\n                                        firstName: true,\n                                        lastName: true,\n                                        avatar: true\n                                    }\n                                },\n                                tag: true\n                            }\n                        }));\n                    return Promise.all(upsertPromises);\n                });\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Bulk rating upsert completed\", {\n                    count: ratings.length,\n                    successful: result.length\n                });\n                return result;\n            } catch (error) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error in bulk rating upsert\", {\n                    count: ratings.length,\n                    error\n                });\n                throw error;\n            }\n        }, {\n            ratingsCount: ratings.length\n        });\n    }\n    async getRatingsByVideoIds(videoIds) {\n        try {\n            if (videoIds.length === 0) return new Map();\n            const ratings = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.findMany({\n                where: {\n                    videoId: {\n                        in: videoIds\n                    }\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tag: true\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            // Group ratings by video ID\n            const ratingsByVideo = new Map();\n            ratings.forEach((rating)=>{\n                if (!ratingsByVideo.has(rating.videoId)) {\n                    ratingsByVideo.set(rating.videoId, []);\n                }\n                ratingsByVideo.get(rating.videoId).push(rating);\n            });\n            return ratingsByVideo;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting ratings by video IDs\", {\n                videoIds: videoIds.length,\n                error\n            });\n            throw error;\n        }\n    }\n    async getAverageRatingsByVideoIds(videoIds, tagId) {\n        try {\n            if (videoIds.length === 0) return new Map();\n            const where = {\n                videoId: {\n                    in: videoIds\n                }\n            };\n            if (tagId) {\n                where.tagId = tagId;\n            }\n            const averages = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.groupBy({\n                by: [\n                    \"videoId\"\n                ],\n                where,\n                _avg: {\n                    level: true\n                }\n            });\n            const averageMap = new Map();\n            averages.forEach((avg)=>{\n                averageMap.set(avg.videoId, avg._avg.level || 0);\n            });\n            return averageMap;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting average ratings by video IDs\", {\n                videoIds: videoIds.length,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    constructor(...args){\n        super(...args);\n        this.tableName = \"rating\";\n    }\n}\n// Export singleton instance\nconst ratingRepository = new RatingRepositoryImpl();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcmVwb3NpdG9yaWVzL3JhdGluZy5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUNrRDtBQUNwQjtBQUNRO0FBQzBCO0FBRXpELE1BQU1JLDZCQUE2QkosNERBQWNBO0lBR3RELE1BQU1LLGNBQWNDLE9BQWUsRUFBa0I7UUFDbkQsSUFBSTtZQUNGLE1BQU1DLFVBQVUsTUFBTU4sdUNBQUVBLENBQUNPLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDO2dCQUN2Q0MsT0FBTztvQkFBRUo7Z0JBQVE7Z0JBQ2pCSyxTQUFTO29CQUNQQyxNQUFNO3dCQUNKQyxRQUFROzRCQUNOQyxJQUFJOzRCQUNKQyxVQUFVOzRCQUNWQyxXQUFXOzRCQUNYQyxVQUFVOzRCQUNWQyxRQUFRO3dCQUNWO29CQUNGO29CQUNBQyxLQUFLO2dCQUNQO2dCQUNBQyxTQUFTO29CQUNQQyxXQUFXO2dCQUNiO1lBQ0Y7WUFDQSxPQUFPZDtRQUNULEVBQUUsT0FBT2UsT0FBTztZQUNkcEIsK0NBQU1BLENBQUNvQixLQUFLLENBQUMscUNBQXFDO2dCQUFFaEI7Z0JBQVNnQjtZQUFNO1lBQ25FLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1DLGFBQWFDLE1BQWMsRUFBa0I7UUFDakQsSUFBSTtZQUNGLE1BQU1qQixVQUFVLE1BQU1OLHVDQUFFQSxDQUFDTyxNQUFNLENBQUNDLFFBQVEsQ0FBQztnQkFDdkNDLE9BQU87b0JBQUVjO2dCQUFPO2dCQUNoQmIsU0FBUztvQkFDUGMsT0FBTzt3QkFDTGQsU0FBUzs0QkFDUEMsTUFBTTtnQ0FDSkMsUUFBUTtvQ0FDTkMsSUFBSTtvQ0FDSkMsVUFBVTtvQ0FDVkMsV0FBVztvQ0FDWEMsVUFBVTtvQ0FDVkMsUUFBUTtnQ0FDVjs0QkFDRjt3QkFDRjtvQkFDRjtvQkFDQUMsS0FBSztnQkFDUDtnQkFDQUMsU0FBUztvQkFDUEMsV0FBVztnQkFDYjtZQUNGO1lBQ0EsT0FBT2Q7UUFDVCxFQUFFLE9BQU9lLE9BQU87WUFDZHBCLCtDQUFN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Q1Q7WUFDRjtZQUVBLE1BQU1xRCxhQUFhLElBQUlWO1lBQ3ZCUyxTQUFTTixPQUFPLENBQUNRLENBQUFBO2dCQUNmRCxXQUFXTCxHQUFHLENBQUNNLElBQUk3RSxPQUFPLEVBQUU2RSxJQUFJM0MsSUFBSSxDQUFDWCxLQUFLLElBQUk7WUFDaEQ7WUFFQSxPQUFPcUQ7UUFDVCxFQUFFLE9BQU81RCxPQUFPO1lBQ2RwQiwrQ0FBTUEsQ0FBQ29CLEtBQUssQ0FBQyw4Q0FBOEM7Z0JBQUVpRCxVQUFVQSxTQUFTWCxNQUFNO2dCQUFFaEM7Z0JBQU9OO1lBQU07WUFDckcsTUFBTUE7UUFDUjtJQUNGOzs7YUFsWlU4RCxZQUFZOztBQW1aeEI7QUFFQSw0QkFBNEI7QUFDckIsTUFBTUMsbUJBQW1CLElBQUlqRix1QkFBc0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vc3JjL3JlcG9zaXRvcmllcy9yYXRpbmcucmVwb3NpdG9yeS50cz9hOTcwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJhdGluZyB9IGZyb20gJy4uL3R5cGVzJ1xuaW1wb3J0IHsgQmFzZVJlcG9zaXRvcnkgfSBmcm9tICcuL2Jhc2UucmVwb3NpdG9yeSdcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vbGliL2RiJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vbGliL2xvZ2dlcidcbmltcG9ydCB7IHRpbWVSYXRpbmdPcGVyYXRpb24gfSBmcm9tICcuLi9saWIvcGVyZm9ybWFuY2UtbW9uaXRvcidcblxuZXhwb3J0IGNsYXNzIFJhdGluZ1JlcG9zaXRvcnlJbXBsIGV4dGVuZHMgQmFzZVJlcG9zaXRvcnk8UmF0aW5nPiB7XG4gIHByb3RlY3RlZCB0YWJsZU5hbWUgPSAncmF0aW5nJ1xuXG4gIGFzeW5jIGZpbmRCeVZpZGVvSWQodmlkZW9JZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByYXRpbmdzID0gYXdhaXQgZGIucmF0aW5nLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgdmlkZW9JZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJhdGluZ3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBmaW5kaW5nIHJhdGluZ3MgYnkgdmlkZW8gaWQnLCB7IHZpZGVvSWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRCeVVzZXJJZCh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmF0aW5ncyA9IGF3YWl0IGRiLnJhdGluZy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7IHVzZXJJZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJhdGluZ3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBmaW5kaW5nIHJhdGluZ3MgYnkgdXNlciBpZCcsIHsgdXNlcklkLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kQnlVc2VyQW5kVmlkZW8odXNlcklkOiBzdHJpbmcsIHZpZGVvSWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmF0aW5ncyA9IGF3YWl0IGRiLnJhdGluZy5maW5kTWFueSh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHZpZGVvSWRcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHJhdGluZ3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBmaW5kaW5nIHJhdGluZ3MgYnkgdXNlciBhbmQgdmlkZW8nLCB7IHVzZXJJZCwgdmlkZW9JZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdXBzZXJ0UmF0aW5nKFxuICAgIHZpZGVvSWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB0YWdJZDogc3RyaW5nLFxuICAgIGxldmVsOiBudW1iZXJcbiAgKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmF0aW5nID0gYXdhaXQgZGIucmF0aW5nLnVwc2VydCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgdmlkZW9JZF91c2VySWRfdGFnSWQ6IHtcbiAgICAgICAgICAgIHZpZGVvSWQsXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0YWdJZFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiB7XG4gICAgICAgICAgbGV2ZWxcbiAgICAgICAgfSxcbiAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgdmlkZW9JZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgdGFnSWQsXG4gICAgICAgICAgbGV2ZWxcbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgdXNlcm5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGF2YXRhcjogdHJ1ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgICBsb2dnZXIuaW5mbygnVXBzZXJ0ZWQgcmF0aW5nJywgeyB2aWRlb0lkLCB1c2VySWQsIHRhZ0lkLCBsZXZlbCB9KVxuICAgICAgcmV0dXJuIHJhdGluZ1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHVwc2VydGluZyByYXRpbmcnLCB7IHZpZGVvSWQsIHVzZXJJZCwgdGFnSWQsIGxldmVsLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBkZWxldGVSYXRpbmcodmlkZW9JZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgdGFnSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5yYXRpbmcuZGVsZXRlKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB2aWRlb0lkX3VzZXJJZF90YWdJZDoge1xuICAgICAgICAgICAgdmlkZW9JZCxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRhZ0lkXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgICBsb2dnZXIuaW5mbygnRGVsZXRlZCByYXRpbmcnLCB7IHZpZGVvSWQsIHVzZXJJZCwgdGFnSWQgfSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBkZWxldGluZyByYXRpbmcnLCB7IHZpZGVvSWQsIHVzZXJJZCwgdGFnSWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldEF2ZXJhZ2VSYXRpbmcodmlkZW9JZDogc3RyaW5nLCB0YWdJZD86IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7IHZpZGVvSWQgfVxuICAgICAgaWYgKHRhZ0lkKSB7XG4gICAgICAgIHdoZXJlLnRhZ0lkID0gdGFnSWRcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIucmF0aW5nLmFnZ3JlZ2F0ZSh7XG4gICAgICAgIHdoZXJlLFxuICAgICAgICBfYXZnOiB7XG4gICAgICAgICAgbGV2ZWw6IHRydWVcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHJlc3VsdC5fYXZnLmxldmVsIHx8IDBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIGF2ZXJhZ2UgcmF0aW5nJywgeyB2aWRlb0lkLCB0YWdJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0UmF0aW5nRGlzdHJpYnV0aW9uKHZpZGVvSWQ6IHN0cmluZywgdGFnSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHsgbGV2ZWw6IG51bWJlcjsgY291bnQ6IG51bWJlciB9Pj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB3aGVyZTogYW55ID0geyB2aWRlb0lkIH1cbiAgICAgIGlmICh0YWdJZCkge1xuICAgICAgICB3aGVyZS50YWdJZCA9IHRhZ0lkXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRpc3RyaWJ1dGlvbiA9IGF3YWl0IGRiLnJhdGluZy5ncm91cEJ5KHtcbiAgICAgICAgYnk6IFsnbGV2ZWwnXSxcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIF9jb3VudDoge1xuICAgICAgICAgIGxldmVsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBsZXZlbDogJ2FzYydcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIGRpc3RyaWJ1dGlvbi5tYXAoaXRlbSA9PiAoe1xuICAgICAgICBsZXZlbDogaXRlbS5sZXZlbCxcbiAgICAgICAgY291bnQ6IGl0ZW0uX2NvdW50LmxldmVsXG4gICAgICB9KSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHJhdGluZyBkaXN0cmlidXRpb24nLCB7IHZpZGVvSWQsIHRhZ0lkLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRVc2VyUmF0aW5nRm9yVmlkZW8oXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdmlkZW9JZDogc3RyaW5nLFxuICAgIHRhZ0lkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxhbnkgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJhdGluZyA9IGF3YWl0IGRiLnJhdGluZy5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB2aWRlb0lkX3VzZXJJZF90YWdJZDoge1xuICAgICAgICAgICAgdmlkZW9JZCxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRhZ0lkXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gcmF0aW5nXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIHJhdGluZyBmb3IgdmlkZW8nLCB7IHVzZXJJZCwgdmlkZW9JZCwgdGFnSWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFRvcFJhdGVkVmlkZW9zKGxpbWl0OiBudW1iZXIgPSAxMCwgdGFnSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHtcbiAgICB2aWRlb0lkOiBzdHJpbmc7XG4gICAgYXZlcmFnZVJhdGluZzogbnVtYmVyO1xuICAgIHJhdGluZ0NvdW50OiBudW1iZXI7XG4gIH0+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fVxuICAgICAgaWYgKHRhZ0lkKSB7XG4gICAgICAgIHdoZXJlLnRhZ0lkID0gdGFnSWRcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG9wUmF0ZWQgPSBhd2FpdCBkYi5yYXRpbmcuZ3JvdXBCeSh7XG4gICAgICAgIGJ5OiBbJ3ZpZGVvSWQnXSxcbiAgICAgICAgd2hlcmUsXG4gICAgICAgIF9hdmc6IHtcbiAgICAgICAgICBsZXZlbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICBsZXZlbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBoYXZpbmc6IHtcbiAgICAgICAgICBsZXZlbDoge1xuICAgICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICAgIGd0ZTogMyAvLyBBdCBsZWFzdCAzIHJhdGluZ3MgdG8gYmUgY29uc2lkZXJlZFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeToge1xuICAgICAgICAgIF9hdmc6IHtcbiAgICAgICAgICAgIGxldmVsOiAnZGVzYydcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IGxpbWl0XG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gdG9wUmF0ZWQubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgdmlkZW9JZDogaXRlbS52aWRlb0lkLFxuICAgICAgICBhdmVyYWdlUmF0aW5nOiBpdGVtLl9hdmcubGV2ZWwgfHwgMCxcbiAgICAgICAgcmF0aW5nQ291bnQ6IGl0ZW0uX2NvdW50LmxldmVsXG4gICAgICB9KSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRvcCByYXRlZCB2aWRlb3MnLCB7IGxpbWl0LCB0YWdJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYnVsa1Vwc2VydFJhdGluZ3MocmF0aW5nczogQXJyYXk8e1xuICAgIHZpZGVvSWQ6IHN0cmluZztcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICB0YWdJZDogc3RyaW5nO1xuICAgIGxldmVsOiBudW1iZXI7XG4gIH0+KTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aW1lUmF0aW5nT3BlcmF0aW9uKCdidWxrX3Vwc2VydCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBidWxrIHJhdGluZyB1cHNlcnQnLCB7IGNvdW50OiByYXRpbmdzLmxlbmd0aCB9KVxuICAgICAgICBcbiAgICAgICAgLy8gVXNlIHRyYW5zYWN0aW9uIGZvciBjb25zaXN0ZW5jeVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi4kdHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgICAgY29uc3QgdXBzZXJ0UHJvbWlzZXMgPSByYXRpbmdzLm1hcChyYXRpbmcgPT4gXG4gICAgICAgICAgICB0eC5yYXRpbmcudXBzZXJ0KHtcbiAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICB2aWRlb0lkX3VzZXJJZF90YWdJZDoge1xuICAgICAgICAgICAgICAgICAgdmlkZW9JZDogcmF0aW5nLnZpZGVvSWQsXG4gICAgICAgICAgICAgICAgICB1c2VySWQ6IHJhdGluZy51c2VySWQsXG4gICAgICAgICAgICAgICAgICB0YWdJZDogcmF0aW5nLnRhZ0lkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICAgICAgICBsZXZlbDogcmF0aW5nLmxldmVsLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICAgICAgICB2aWRlb0lkOiByYXRpbmcudmlkZW9JZCxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHJhdGluZy51c2VySWQsXG4gICAgICAgICAgICAgICAgdGFnSWQ6IHJhdGluZy50YWdJZCxcbiAgICAgICAgICAgICAgICBsZXZlbDogcmF0aW5nLmxldmVsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG5cbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwodXBzZXJ0UHJvbWlzZXMpXG4gICAgICAgIH0pXG5cbiAgICAgICAgbG9nZ2VyLmluZm8oJ0J1bGsgcmF0aW5nIHVwc2VydCBjb21wbGV0ZWQnLCB7IFxuICAgICAgICAgIGNvdW50OiByYXRpbmdzLmxlbmd0aCxcbiAgICAgICAgICBzdWNjZXNzZnVsOiByZXN1bHQubGVuZ3RoIFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlc3VsdFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBidWxrIHJhdGluZyB1cHNlcnQnLCB7IFxuICAgICAgICAgIGNvdW50OiByYXRpbmdzLmxlbmd0aCwgXG4gICAgICAgICAgZXJyb3IgXG4gICAgICAgIH0pXG4gICAgICAgIHRocm93IGVycm9yXG4gICAgICB9XG4gICAgfSwgeyByYXRpbmdzQ291bnQ6IHJhdGluZ3MubGVuZ3RoIH0pXG4gIH1cblxuICBhc3luYyBnZXRSYXRpbmdzQnlWaWRlb0lkcyh2aWRlb0lkczogc3RyaW5nW10pOiBQcm9taXNlPE1hcDxzdHJpbmcsIGFueVtdPj4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodmlkZW9JZHMubGVuZ3RoID09PSAwKSByZXR1cm4gbmV3IE1hcCgpXG5cbiAgICAgIGNvbnN0IHJhdGluZ3MgPSBhd2FpdCBkYi5yYXRpbmcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHZpZGVvSWQ6IHtcbiAgICAgICAgICAgIGluOiB2aWRlb0lkc1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgdXNlcm5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGF2YXRhcjogdHJ1ZSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgY3JlYXRlZEF0OiAnZGVzYydcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgLy8gR3JvdXAgcmF0aW5ncyBieSB2aWRlbyBJRFxuICAgICAgY29uc3QgcmF0aW5nc0J5VmlkZW8gPSBuZXcgTWFwPHN0cmluZywgYW55W10+KClcbiAgICAgIHJhdGluZ3MuZm9yRWFjaChyYXRpbmcgPT4ge1xuICAgICAgICBpZiAoIXJhdGluZ3NCeVZpZGVvLmhhcyhyYXRpbmcudmlkZW9JZCkpIHtcbiAgICAgICAgICByYXRpbmdzQnlWaWRlby5zZXQocmF0aW5nLnZpZGVvSWQsIFtdKVxuICAgICAgICB9XG4gICAgICAgIHJhdGluZ3NCeVZpZGVvLmdldChyYXRpbmcudmlkZW9JZCkhLnB1c2gocmF0aW5nKVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHJhdGluZ3NCeVZpZGVvXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyByYXRpbmdzIGJ5IHZpZGVvIElEcycsIHsgdmlkZW9JZHM6IHZpZGVvSWRzLmxlbmd0aCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0QXZlcmFnZVJhdGluZ3NCeVZpZGVvSWRzKHZpZGVvSWRzOiBzdHJpbmdbXSwgdGFnSWQ/OiBzdHJpbmcpOiBQcm9taXNlPE1hcDxzdHJpbmcsIG51bWJlcj4+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKHZpZGVvSWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG5ldyBNYXAoKVxuXG4gICAgICBjb25zdCB3aGVyZTogYW55ID0ge1xuICAgICAgICB2aWRlb0lkOiB7XG4gICAgICAgICAgaW46IHZpZGVvSWRzXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICh0YWdJZCkge1xuICAgICAgICB3aGVyZS50YWdJZCA9IHRhZ0lkXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGF2ZXJhZ2VzID0gYXdhaXQgZGIucmF0aW5nLmdyb3VwQnkoe1xuICAgICAgICBieTogWyd2aWRlb0lkJ10sXG4gICAgICAgIHdoZXJlLFxuICAgICAgICBfYXZnOiB7XG4gICAgICAgICAgbGV2ZWw6IHRydWVcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgY29uc3QgYXZlcmFnZU1hcCA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KClcbiAgICAgIGF2ZXJhZ2VzLmZvckVhY2goYXZnID0+IHtcbiAgICAgICAgYXZlcmFnZU1hcC5zZXQoYXZnLnZpZGVvSWQsIGF2Zy5fYXZnLmxldmVsIHx8IDApXG4gICAgICB9KVxuXG4gICAgICByZXR1cm4gYXZlcmFnZU1hcFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgYXZlcmFnZSByYXRpbmdzIGJ5IHZpZGVvIElEcycsIHsgdmlkZW9JZHM6IHZpZGVvSWRzLmxlbmd0aCwgdGFnSWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxufVxuXG4vLyBFeHBvcnQgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgcmF0aW5nUmVwb3NpdG9yeSA9IG5ldyBSYXRpbmdSZXBvc2l0b3J5SW1wbCgpIl0sIm5hbWVzIjpbIkJhc2VSZXBvc2l0b3J5IiwiZGIiLCJsb2dnZXIiLCJ0aW1lUmF0aW5nT3BlcmF0aW9uIiwiUmF0aW5nUmVwb3NpdG9yeUltcGwiLCJmaW5kQnlWaWRlb0lkIiwidmlkZW9JZCIsInJhdGluZ3MiLCJyYXRpbmciLCJmaW5kTWFueSIsIndoZXJlIiwiaW5jbHVkZSIsInVzZXIiLCJzZWxlY3QiLCJpZCIsInVzZXJuYW1lIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJhdmF0YXIiLCJ0YWciLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwiZXJyb3IiLCJmaW5kQnlVc2VySWQiLCJ1c2VySWQiLCJ2aWRlbyIsImZpbmRCeVVzZXJBbmRWaWRlbyIsInVwc2VydFJhdGluZyIsInRhZ0lkIiwibGV2ZWwiLCJ1cHNlcnQiLCJ2aWRlb0lkX3VzZXJJZF90YWdJZCIsInVwZGF0ZSIsImNyZWF0ZSIsImluZm8iLCJkZWxldGVSYXRpbmciLCJkZWxldGUiLCJnZXRBdmVyYWdlUmF0aW5nIiwicmVzdWx0IiwiYWdncmVnYXRlIiwiX2F2ZyIsImdldFJhdGluZ0Rpc3RyaWJ1dGlvbiIsImRpc3RyaWJ1dGlvbiIsImdyb3VwQnkiLCJieSIsIl9jb3VudCIsIm1hcCIsIml0ZW0iLCJjb3VudCIsImdldFVzZXJSYXRpbmdGb3JWaWRlbyIsImZpbmRVbmlxdWUiLCJnZXRUb3BSYXRlZFZpZGVvcyIsImxpbWl0IiwidG9wUmF0ZWQiLCJoYXZpbmciLCJndGUiLCJ0YWtlIiwiYXZlcmFnZVJhdGluZyIsInJhdGluZ0NvdW50IiwiYnVsa1Vwc2VydFJhdGluZ3MiLCJsZW5ndGgiLCIkdHJhbnNhY3Rpb24iLCJ0eCIsInVwc2VydFByb21pc2VzIiwidXBkYXRlZEF0IiwiRGF0ZSIsIlByb21pc2UiLCJhbGwiLCJzdWNjZXNzZnVsIiwicmF0aW5nc0NvdW50IiwiZ2V0UmF0aW5nc0J5VmlkZW9JZHMiLCJ2aWRlb0lkcyIsIk1hcCIsImluIiwicmF0aW5nc0J5VmlkZW8iLCJmb3JFYWNoIiwiaGFzIiwic2V0IiwiZ2V0IiwicHVzaCIsImdldEF2ZXJhZ2VSYXRpbmdzQnlWaWRlb0lkcyIsImF2ZXJhZ2VzIiwiYXZlcmFnZU1hcCIsImF2ZyIsInRhYmxlTmFtZSIsInJhdGluZ1JlcG9zaXRvcnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/repositories/rating.repository.ts\n");

/***/ }),

/***/ "(api)/./src/repositories/tag.repository.ts":
/*!********************************************!*\
  !*** ./src/repositories/tag.repository.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TagRepositoryImpl: () => (/* binding */ TagRepositoryImpl),\n/* harmony export */   tagRepository: () => (/* binding */ tagRepository)\n/* harmony export */ });\n/* harmony import */ var _base_repository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base.repository */ \"(api)/./src/repositories/base.repository.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/logger */ \"(api)/./src/lib/logger.ts\");\n\n\n\nclass TagRepositoryImpl extends _base_repository__WEBPACK_IMPORTED_MODULE_0__.BaseRepository {\n    async findByName(name) {\n        try {\n            const tag = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findUnique({\n                where: {\n                    name\n                }\n            });\n            return tag;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding tag by name\", {\n                name,\n                error\n            });\n            throw error;\n        }\n    }\n    async findOrCreate(name) {\n        try {\n            const tag = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.upsert({\n                where: {\n                    name\n                },\n                update: {},\n                create: {\n                    name\n                }\n            });\n            return tag;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding or creating tag\", {\n                name,\n                error\n            });\n            throw error;\n        }\n    }\n    async findManyByNames(names) {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                where: {\n                    name: {\n                        in: names\n                    }\n                }\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding tags by names\", {\n                names,\n                error\n            });\n            throw error;\n        }\n    }\n    async searchTags(query, limit = 10) {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                where: {\n                    name: {\n                        contains: query,\n                        mode: \"insensitive\"\n                    }\n                },\n                take: limit,\n                orderBy: {\n                    name: \"asc\"\n                }\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error searching tags\", {\n                query,\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    async getPopularTags(limit = 20) {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                include: {\n                    _count: {\n                        select: {\n                            videos: true\n                        }\n                    }\n                },\n                orderBy: {\n                    videos: {\n                        _count: \"desc\"\n                    }\n                },\n                take: limit\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting popular tags\", {\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    async getTagsWithVideoCount() {\n        try {\n            const tagsWithCount = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                include: {\n                    _count: {\n                        select: {\n                            videos: true\n                        }\n                    }\n                },\n                orderBy: {\n                    name: \"asc\"\n                }\n            });\n            return tagsWithCount.map((tag)=>({\n                    ...tag,\n                    videoCount: tag._count.videos\n                }));\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting tags with video count\", {\n                error\n            });\n            throw error;\n        }\n    }\n    async getTagsByVideoId(videoId) {\n        try {\n            const videoTags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.videoTag.findMany({\n                where: {\n                    videoId\n                },\n                include: {\n                    tag: true\n                }\n            });\n            return videoTags.map((vt)=>vt.tag);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting tags by video id\", {\n                videoId,\n                error\n            });\n            throw error;\n        }\n    }\n    async createMultiple(names) {\n        try {\n            // Filter out existing tags\n            const existingTags = await this.findManyByNames(names);\n            const existingNames = existingTags.map((tag)=>tag.name);\n            const newNames = names.filter((name)=>!existingNames.includes(name));\n            if (newNames.length === 0) {\n                return existingTags;\n            }\n            // Create new tags\n            const newTags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.createMany({\n                data: newNames.map((name)=>({\n                        name\n                    })),\n                skipDuplicates: true\n            });\n            // Return all tags (existing + new)\n            return this.findManyByNames(names);\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error creating multiple tags\", {\n                names,\n                error\n            });\n            throw error;\n        }\n    }\n    async getTagUsageStats(tagId) {\n        try {\n            const [videoCount, ratingStats] = await Promise.all([\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.videoTag.count({\n                    where: {\n                        tagId\n                    }\n                }),\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.aggregate({\n                    where: {\n                        tagId\n                    },\n                    _count: {\n                        level: true\n                    },\n                    _avg: {\n                        level: true\n                    }\n                })\n            ]);\n            return {\n                totalVideos: videoCount,\n                totalRatings: ratingStats._count.level,\n                averageRating: ratingStats._avg.level || 0\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting tag usage stats\", {\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getTrendingTags(days = 7, limit = 10) {\n        try {\n            const dateThreshold = new Date();\n            dateThreshold.setDate(dateThreshold.getDate() - days);\n            const trendingTags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                include: {\n                    videos: {\n                        where: {\n                            video: {\n                                createdAt: {\n                                    gte: dateThreshold\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n            const tagsWithCounts = trendingTags.map((tag)=>({\n                    ...tag,\n                    recentVideos: tag.videos.length\n                })).filter((tag)=>tag.recentVideos > 0).sort((a, b)=>b.recentVideos - a.recentVideos).slice(0, limit);\n            return tagsWithCounts;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting trending tags\", {\n                days,\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    async findAllWithCounts() {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                include: {\n                    _count: {\n                        select: {\n                            videos: true\n                        }\n                    }\n                },\n                orderBy: {\n                    name: \"asc\"\n                }\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding all tags with counts\", {\n                error\n            });\n            throw error;\n        }\n    }\n    async findPopular(limit = 20) {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                include: {\n                    _count: {\n                        select: {\n                            videos: true\n                        }\n                    }\n                },\n                orderBy: {\n                    videos: {\n                        _count: \"desc\"\n                    }\n                },\n                take: limit\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding popular tags\", {\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    async search(query, limit = 10) {\n        try {\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                where: {\n                    name: {\n                        contains: query,\n                        mode: \"insensitive\"\n                    }\n                },\n                take: limit,\n                orderBy: {\n                    name: \"asc\"\n                }\n            });\n            return tags;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error searching tags\", {\n                query,\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    constructor(...args){\n        super(...args);\n        this.tableName = \"tag\";\n    }\n}\n// Export singleton instance\nconst tagRepository = new TagRepositoryImpl();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcmVwb3NpdG9yaWVzL3RhZy5yZXBvc2l0b3J5LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ2tEO0FBQ3BCO0FBQ1E7QUFFL0IsTUFBTUcsMEJBQTBCSCw0REFBY0E7SUFHbkQsTUFBTUksV0FBV0MsSUFBWSxFQUF1QjtRQUNsRCxJQUFJO1lBQ0YsTUFBTUMsTUFBTSxNQUFNTCx1Q0FBRUEsQ0FBQ0ssR0FBRyxDQUFDQyxVQUFVLENBQUM7Z0JBQ2xDQyxPQUFPO29CQUFFSDtnQkFBSztZQUNoQjtZQUNBLE9BQU9DO1FBQ1QsRUFBRSxPQUFPRyxPQUFPO1lBQ2RQLCtDQUFNQSxDQUFDTyxLQUFLLENBQUMsNkJBQTZCO2dCQUFFSjtnQkFBTUk7WUFBTTtZQUN4RCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNQyxhQUFhTCxJQUFZLEVBQWdCO1FBQzdDLElBQUk7WUFDRixNQUFNQyxNQUFNLE1BQU1MLHVDQUFFQSxDQUFDSyxHQUFHLENBQUNLLE1BQU0sQ0FBQztnQkFDOUJILE9BQU87b0JBQUVIO2dCQUFLO2dCQUNkTyxRQUFRLENBQUM7Z0JBQ1RDLFFBQVE7b0JBQUVSO2dCQUFLO1lBQ2pCO1lBQ0EsT0FBT0M7UUFDVCxFQUFFLE9BQU9HLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyxpQ0FBaUM7Z0JBQUVKO2dCQUFNSTtZQUFNO1lBQzVELE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1LLGdCQUFnQkMsS0FBZSxFQUFrQjtRQUNyRCxJQUFJO1lBQ0YsTUFBTUMsT0FBTyxNQUFNZix1Q0FBRUEsQ0FBQ0ssR0FBRyxDQUFDVyxRQUFRLENBQUM7Z0JBQ2pDVCxPQUFPO29CQUNMSCxNQUFNO3dCQUNKYSxJQUFJSDtvQkFDTjtnQkFDRjtZQUNGO1lBQ0EsT0FBT0M7UUFDVCxFQUFFLE9BQU9QLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQywrQkFBK0I7Z0JBQUVNO2dCQUFPTjtZQUFNO1lBQzNELE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1VLFdBQVdDLEtBQWEsRUFBRUMsUUFBZ0IsRUFBRSxFQUFrQjtRQUNsRSxJQUFJO1lBQ0YsTUFBTUwsT0FBTyxNQUFNZix1Q0FBRUEsQ0FBQ0ssR0FBRyxDQUFDVyxRQUFRLENBQUM7Z0JBQ2pDVCxPQUFPO29CQUNMSCxNQUFNO3dCQUNKaUIsVUFBVUY7d0JBQ1ZHLE1BQU07b0JBQ1I7Z0JBQ0Y7Z0JBQ0FDLE1BQU1IO2dCQUNOSSxTQUFTO29CQUNQcEIsTUFBTTtnQkFDUjtZQUNGO1lBQ0EsT0FBT1c7UUFDVCxFQUFFLE9BQU9QLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyx3QkFBd0I7Z0JBQUVXO2dCQUFPQztnQkFBT1o7WUFBTTtZQUMzRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNaUIsZUFBZUwsUUFBZ0IsRUFBRSxFQUFrQjtRQUN2RCxJQUFJO1lBQ0YsTUFBTUwsT0FBTyxNQUFNZix1Q0FBRUEsQ0FBQ0ssR0FBRyxDQUFDVyxRQUFRLENBQUM7Z0JBQ2pDVSxTQUFTO29CQUNQQyxRQUFRO3dCQUNOQyxRQUFROzRCQUNOQyxRQUFRO3dCQUNWO29CQUNGO2dCQUNGO2dCQUNBTCxTQUFTO29CQUNQSyxRQUFRO3dCQUNORixRQUFRO29CQUNWO2dCQUNGO2dCQUNBSixNQUFNSDtZQUNSO1lBQ0EsT0FBT0w7UUFDVCxFQUFFLE9BQU9QLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyw4QkFBOEI7Z0JBQUVZO2dCQUFPWjtZQUFNO1lBQzFELE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1zQix3QkFBd0M7UUFDNUMsSUFBSTtZQUNGLE1BQU1DLGdCQUFnQixNQUFNL0IsdUNBQUVBLENBQUNLLEdBQUcsQ0FBQ1csUUFBUSxDQUFDO2dCQUMxQ1UsU0FBUztvQkFDUEMsUUFBUTt3QkFDTkMsUUFBUTs0QkFDTkMsUUFBUTt3QkFDVjtvQkFDRjtnQkFDRjtnQkFDQUwsU0FBUztvQkFDUHBCLE1BQU07Z0JBQ1I7WUFDRjtZQUVBLE9BQU8yQixjQUFjQyxHQUFHLENBQUMzQixDQUFBQSxNQUFRO29CQUMvQixHQUFHQSxHQUFHO29CQUNONEIsWUFBWTVCLElBQUlzQixNQUFNLENBQUNFLE1BQU07Z0JBQy9CO1FBQ0YsRUFBRSxPQUFPckIsT0FBTztZQUNkUCwrQ0FBTUEsQ0FBQ08sS0FBSyxDQUFDLHVDQUF1QztnQkFBRUE7WUFBTTtZQUM1RCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNMEIsaUJBQWlCQyxPQUFlLEVBQWtCO1FBQ3RELElBQUk7WUFDRixNQUFNQyxZQUFZLE1BQU1wQyx1Q0FBRUEsQ0FBQ3FDLFFBQVEsQ0FBQ3JCLFFBQVEsQ0FBQztnQkFDM0NULE9BQU87b0JBQUU0QjtnQkFBUTtnQkFDakJULFNBQVM7b0JBQ1ByQixLQUFLO2dCQUNQO1lBQ0Y7WUFFQSxPQUFPK0IsVUFBVUosR0FBRyxDQUFDTSxDQUFBQSxLQUFNQSxHQUFHakMsR0FBRztRQUNuQyxFQUFFLE9BQU9HLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyxrQ0FBa0M7Z0JBQUUyQjtnQkFBUzNCO1lBQU07WUFDaEUsTUFBTUE7UUFDUjtJQUNGO0lBRUEsTUFBTStCLGVBQWV6QixLQUFlLEVBQWtCO1FBQ3BELElBQUk7WUFDRiwyQkFBMkI7WUFDM0IsTUFBTTBCLGVBQWUsTUFBTSxJQUFJLENBQUMzQixlQUFlLENBQUNDO1lBQ2hELE1BQU0yQixnQkFBZ0JELGFBQWFSLEdBQUcsQ0FBQzNCLENBQUFBLE1BQU9BLElBQUlELElBQUk7WUFDdEQsTUFBTXNDLFdBQVc1QixNQUFNNkIsTUFBTSxDQUFDdkMsQ0FBQUEsT0FBUSxDQUFDcUMsY0FBY0csUUFBUSxDQUFDeEM7WUFFOUQsSUFBSXNDLFNBQVNHLE1BQU0sS0FBSyxHQUFHO2dCQUN6QixPQUFPTDtZQUNUO1lBRUEsa0JBQWtCO1lBQ2xCLE1BQU1NLFVBQVUsTUFBTTlDLHVDQUFFQSxDQUFDSyxHQUFHLENBQUMwQyxVQUFVLENBQUM7Z0JBQ3RDQyxNQUFNTixTQUFTVixHQUFHLENBQUM1QixDQUFBQSxPQUFTO3dCQUFFQTtvQkFBSztnQkFDbkM2QyxnQkFBZ0I7WUFDbEI7WUFFQSxtQ0FBbUM7WUFDbkMsT0FBTyxJQUFJLENBQUNwQyxlQUFlLENBQUNDO1FBQzlCLEVBQUUsT0FBT04sT0FBTztZQUNkUCwrQ0FBTUEsQ0FBQ08sS0FBSyxDQUFDLGdDQUFnQztnQkFBRU07Z0JBQU9OO1lBQU07WUFDNUQsTUFBTUE7UUFDUjtJQUNGO0lBRUEsTUFBTTBDLGlCQUFpQkMsS0FBYSxFQUlqQztRQUNELElBQUk7WUFDRixNQUFNLENBQUNsQixZQUFZbUIsWUFBWSxHQUFHLE1BQU1DLFFBQVFDLEdBQUcsQ0FBQztnQkFDbER0RCx1Q0FBRUEsQ0FBQ3FDLFFBQVEsQ0FBQ2tCLEtBQUssQ0FBQztvQkFDaEJoRCxPQUFPO3dCQUFFNEM7b0JBQU07Z0JBQ2pCO2dCQUNBbkQsdUNBQUVBLENBQUN3RCxNQUFNLENBQUNDLFNBQVMsQ0FBQztvQkFDbEJsRCxPQUFPO3dCQUFFNEM7b0JBQU07b0JBQ2Z4QixRQUFRO3dCQUNOK0IsT0FBTztvQkFDVDtvQkFDQUMsTUFBTTt3QkFDSkQsT0FBTztvQkFDVDtnQkFDRjthQUNEO1lBRUQsT0FBTztnQkFDTEUsYUFBYTNCO2dCQUNiNEIsY0FBY1QsWUFBWXpCLE1BQU0sQ0FBQytCLEtBQUs7Z0JBQ3RDSSxlQUFlVixZQUFZTyxJQUFJLENBQUNELEtBQUssSUFBSTtZQUMzQztRQUNGLEVBQUUsT0FBT2xELE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyxpQ0FBaUM7Z0JBQUUyQztnQkFBTzNDO1lBQU07WUFDN0QsTUFBTUE7UUFDUjtJQUNGO0lBRUEsTUFBTXVELGdCQUFnQkMsT0FBZSxDQUFDLEVBQUU1QyxRQUFnQixFQUFFLEVBQWtCO1FBQzFFLElBQUk7WUFDRixNQUFNNkMsZ0JBQWdCLElBQUlDO1lBQzFCRCxjQUFjRSxPQUFPLENBQUNGLGNBQWNHLE9BQU8sS0FBS0o7WUFFaEQsTUFBTUssZUFBZSxNQUFNckUsdUNBQUVBLENBQUNLLEdBQUcsQ0FBQ1csUUFBUSxDQUFDO2dCQUN6Q1UsU0FBUztvQkFDUEcsUUFBUTt3QkFDTnRCLE9BQU87NEJBQ0wrRCxPQUFPO2dDQUNMQyxXQUFXO29DQUNUQyxLQUFLUDtnQ0FDUDs0QkFDRjt3QkFDRjtvQkFDRjtnQkFDRjtZQUNGO1lBRUEsTUFBTVEsaUJBQWlCSixhQUNwQnJDLEdBQUcsQ0FBQzNCLENBQUFBLE1BQVE7b0JBQ1gsR0FBR0EsR0FBRztvQkFDTnFFLGNBQWNyRSxJQUFJd0IsTUFBTSxDQUFDZ0IsTUFBTTtnQkFDakMsSUFDQ0YsTUFBTSxDQUFDdEMsQ0FBQUEsTUFBT0EsSUFBSXFFLFlBQVksR0FBRyxHQUNqQ0MsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU1BLEVBQUVILFlBQVksR0FBR0UsRUFBRUYsWUFBWSxFQUM5Q0ksS0FBSyxDQUFDLEdBQUcxRDtZQUVaLE9BQU9xRDtRQUNULEVBQUUsT0FBT2pFLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQywrQkFBK0I7Z0JBQUV3RDtnQkFBTTVDO2dCQUFPWjtZQUFNO1lBQ2pFLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU11RSxvQkFBb0M7UUFDeEMsSUFBSTtZQUNGLE1BQU1oRSxPQUFPLE1BQU1mLHVDQUFFQSxDQUFDSyxHQUFHLENBQUNXLFFBQVEsQ0FBQztnQkFDakNVLFNBQVM7b0JBQ1BDLFFBQVE7d0JBQ05DLFFBQVE7NEJBQ05DLFFBQVE7d0JBQ1Y7b0JBQ0Y7Z0JBQ0Y7Z0JBQ0FMLFNBQVM7b0JBQ1BwQixNQUFNO2dCQUNSO1lBQ0Y7WUFDQSxPQUFPVztRQUNULEVBQUUsT0FBT1AsT0FBTztZQUNkUCwrQ0FBTUEsQ0FBQ08sS0FBSyxDQUFDLHNDQUFzQztnQkFBRUE7WUFBTTtZQUMzRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNd0UsWUFBWTVELFFBQWdCLEVBQUUsRUFBa0I7UUFDcEQsSUFBSTtZQUNGLE1BQU1MLE9BQU8sTUFBTWYsdUNBQUVBLENBQUNLLEdBQUcsQ0FBQ1csUUFBUSxDQUFDO2dCQUNqQ1UsU0FBUztvQkFDUEMsUUFBUTt3QkFDTkMsUUFBUTs0QkFDTkMsUUFBUTt3QkFDVjtvQkFDRjtnQkFDRjtnQkFDQUwsU0FBUztvQkFDUEssUUFBUTt3QkFDTkYsUUFBUTtvQkFDVjtnQkFDRjtnQkFDQUosTUFBTUg7WUFDUjtZQUNBLE9BQU9MO1FBQ1QsRUFBRSxPQUFPUCxPQUFPO1lBQ2RQLCtDQUFNQSxDQUFDTyxLQUFLLENBQUMsOEJBQThCO2dCQUFFWTtnQkFBT1o7WUFBTTtZQUMxRCxNQUFNQTtRQUNSO0lBQ0Y7SUFFQSxNQUFNeUUsT0FBTzlELEtBQWEsRUFBRUMsUUFBZ0IsRUFBRSxFQUFrQjtRQUM5RCxJQUFJO1lBQ0YsTUFBTUwsT0FBTyxNQUFNZix1Q0FBRUEsQ0FBQ0ssR0FBRyxDQUFDVyxRQUFRLENBQUM7Z0JBQ2pDVCxPQUFPO29CQUNMSCxNQUFNO3dCQUNKaUIsVUFBVUY7d0JBQ1ZHLE1BQU07b0JBQ1I7Z0JBQ0Y7Z0JBQ0FDLE1BQU1IO2dCQUNOSSxTQUFTO29CQUNQcEIsTUFBTTtnQkFDUjtZQUNGO1lBQ0EsT0FBT1c7UUFDVCxFQUFFLE9BQU9QLE9BQU87WUFDZFAsK0NBQU1BLENBQUNPLEtBQUssQ0FBQyx3QkFBd0I7Z0JBQUVXO2dCQUFPQztnQkFBT1o7WUFBTTtZQUMzRCxNQUFNQTtRQUNSO0lBQ0Y7OzthQTlSVTBFLFlBQVk7O0FBK1J4QjtBQUVBLDRCQUE0QjtBQUNyQixNQUFNQyxnQkFBZ0IsSUFBSWpGLG9CQUFtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3JhdGVteS1uZXh0anMvLi9zcmMvcmVwb3NpdG9yaWVzL3RhZy5yZXBvc2l0b3J5LnRzP2JkZjciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGFnIH0gZnJvbSAnLi4vdHlwZXMnXG5pbXBvcnQgeyBCYXNlUmVwb3NpdG9yeSB9IGZyb20gJy4vYmFzZS5yZXBvc2l0b3J5J1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9saWIvZGInXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9saWIvbG9nZ2VyJ1xuXG5leHBvcnQgY2xhc3MgVGFnUmVwb3NpdG9yeUltcGwgZXh0ZW5kcyBCYXNlUmVwb3NpdG9yeTxUYWc+IHtcbiAgcHJvdGVjdGVkIHRhYmxlTmFtZSA9ICd0YWcnXG5cbiAgYXN5bmMgZmluZEJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPGFueSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdGFnID0gYXdhaXQgZGIudGFnLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBuYW1lIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gdGFnXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZmluZGluZyB0YWcgYnkgbmFtZScsIHsgbmFtZSwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmluZE9yQ3JlYXRlKG5hbWU6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZyA9IGF3YWl0IGRiLnRhZy51cHNlcnQoe1xuICAgICAgICB3aGVyZTogeyBuYW1lIH0sXG4gICAgICAgIHVwZGF0ZToge30sXG4gICAgICAgIGNyZWF0ZTogeyBuYW1lIH1cbiAgICAgIH0pXG4gICAgICByZXR1cm4gdGFnXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZmluZGluZyBvciBjcmVhdGluZyB0YWcnLCB7IG5hbWUsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZpbmRNYW55QnlOYW1lcyhuYW1lczogc3RyaW5nW10pOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZ3MgPSBhd2FpdCBkYi50YWcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGluOiBuYW1lc1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHJldHVybiB0YWdzXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZmluZGluZyB0YWdzIGJ5IG5hbWVzJywgeyBuYW1lcywgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2VhcmNoVGFncyhxdWVyeTogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMTApOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZ3MgPSBhd2FpdCBkYi50YWcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGNvbnRhaW5zOiBxdWVyeSxcbiAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgbmFtZTogJ2FzYydcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHJldHVybiB0YWdzXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igc2VhcmNoaW5nIHRhZ3MnLCB7IHF1ZXJ5LCBsaW1pdCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0UG9wdWxhclRhZ3MobGltaXQ6IG51bWJlciA9IDIwKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0YWdzID0gYXdhaXQgZGIudGFnLmZpbmRNYW55KHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHZpZGVvczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeToge1xuICAgICAgICAgIHZpZGVvczoge1xuICAgICAgICAgICAgX2NvdW50OiAnZGVzYydcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IGxpbWl0XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRhZ3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHBvcHVsYXIgdGFncycsIHsgbGltaXQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFRhZ3NXaXRoVmlkZW9Db3VudCgpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZ3NXaXRoQ291bnQgPSBhd2FpdCBkYi50YWcuZmluZE1hbnkoe1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgdmlkZW9zOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgbmFtZTogJ2FzYydcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRhZ3NXaXRoQ291bnQubWFwKHRhZyA9PiAoe1xuICAgICAgICAuLi50YWcsXG4gICAgICAgIHZpZGVvQ291bnQ6IHRhZy5fY291bnQudmlkZW9zXG4gICAgICB9KSlcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRhZ3Mgd2l0aCB2aWRlbyBjb3VudCcsIHsgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VGFnc0J5VmlkZW9JZCh2aWRlb0lkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZpZGVvVGFncyA9IGF3YWl0IGRiLnZpZGVvVGFnLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgdmlkZW9JZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB2aWRlb1RhZ3MubWFwKHZ0ID0+IHZ0LnRhZylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRhZ3MgYnkgdmlkZW8gaWQnLCB7IHZpZGVvSWQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZU11bHRpcGxlKG5hbWVzOiBzdHJpbmdbXSk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlsdGVyIG91dCBleGlzdGluZyB0YWdzXG4gICAgICBjb25zdCBleGlzdGluZ1RhZ3MgPSBhd2FpdCB0aGlzLmZpbmRNYW55QnlOYW1lcyhuYW1lcylcbiAgICAgIGNvbnN0IGV4aXN0aW5nTmFtZXMgPSBleGlzdGluZ1RhZ3MubWFwKHRhZyA9PiB0YWcubmFtZSlcbiAgICAgIGNvbnN0IG5ld05hbWVzID0gbmFtZXMuZmlsdGVyKG5hbWUgPT4gIWV4aXN0aW5nTmFtZXMuaW5jbHVkZXMobmFtZSkpXG5cbiAgICAgIGlmIChuZXdOYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nVGFnc1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgbmV3IHRhZ3NcbiAgICAgIGNvbnN0IG5ld1RhZ3MgPSBhd2FpdCBkYi50YWcuY3JlYXRlTWFueSh7XG4gICAgICAgIGRhdGE6IG5ld05hbWVzLm1hcChuYW1lID0+ICh7IG5hbWUgfSkpLFxuICAgICAgICBza2lwRHVwbGljYXRlczogdHJ1ZVxuICAgICAgfSlcblxuICAgICAgLy8gUmV0dXJuIGFsbCB0YWdzIChleGlzdGluZyArIG5ldylcbiAgICAgIHJldHVybiB0aGlzLmZpbmRNYW55QnlOYW1lcyhuYW1lcylcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjcmVhdGluZyBtdWx0aXBsZSB0YWdzJywgeyBuYW1lcywgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VGFnVXNhZ2VTdGF0cyh0YWdJZDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgdG90YWxWaWRlb3M6IG51bWJlclxuICAgIHRvdGFsUmF0aW5nczogbnVtYmVyXG4gICAgYXZlcmFnZVJhdGluZzogbnVtYmVyXG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgW3ZpZGVvQ291bnQsIHJhdGluZ1N0YXRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgZGIudmlkZW9UYWcuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7IHRhZ0lkIH1cbiAgICAgICAgfSksXG4gICAgICAgIGRiLnJhdGluZy5hZ2dyZWdhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IHRhZ0lkIH0sXG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBsZXZlbDogdHJ1ZVxuICAgICAgICAgIH0sXG4gICAgICAgICAgX2F2Zzoge1xuICAgICAgICAgICAgbGV2ZWw6IHRydWVcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICBdKVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbFZpZGVvczogdmlkZW9Db3VudCxcbiAgICAgICAgdG90YWxSYXRpbmdzOiByYXRpbmdTdGF0cy5fY291bnQubGV2ZWwsXG4gICAgICAgIGF2ZXJhZ2VSYXRpbmc6IHJhdGluZ1N0YXRzLl9hdmcubGV2ZWwgfHwgMFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdGFnIHVzYWdlIHN0YXRzJywgeyB0YWdJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VHJlbmRpbmdUYWdzKGRheXM6IG51bWJlciA9IDcsIGxpbWl0OiBudW1iZXIgPSAxMCk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0ZVRocmVzaG9sZCA9IG5ldyBEYXRlKClcbiAgICAgIGRhdGVUaHJlc2hvbGQuc2V0RGF0ZShkYXRlVGhyZXNob2xkLmdldERhdGUoKSAtIGRheXMpXG5cbiAgICAgIGNvbnN0IHRyZW5kaW5nVGFncyA9IGF3YWl0IGRiLnRhZy5maW5kTWFueSh7XG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB2aWRlb3M6IHtcbiAgICAgICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiB7XG4gICAgICAgICAgICAgICAgICBndGU6IGRhdGVUaHJlc2hvbGRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIGNvbnN0IHRhZ3NXaXRoQ291bnRzID0gdHJlbmRpbmdUYWdzXG4gICAgICAgIC5tYXAodGFnID0+ICh7XG4gICAgICAgICAgLi4udGFnLFxuICAgICAgICAgIHJlY2VudFZpZGVvczogdGFnLnZpZGVvcy5sZW5ndGhcbiAgICAgICAgfSkpXG4gICAgICAgIC5maWx0ZXIodGFnID0+IHRhZy5yZWNlbnRWaWRlb3MgPiAwKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gYi5yZWNlbnRWaWRlb3MgLSBhLnJlY2VudFZpZGVvcylcbiAgICAgICAgLnNsaWNlKDAsIGxpbWl0KVxuXG4gICAgICByZXR1cm4gdGFnc1dpdGhDb3VudHNcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRyZW5kaW5nIHRhZ3MnLCB7IGRheXMsIGxpbWl0LCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kQWxsV2l0aENvdW50cygpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZ3MgPSBhd2FpdCBkYi50YWcuZmluZE1hbnkoe1xuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgX2NvdW50OiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgdmlkZW9zOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgbmFtZTogJ2FzYydcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHJldHVybiB0YWdzXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZmluZGluZyBhbGwgdGFncyB3aXRoIGNvdW50cycsIHsgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmluZFBvcHVsYXIobGltaXQ6IG51bWJlciA9IDIwKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0YWdzID0gYXdhaXQgZGIudGFnLmZpbmRNYW55KHtcbiAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHZpZGVvczogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3JkZXJCeToge1xuICAgICAgICAgIHZpZGVvczoge1xuICAgICAgICAgICAgX2NvdW50OiAnZGVzYydcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IGxpbWl0XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRhZ3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBmaW5kaW5nIHBvcHVsYXIgdGFncycsIHsgbGltaXQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlYXJjaChxdWVyeTogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMTApOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRhZ3MgPSBhd2FpdCBkYi50YWcuZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIGNvbnRhaW5zOiBxdWVyeSxcbiAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZSdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHRha2U6IGxpbWl0LFxuICAgICAgICBvcmRlckJ5OiB7XG4gICAgICAgICAgbmFtZTogJ2FzYydcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIHJldHVybiB0YWdzXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3Igc2VhcmNoaW5nIHRhZ3MnLCB7IHF1ZXJ5LCBsaW1pdCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCB0YWdSZXBvc2l0b3J5ID0gbmV3IFRhZ1JlcG9zaXRvcnlJbXBsKCkiXSwibmFtZXMiOlsiQmFzZVJlcG9zaXRvcnkiLCJkYiIsImxvZ2dlciIsIlRhZ1JlcG9zaXRvcnlJbXBsIiwiZmluZEJ5TmFtZSIsIm5hbWUiLCJ0YWciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJlcnJvciIsImZpbmRPckNyZWF0ZSIsInVwc2VydCIsInVwZGF0ZSIsImNyZWF0ZSIsImZpbmRNYW55QnlOYW1lcyIsIm5hbWVzIiwidGFncyIsImZpbmRNYW55IiwiaW4iLCJzZWFyY2hUYWdzIiwicXVlcnkiLCJsaW1pdCIsImNvbnRhaW5zIiwibW9kZSIsInRha2UiLCJvcmRlckJ5IiwiZ2V0UG9wdWxhclRhZ3MiLCJpbmNsdWRlIiwiX2NvdW50Iiwic2VsZWN0IiwidmlkZW9zIiwiZ2V0VGFnc1dpdGhWaWRlb0NvdW50IiwidGFnc1dpdGhDb3VudCIsIm1hcCIsInZpZGVvQ291bnQiLCJnZXRUYWdzQnlWaWRlb0lkIiwidmlkZW9JZCIsInZpZGVvVGFncyIsInZpZGVvVGFnIiwidnQiLCJjcmVhdGVNdWx0aXBsZSIsImV4aXN0aW5nVGFncyIsImV4aXN0aW5nTmFtZXMiLCJuZXdOYW1lcyIsImZpbHRlciIsImluY2x1ZGVzIiwibGVuZ3RoIiwibmV3VGFncyIsImNyZWF0ZU1hbnkiLCJkYXRhIiwic2tpcER1cGxpY2F0ZXMiLCJnZXRUYWdVc2FnZVN0YXRzIiwidGFnSWQiLCJyYXRpbmdTdGF0cyIsIlByb21pc2UiLCJhbGwiLCJjb3VudCIsInJhdGluZyIsImFnZ3JlZ2F0ZSIsImxldmVsIiwiX2F2ZyIsInRvdGFsVmlkZW9zIiwidG90YWxSYXRpbmdzIiwiYXZlcmFnZVJhdGluZyIsImdldFRyZW5kaW5nVGFncyIsImRheXMiLCJkYXRlVGhyZXNob2xkIiwiRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwidHJlbmRpbmdUYWdzIiwidmlkZW8iLCJjcmVhdGVkQXQiLCJndGUiLCJ0YWdzV2l0aENvdW50cyIsInJlY2VudFZpZGVvcyIsInNvcnQiLCJhIiwiYiIsInNsaWNlIiwiZmluZEFsbFdpdGhDb3VudHMiLCJmaW5kUG9wdWxhciIsInNlYXJjaCIsInRhYmxlTmFtZSIsInRhZ1JlcG9zaXRvcnkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/repositories/tag.repository.ts\n");

/***/ }),

/***/ "(api)/./src/repositories/video.repository.ts":
/*!**********************************************!*\
  !*** ./src/repositories/video.repository.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   VideoRepositoryImpl: () => (/* binding */ VideoRepositoryImpl),\n/* harmony export */   videoRepository: () => (/* binding */ videoRepository)\n/* harmony export */ });\n/* harmony import */ var _base_repository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base.repository */ \"(api)/./src/repositories/base.repository.ts\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/db */ \"(api)/./src/lib/db.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/constants */ \"(api)/./src/lib/constants.ts\");\n\n\n\n\nclass VideoRepositoryImpl extends _base_repository__WEBPACK_IMPORTED_MODULE_0__.BaseRepository {\n    async findByUserId(userId) {\n        try {\n            const videos = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findMany({\n                where: {\n                    userId\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    ratings: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    username: true,\n                                    firstName: true,\n                                    lastName: true,\n                                    avatar: true\n                                }\n                            },\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            return videos;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding videos by user id\", {\n                userId,\n                error\n            });\n            throw error;\n        }\n    }\n    async findByTags(tags) {\n        try {\n            const videos = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findMany({\n                where: {\n                    tags: {\n                        some: {\n                            tag: {\n                                name: {\n                                    in: tags\n                                }\n                            }\n                        }\n                    }\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    ratings: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    username: true,\n                                    firstName: true,\n                                    lastName: true,\n                                    avatar: true\n                                }\n                            },\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            return videos;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding videos by tags\", {\n                tags,\n                error\n            });\n            throw error;\n        }\n    }\n    async search(query, includeNsfw = true) {\n        try {\n            const videos = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findMany({\n                where: {\n                    AND: [\n                        {\n                            OR: [\n                                {\n                                    title: {\n                                        contains: query,\n                                        mode: \"insensitive\"\n                                    }\n                                },\n                                {\n                                    description: {\n                                        contains: query,\n                                        mode: \"insensitive\"\n                                    }\n                                },\n                                {\n                                    tags: {\n                                        some: {\n                                            tag: {\n                                                name: {\n                                                    contains: query,\n                                                    mode: \"insensitive\"\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                            ]\n                        },\n                        ...includeNsfw ? [] : [\n                            {\n                                isNsfw: false\n                            }\n                        ]\n                    ]\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    ratings: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    username: true,\n                                    firstName: true,\n                                    lastName: true,\n                                    avatar: true\n                                }\n                            },\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                },\n                orderBy: {\n                    createdAt: \"desc\"\n                }\n            });\n            return videos;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error searching videos\", {\n                query,\n                error\n            });\n            throw error;\n        }\n    }\n    async findWithRatings(id) {\n        try {\n            const video = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findUnique({\n                where: {\n                    id\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    ratings: {\n                        include: {\n                            user: {\n                                select: {\n                                    id: true,\n                                    username: true,\n                                    firstName: true,\n                                    lastName: true,\n                                    avatar: true\n                                }\n                            },\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                }\n            });\n            return video;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding video with ratings\", {\n                id,\n                error\n            });\n            throw error;\n        }\n    }\n    async findWithFilters(filters) {\n        try {\n            const { search, tags, tagRatings, includeNsfw = true, userId, sortBy = \"createdAt\", sortOrder = \"desc\", page = 1, limit = _lib_constants__WEBPACK_IMPORTED_MODULE_3__.PAGINATION.DEFAULT_PAGE_SIZE } = filters;\n            const where = {};\n            // Add search filter\n            if (search) {\n                where.OR = [\n                    {\n                        title: {\n                            contains: search,\n                            mode: \"insensitive\"\n                        }\n                    },\n                    {\n                        description: {\n                            contains: search,\n                            mode: \"insensitive\"\n                        }\n                    }\n                ];\n            }\n            // Add tags filter\n            if (tags && tags.length > 0) {\n                where.tags = {\n                    some: {\n                        tag: {\n                            name: {\n                                in: tags\n                            }\n                        }\n                    }\n                };\n            }\n            // Add user filter\n            if (userId) {\n                where.userId = userId;\n            }\n            // Add NSFW filter\n            if (!includeNsfw) {\n                where.isNsfw = false;\n            }\n            // Add tagRatings filter - we'll filter by having the specified tags first\n            // then post-process to check rating ranges\n            if (tagRatings && tagRatings.length > 0) {\n                const tagNames = tagRatings.map((tr)=>tr.tagName);\n                // Ensure videos have all the specified tags\n                where.tags = {\n                    some: {\n                        tag: {\n                            name: {\n                                in: tagNames\n                            }\n                        }\n                    }\n                };\n            }\n            const skip = (page - 1) * limit;\n            // Build orderBy\n            const orderBy = {};\n            if (sortBy === \"ratings\") {\n                orderBy._count = {\n                    ratings: sortOrder\n                };\n            } else {\n                orderBy[sortBy] = sortOrder;\n            }\n            let [videos, total] = await Promise.all([\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findMany({\n                    where,\n                    include: {\n                        user: {\n                            select: {\n                                id: true,\n                                username: true,\n                                firstName: true,\n                                lastName: true,\n                                avatar: true\n                            }\n                        },\n                        tags: {\n                            include: {\n                                tag: true\n                            }\n                        },\n                        ratings: {\n                            include: {\n                                user: {\n                                    select: {\n                                        id: true,\n                                        username: true,\n                                        firstName: true,\n                                        lastName: true,\n                                        avatar: true\n                                    }\n                                },\n                                tag: true\n                            }\n                        },\n                        _count: {\n                            select: {\n                                ratings: true\n                            }\n                        }\n                    },\n                    orderBy,\n                    skip,\n                    take: limit * 2\n                }),\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.count({\n                    where\n                })\n            ]);\n            // Apply tagRatings filter in post-processing\n            if (tagRatings && tagRatings.length > 0) {\n                videos = videos.filter((video)=>{\n                    // Check if video has all required tags with ratings in the specified ranges\n                    return tagRatings.every(({ tagName, minRating, maxRating })=>{\n                        // Find the tag in the video\n                        const videoTag = video.tags.find((vt)=>vt.tag.name === tagName);\n                        if (!videoTag) return false;\n                        // Calculate average rating for this tag on this video\n                        const tagRatings = video.ratings.filter((r)=>r.tag.name === tagName);\n                        if (tagRatings.length === 0) return false;\n                        const averageRating = tagRatings.reduce((sum, r)=>sum + r.level, 0) / tagRatings.length;\n                        // Check if average rating is within the specified range\n                        return averageRating >= minRating && averageRating <= maxRating;\n                    });\n                });\n                // Update total count after filtering\n                total = videos.length;\n                // Apply pagination after filtering\n                videos = videos.slice(0, limit);\n            }\n            const totalPages = Math.ceil(total / limit);\n            return {\n                videos,\n                total,\n                totalPages\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error finding videos with filters\", {\n                filters,\n                error\n            });\n            throw error;\n        }\n    }\n    async createWithTags(videoData, tagNames) {\n        try {\n            const video = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.create({\n                data: {\n                    ...videoData,\n                    tags: {\n                        create: tagNames.map((tagName)=>({\n                                tag: {\n                                    connectOrCreate: {\n                                        where: {\n                                            name: tagName\n                                        },\n                                        create: {\n                                            name: tagName\n                                        }\n                                    }\n                                }\n                            }))\n                    }\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                }\n            });\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Created video with tags\", {\n                videoId: video.id,\n                tagNames\n            });\n            return video;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error creating video with tags\", {\n                videoData,\n                tagNames,\n                error\n            });\n            throw error;\n        }\n    }\n    async getVideoStats(videoId) {\n        try {\n            const [totalRatings, ratingsByTag] = await Promise.all([\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.count({\n                    where: {\n                        videoId\n                    }\n                }),\n                _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.rating.groupBy({\n                    by: [\n                        \"tagId\"\n                    ],\n                    where: {\n                        videoId\n                    },\n                    _avg: {\n                        level: true\n                    },\n                    _count: {\n                        level: true\n                    }\n                })\n            ]);\n            // Get tag names\n            const tagIds = ratingsByTag.map((r)=>r.tagId);\n            const tags = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.tag.findMany({\n                where: {\n                    id: {\n                        in: tagIds\n                    }\n                }\n            });\n            const tagMap = tags.reduce((acc, tag)=>{\n                acc[tag.id] = tag.name;\n                return acc;\n            }, {});\n            const averageRatingByTag = ratingsByTag.map((rating)=>({\n                    tagName: tagMap[rating.tagId] || \"Unknown\",\n                    averageRating: rating._avg.level || 0,\n                    count: rating._count.level\n                }));\n            return {\n                totalRatings,\n                averageRatingByTag\n            };\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting video stats\", {\n                videoId,\n                error\n            });\n            throw error;\n        }\n    }\n    async getTrendingVideos(limit = 10) {\n        try {\n            // Get videos with most ratings in the last 7 days\n            const sevenDaysAgo = new Date();\n            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n            const videos = await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.video.findMany({\n                where: {\n                    createdAt: {\n                        gte: sevenDaysAgo\n                    }\n                },\n                include: {\n                    user: {\n                        select: {\n                            id: true,\n                            username: true,\n                            firstName: true,\n                            lastName: true,\n                            avatar: true\n                        }\n                    },\n                    tags: {\n                        include: {\n                            tag: true\n                        }\n                    },\n                    _count: {\n                        select: {\n                            ratings: true\n                        }\n                    }\n                },\n                orderBy: {\n                    ratings: {\n                        _count: \"desc\"\n                    }\n                },\n                take: limit\n            });\n            return videos;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error getting trending videos\", {\n                limit,\n                error\n            });\n            throw error;\n        }\n    }\n    async addTagToVideo(videoId, tagId) {\n        try {\n            await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.videoTag.create({\n                data: {\n                    videoId,\n                    tagId\n                }\n            });\n        } catch (error) {\n            // Handle duplicate key error (tag already exists on video)\n            if (error instanceof Error && error.message.includes(\"Unique constraint\")) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.info(\"Tag already exists on video\", {\n                    videoId,\n                    tagId\n                });\n                return;\n            }\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error adding tag to video\", {\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    async removeTagFromVideo(videoId, tagId) {\n        try {\n            await _lib_db__WEBPACK_IMPORTED_MODULE_1__.db.videoTag.deleteMany({\n                where: {\n                    videoId,\n                    tagId\n                }\n            });\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_2__.logger.error(\"Error removing tag from video\", {\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    constructor(...args){\n        super(...args);\n        this.tableName = \"video\";\n    }\n}\n// Export singleton instance\nconst videoRepository = new VideoRepositoryImpl();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcmVwb3NpdG9yaWVzL3ZpZGVvLnJlcG9zaXRvcnkudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQ2tEO0FBQ3BCO0FBQ1E7QUFDTztBQUV0QyxNQUFNSSw0QkFBNEJKLDREQUFjQTtJQUdyRCxNQUFNSyxhQUFhQyxNQUFjLEVBQWtCO1FBQ2pELElBQUk7WUFDRixNQUFNQyxTQUFTLE1BQU1OLHVDQUFFQSxDQUFDTyxLQUFLLENBQUNDLFFBQVEsQ0FBQztnQkFDckNDLE9BQU87b0JBQUVKO2dCQUFPO2dCQUNoQkssU0FBUztvQkFDUEMsTUFBTTt3QkFDSkMsUUFBUTs0QkFDTkMsSUFBSTs0QkFDSkMsVUFBVTs0QkFDVkMsV0FBVzs0QkFDWEMsVUFBVTs0QkFDVkMsUUFBUTt3QkFDVjtvQkFDRjtvQkFDQUMsTUFBTTt3QkFDSlIsU0FBUzs0QkFDUFMsS0FBSzt3QkFDUDtvQkFDRjtvQkFDQUMsU0FBUzt3QkFDUFYsU0FBUzs0QkFDUEMsTUFBTTtnQ0FDSkMsUUFBUTtvQ0FDTkMsSUFBSTtvQ0FDSkMsVUFBVTtvQ0FDVkMsV0FBVztvQ0FDWEMsVUFBVTtvQ0FDVkMsUUFBUTtnQ0FDVjs0QkFDRjs0QkFDQUUsS0FBSzt3QkFDUDtvQkFDRjtvQkFDQUUsUUFBUTt3QkFDTlQsUUFBUTs0QkFDTlEsU0FBUzt3QkFDWDtvQkFDRjtnQkFDRjtnQkFDQUUsU0FBUztvQkFDUEMsV0FBVztnQkFDYjtZQUNGO1lBQ0EsT0FBT2pCO1FBQ1QsRUFBRSxPQUFPa0IsT0FBTztZQUNkdkIsK0NBQU1BLENBQUN1QixLQUFLLENBQUMsbUNBQW1DO2dCQUFFbkI7Z0JBQVFtQjtZQUFNO1lBQ2hFLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1DLFdBQVdQLElBQWMsRUFBa0I7UUFDL0MsSUFBSTtZQUNGLE1BQU1aLFNBQVMsTUFBTU4sdUNBQUVBLENBQUNPLEtBQUssQ0FBQ0MsUUFBUSxDQUFDO2dCQUNyQ0MsT0FBTztvQkFDTFMsTUFBTTt3QkFDSlEsTUFBTTs0QkFD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QUFFLE9BQU9uRSxPQUFPO1lBQ2QsMkRBQTJEO1lBQzNELElBQUlBLGlCQUFpQjhFLFNBQVM5RSxNQUFNK0UsT0FBTyxDQUFDQyxRQUFRLENBQUMsc0JBQXNCO2dCQUN6RXZHLCtDQUFNQSxDQUFDZ0YsSUFBSSxDQUFDLCtCQUErQjtvQkFBRUM7b0JBQVNTO2dCQUFNO2dCQUM1RDtZQUNGO1lBQ0ExRiwrQ0FBTUEsQ0FBQ3VCLEtBQUssQ0FBQyw2QkFBNkI7Z0JBQUUwRDtnQkFBU1M7Z0JBQU9uRTtZQUFNO1lBQ2xFLE1BQU1BO1FBQ1I7SUFDRjtJQUVBLE1BQU1pRixtQkFBbUJ2QixPQUFlLEVBQUVTLEtBQWEsRUFBaUI7UUFDdEUsSUFBSTtZQUNGLE1BQU0zRix1Q0FBRUEsQ0FBQ2dFLFFBQVEsQ0FBQzBDLFVBQVUsQ0FBQztnQkFDM0JqRyxPQUFPO29CQUNMeUU7b0JBQ0FTO2dCQUNGO1lBQ0Y7UUFDRixFQUFFLE9BQU9uRSxPQUFPO1lBQ2R2QiwrQ0FBTUEsQ0FBQ3VCLEtBQUssQ0FBQyxpQ0FBaUM7Z0JBQUUwRDtnQkFBU1M7Z0JBQU9uRTtZQUFNO1lBQ3RFLE1BQU1BO1FBQ1I7SUFDRjs7O2FBcGxCVW1GLFlBQVk7O0FBcWxCeEI7QUFFQSw0QkFBNEI7QUFDckIsTUFBTUMsa0JBQWtCLElBQUl6RyxzQkFBcUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vc3JjL3JlcG9zaXRvcmllcy92aWRlby5yZXBvc2l0b3J5LnRzPzQ0MDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVmlkZW8sIFZpZGVvUmVwb3NpdG9yeSwgVmlkZW9GaWx0ZXJzIH0gZnJvbSAnLi4vdHlwZXMnXG5pbXBvcnQgeyBCYXNlUmVwb3NpdG9yeSB9IGZyb20gJy4vYmFzZS5yZXBvc2l0b3J5J1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9saWIvZGInXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9saWIvbG9nZ2VyJ1xuaW1wb3J0IHsgUEFHSU5BVElPTiB9IGZyb20gJy4uL2xpYi9jb25zdGFudHMnXG5cbmV4cG9ydCBjbGFzcyBWaWRlb1JlcG9zaXRvcnlJbXBsIGV4dGVuZHMgQmFzZVJlcG9zaXRvcnk8VmlkZW8+IGltcGxlbWVudHMgVmlkZW9SZXBvc2l0b3J5IHtcbiAgcHJvdGVjdGVkIHRhYmxlTmFtZSA9ICd2aWRlbydcblxuICBhc3luYyBmaW5kQnlVc2VySWQodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZpZGVvcyA9IGF3YWl0IGRiLnZpZGVvLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHsgdXNlcklkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmF0aW5nczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZ3M6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHZpZGVvc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgdmlkZW9zIGJ5IHVzZXIgaWQnLCB7IHVzZXJJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmluZEJ5VGFncyh0YWdzOiBzdHJpbmdbXSk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmlkZW9zID0gYXdhaXQgZGIudmlkZW8uZmluZE1hbnkoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHRhZ3M6IHtcbiAgICAgICAgICAgIHNvbWU6IHtcbiAgICAgICAgICAgICAgdGFnOiB7XG4gICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgaW46IHRhZ3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmF0aW5nczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZ3M6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHZpZGVvc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgdmlkZW9zIGJ5IHRhZ3MnLCB7IHRhZ3MsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHNlYXJjaChxdWVyeTogc3RyaW5nLCBpbmNsdWRlTnNmdzogYm9vbGVhbiA9IHRydWUpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZpZGVvcyA9IGF3YWl0IGRiLnZpZGVvLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgT1I6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICBjb250YWluczogcXVlcnksXG4gICAgICAgICAgICAgICAgICAgIG1vZGU6ICdpbnNlbnNpdGl2ZSdcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBxdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJ1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgICAgICAgICBzb21lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgdGFnOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5zOiBxdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZTogJ2luc2Vuc2l0aXZlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLihpbmNsdWRlTnNmdyA/IFtdIDogW3sgaXNOc2Z3OiBmYWxzZSB9XSlcbiAgICAgICAgICBdXG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmF0aW5nczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgICBhdmF0YXI6IHRydWUsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZ3M6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6ICdkZXNjJ1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHZpZGVvc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHNlYXJjaGluZyB2aWRlb3MnLCB7IHF1ZXJ5LCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kV2l0aFJhdGluZ3MoaWQ6IHN0cmluZyk6IFByb21pc2U8YW55IHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB2aWRlbyA9IGF3YWl0IGRiLnZpZGVvLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZCB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJhdGluZ3M6IHtcbiAgICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgICAgICByYXRpbmdzOiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgcmV0dXJuIHZpZGVvXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZmluZGluZyB2aWRlbyB3aXRoIHJhdGluZ3MnLCB7IGlkLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaW5kV2l0aEZpbHRlcnMoZmlsdGVyczogVmlkZW9GaWx0ZXJzKTogUHJvbWlzZTx7XG4gICAgdmlkZW9zOiBhbnlbXVxuICAgIHRvdGFsOiBudW1iZXJcbiAgICB0b3RhbFBhZ2VzOiBudW1iZXJcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHNlYXJjaCxcbiAgICAgICAgdGFncyxcbiAgICAgICAgdGFnUmF0aW5ncyxcbiAgICAgICAgaW5jbHVkZU5zZncgPSB0cnVlLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHNvcnRCeSA9ICdjcmVhdGVkQXQnLFxuICAgICAgICBzb3J0T3JkZXIgPSAnZGVzYycsXG4gICAgICAgIHBhZ2UgPSAxLFxuICAgICAgICBsaW1pdCA9IFBBR0lOQVRJT04uREVGQVVMVF9QQUdFX1NJWkVcbiAgICAgIH0gPSBmaWx0ZXJzXG5cbiAgICAgIGNvbnN0IHdoZXJlOiBhbnkgPSB7fVxuXG4gICAgICAvLyBBZGQgc2VhcmNoIGZpbHRlclxuICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICB3aGVyZS5PUiA9IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICBjb250YWluczogc2VhcmNoLFxuICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbjoge1xuICAgICAgICAgICAgICBjb250YWluczogc2VhcmNoLFxuICAgICAgICAgICAgICBtb2RlOiAnaW5zZW5zaXRpdmUnXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB0YWdzIGZpbHRlclxuICAgICAgaWYgKHRhZ3MgJiYgdGFncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHdoZXJlLnRhZ3MgPSB7XG4gICAgICAgICAgc29tZToge1xuICAgICAgICAgICAgdGFnOiB7XG4gICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICBpbjogdGFnc1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB1c2VyIGZpbHRlclxuICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICB3aGVyZS51c2VySWQgPSB1c2VySWRcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIE5TRlcgZmlsdGVyXG4gICAgICBpZiAoIWluY2x1ZGVOc2Z3KSB7XG4gICAgICAgIHdoZXJlLmlzTnNmdyA9IGZhbHNlXG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCB0YWdSYXRpbmdzIGZpbHRlciAtIHdlJ2xsIGZpbHRlciBieSBoYXZpbmcgdGhlIHNwZWNpZmllZCB0YWdzIGZpcnN0XG4gICAgICAvLyB0aGVuIHBvc3QtcHJvY2VzcyB0byBjaGVjayByYXRpbmcgcmFuZ2VzXG4gICAgICBpZiAodGFnUmF0aW5ncyAmJiB0YWdSYXRpbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgdGFnTmFtZXMgPSB0YWdSYXRpbmdzLm1hcCh0ciA9PiB0ci50YWdOYW1lKVxuICAgICAgICAvLyBFbnN1cmUgdmlkZW9zIGhhdmUgYWxsIHRoZSBzcGVjaWZpZWQgdGFnc1xuICAgICAgICB3aGVyZS50YWdzID0ge1xuICAgICAgICAgIHNvbWU6IHtcbiAgICAgICAgICAgIHRhZzoge1xuICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgaW46IHRhZ05hbWVzXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdFxuXG4gICAgICAvLyBCdWlsZCBvcmRlckJ5XG4gICAgICBjb25zdCBvcmRlckJ5OiBhbnkgPSB7fVxuICAgICAgaWYgKHNvcnRCeSA9PT0gJ3JhdGluZ3MnKSB7XG4gICAgICAgIG9yZGVyQnkuX2NvdW50ID0ge1xuICAgICAgICAgIHJhdGluZ3M6IHNvcnRPcmRlclxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcmRlckJ5W3NvcnRCeV0gPSBzb3J0T3JkZXJcbiAgICAgIH1cblxuICAgICAgbGV0IFt2aWRlb3MsIHRvdGFsXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgZGIudmlkZW8uZmluZE1hbnkoe1xuICAgICAgICAgIHdoZXJlLFxuICAgICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRydWUsXG4gICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGxhc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogdHJ1ZSxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRhZ3M6IHtcbiAgICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICAgIHRhZzogdHJ1ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmF0aW5nczoge1xuICAgICAgICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGFnOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgICAgcmF0aW5nczogdHJ1ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcmRlckJ5LFxuICAgICAgICAgIHNraXAsXG4gICAgICAgICAgdGFrZTogbGltaXQgKiAyLCAvLyBGZXRjaCBtb3JlIHRvIGFjY291bnQgZm9yIGZpbHRlcmluZ1xuICAgICAgICB9KSxcbiAgICAgICAgZGIudmlkZW8uY291bnQoeyB3aGVyZSB9KVxuICAgICAgXSlcblxuICAgICAgLy8gQXBwbHkgdGFnUmF0aW5ncyBmaWx0ZXIgaW4gcG9zdC1wcm9jZXNzaW5nXG4gICAgICBpZiAodGFnUmF0aW5ncyAmJiB0YWdSYXRpbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmlkZW9zID0gdmlkZW9zLmZpbHRlcih2aWRlbyA9PiB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdmlkZW8gaGFzIGFsbCByZXF1aXJlZCB0YWdzIHdpdGggcmF0aW5ncyBpbiB0aGUgc3BlY2lmaWVkIHJhbmdlc1xuICAgICAgICAgIHJldHVybiB0YWdSYXRpbmdzLmV2ZXJ5KCh7IHRhZ05hbWUsIG1pblJhdGluZywgbWF4UmF0aW5nIH0pID0+IHtcbiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRhZyBpbiB0aGUgdmlkZW9cbiAgICAgICAgICAgIGNvbnN0IHZpZGVvVGFnID0gdmlkZW8udGFncy5maW5kKHZ0ID0+IHZ0LnRhZy5uYW1lID09PSB0YWdOYW1lKVxuICAgICAgICAgICAgaWYgKCF2aWRlb1RhZykgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIHJhdGluZyBmb3IgdGhpcyB0YWcgb24gdGhpcyB2aWRlb1xuICAgICAgICAgICAgY29uc3QgdGFnUmF0aW5ncyA9IHZpZGVvLnJhdGluZ3MuZmlsdGVyKHIgPT4gci50YWcubmFtZSA9PT0gdGFnTmFtZSlcbiAgICAgICAgICAgIGlmICh0YWdSYXRpbmdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgICAgIGNvbnN0IGF2ZXJhZ2VSYXRpbmcgPSB0YWdSYXRpbmdzLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLmxldmVsLCAwKSAvIHRhZ1JhdGluZ3MubGVuZ3RoXG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGF2ZXJhZ2UgcmF0aW5nIGlzIHdpdGhpbiB0aGUgc3BlY2lmaWVkIHJhbmdlXG4gICAgICAgICAgICByZXR1cm4gYXZlcmFnZVJhdGluZyA+PSBtaW5SYXRpbmcgJiYgYXZlcmFnZVJhdGluZyA8PSBtYXhSYXRpbmdcbiAgICAgICAgICB9KVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIFVwZGF0ZSB0b3RhbCBjb3VudCBhZnRlciBmaWx0ZXJpbmdcbiAgICAgICAgdG90YWwgPSB2aWRlb3MubGVuZ3RoXG4gICAgICAgIFxuICAgICAgICAvLyBBcHBseSBwYWdpbmF0aW9uIGFmdGVyIGZpbHRlcmluZ1xuICAgICAgICB2aWRlb3MgPSB2aWRlb3Muc2xpY2UoMCwgbGltaXQpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHRvdGFsUGFnZXMgPSBNYXRoLmNlaWwodG90YWwgLyBsaW1pdClcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdmlkZW9zLFxuICAgICAgICB0b3RhbCxcbiAgICAgICAgdG90YWxQYWdlc1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgdmlkZW9zIHdpdGggZmlsdGVycycsIHsgZmlsdGVycywgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY3JlYXRlV2l0aFRhZ3MoXG4gICAgdmlkZW9EYXRhOiBPbWl0PFZpZGVvLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0JyB8ICd1c2VyJyB8ICd0YWdzJyB8ICdyYXRpbmdzJz4sXG4gICAgdGFnTmFtZXM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHZpZGVvID0gYXdhaXQgZGIudmlkZW8uY3JlYXRlKHtcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIC4uLnZpZGVvRGF0YSxcbiAgICAgICAgICB0YWdzOiB7XG4gICAgICAgICAgICBjcmVhdGU6IHRhZ05hbWVzLm1hcCh0YWdOYW1lID0+ICh7XG4gICAgICAgICAgICAgIHRhZzoge1xuICAgICAgICAgICAgICAgIGNvbm5lY3RPckNyZWF0ZToge1xuICAgICAgICAgICAgICAgICAgd2hlcmU6IHsgbmFtZTogdGFnTmFtZSB9LFxuICAgICAgICAgICAgICAgICAgY3JlYXRlOiB7IG5hbWU6IHRhZ05hbWUgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZ3M6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG5cbiAgICAgIGxvZ2dlci5pbmZvKCdDcmVhdGVkIHZpZGVvIHdpdGggdGFncycsIHsgdmlkZW9JZDogdmlkZW8uaWQsIHRhZ05hbWVzIH0pXG4gICAgICByZXR1cm4gdmlkZW9cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjcmVhdGluZyB2aWRlbyB3aXRoIHRhZ3MnLCB7IHZpZGVvRGF0YSwgdGFnTmFtZXMsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFZpZGVvU3RhdHModmlkZW9JZDogc3RyaW5nKTogUHJvbWlzZTx7XG4gICAgdG90YWxSYXRpbmdzOiBudW1iZXJcbiAgICBhdmVyYWdlUmF0aW5nQnlUYWc6IEFycmF5PHsgdGFnTmFtZTogc3RyaW5nOyBhdmVyYWdlUmF0aW5nOiBudW1iZXI7IGNvdW50OiBudW1iZXIgfT5cbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBbdG90YWxSYXRpbmdzLCByYXRpbmdzQnlUYWddID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBkYi5yYXRpbmcuY291bnQoe1xuICAgICAgICAgIHdoZXJlOiB7IHZpZGVvSWQgfVxuICAgICAgICB9KSxcbiAgICAgICAgZGIucmF0aW5nLmdyb3VwQnkoe1xuICAgICAgICAgIGJ5OiBbJ3RhZ0lkJ10sXG4gICAgICAgICAgd2hlcmU6IHsgdmlkZW9JZCB9LFxuICAgICAgICAgIF9hdmc6IHtcbiAgICAgICAgICAgIGxldmVsOiB0cnVlXG4gICAgICAgICAgfSxcbiAgICAgICAgICBfY291bnQ6IHtcbiAgICAgICAgICAgIGxldmVsOiB0cnVlXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgXSlcblxuICAgICAgLy8gR2V0IHRhZyBuYW1lc1xuICAgICAgY29uc3QgdGFnSWRzID0gcmF0aW5nc0J5VGFnLm1hcChyID0+IHIudGFnSWQpXG4gICAgICBjb25zdCB0YWdzID0gYXdhaXQgZGIudGFnLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBpZDoge1xuICAgICAgICAgICAgaW46IHRhZ0lkc1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgICAgY29uc3QgdGFnTWFwID0gdGFncy5yZWR1Y2UoKGFjYywgdGFnKSA9PiB7XG4gICAgICAgIGFjY1t0YWcuaWRdID0gdGFnLm5hbWVcbiAgICAgICAgcmV0dXJuIGFjY1xuICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgc3RyaW5nPilcblxuICAgICAgY29uc3QgYXZlcmFnZVJhdGluZ0J5VGFnID0gcmF0aW5nc0J5VGFnLm1hcChyYXRpbmcgPT4gKHtcbiAgICAgICAgdGFnTmFtZTogdGFnTWFwW3JhdGluZy50YWdJZF0gfHwgJ1Vua25vd24nLFxuICAgICAgICBhdmVyYWdlUmF0aW5nOiByYXRpbmcuX2F2Zy5sZXZlbCB8fCAwLFxuICAgICAgICBjb3VudDogcmF0aW5nLl9jb3VudC5sZXZlbFxuICAgICAgfSkpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsUmF0aW5ncyxcbiAgICAgICAgYXZlcmFnZVJhdGluZ0J5VGFnXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyB2aWRlbyBzdGF0cycsIHsgdmlkZW9JZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0VHJlbmRpbmdWaWRlb3MobGltaXQ6IG51bWJlciA9IDEwKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdmlkZW9zIHdpdGggbW9zdCByYXRpbmdzIGluIHRoZSBsYXN0IDcgZGF5c1xuICAgICAgY29uc3Qgc2V2ZW5EYXlzQWdvID0gbmV3IERhdGUoKVxuICAgICAgc2V2ZW5EYXlzQWdvLnNldERhdGUoc2V2ZW5EYXlzQWdvLmdldERhdGUoKSAtIDcpXG5cbiAgICAgIGNvbnN0IHZpZGVvcyA9IGF3YWl0IGRiLnZpZGVvLmZpbmRNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBjcmVhdGVkQXQ6IHtcbiAgICAgICAgICAgIGd0ZTogc2V2ZW5EYXlzQWdvXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiB7XG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgICAgICB1c2VybmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZmlyc3ROYW1lOiB0cnVlLFxuICAgICAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgYXZhdGFyOiB0cnVlLFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFnczoge1xuICAgICAgICAgICAgaW5jbHVkZToge1xuICAgICAgICAgICAgICB0YWc6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIF9jb3VudDoge1xuICAgICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICAgIHJhdGluZ3M6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9yZGVyQnk6IHtcbiAgICAgICAgICByYXRpbmdzOiB7XG4gICAgICAgICAgICBfY291bnQ6ICdkZXNjJ1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdGFrZTogbGltaXRcbiAgICAgIH0pXG5cbiAgICAgIHJldHVybiB2aWRlb3NcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHRyZW5kaW5nIHZpZGVvcycsIHsgbGltaXQsIGVycm9yIH0pXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZFRhZ1RvVmlkZW8odmlkZW9JZDogc3RyaW5nLCB0YWdJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGRiLnZpZGVvVGFnLmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB2aWRlb0lkLFxuICAgICAgICAgIHRhZ0lkXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBkdXBsaWNhdGUga2V5IGVycm9yICh0YWcgYWxyZWFkeSBleGlzdHMgb24gdmlkZW8pXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdVbmlxdWUgY29uc3RyYWludCcpKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdUYWcgYWxyZWFkeSBleGlzdHMgb24gdmlkZW8nLCB7IHZpZGVvSWQsIHRhZ0lkIH0pXG4gICAgICAgIHJldHVyblxuICAgICAgfVxuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBhZGRpbmcgdGFnIHRvIHZpZGVvJywgeyB2aWRlb0lkLCB0YWdJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVtb3ZlVGFnRnJvbVZpZGVvKHZpZGVvSWQ6IHN0cmluZywgdGFnSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi52aWRlb1RhZy5kZWxldGVNYW55KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICB2aWRlb0lkLFxuICAgICAgICAgIHRhZ0lkXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgcmVtb3ZpbmcgdGFnIGZyb20gdmlkZW8nLCB7IHZpZGVvSWQsIHRhZ0lkLCBlcnJvciB9KVxuICAgICAgdGhyb3cgZXJyb3JcbiAgICB9XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IHZpZGVvUmVwb3NpdG9yeSA9IG5ldyBWaWRlb1JlcG9zaXRvcnlJbXBsKCkiXSwibmFtZXMiOlsiQmFzZVJlcG9zaXRvcnkiLCJkYiIsImxvZ2dlciIsIlBBR0lOQVRJT04iLCJWaWRlb1JlcG9zaXRvcnlJbXBsIiwiZmluZEJ5VXNlcklkIiwidXNlcklkIiwidmlkZW9zIiwidmlkZW8iLCJmaW5kTWFueSIsIndoZXJlIiwiaW5jbHVkZSIsInVzZXIiLCJzZWxlY3QiLCJpZCIsInVzZXJuYW1lIiwiZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJhdmF0YXIiLCJ0YWdzIiwidGFnIiwicmF0aW5ncyIsIl9jb3VudCIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJlcnJvciIsImZpbmRCeVRhZ3MiLCJzb21lIiwibmFtZSIsImluIiwic2VhcmNoIiwicXVlcnkiLCJpbmNsdWRlTnNmdyIsIkFORCIsIk9SIiwidGl0bGUiLCJjb250YWlucyIsIm1vZGUiLCJkZXNjcmlwdGlvbiIsImlzTnNmdyIsImZpbmRXaXRoUmF0aW5ncyIsImZpbmRVbmlxdWUiLCJmaW5kV2l0aEZpbHRlcnMiLCJmaWx0ZXJzIiwidGFnUmF0aW5ncyIsInNvcnRCeSIsInNvcnRPcmRlciIsInBhZ2UiLCJsaW1pdCIsIkRFRkFVTFRfUEFHRV9TSVpFIiwibGVuZ3RoIiwidGFnTmFtZXMiLCJtYXAiLCJ0ciIsInRhZ05hbWUiLCJza2lwIiwidG90YWwiLCJQcm9taXNlIiwiYWxsIiwidGFrZSIsImNvdW50IiwiZmlsdGVyIiwiZXZlcnkiLCJtaW5SYXRpbmciLCJtYXhSYXRpbmciLCJ2aWRlb1RhZyIsImZpbmQiLCJ2dCIsInIiLCJhdmVyYWdlUmF0aW5nIiwicmVkdWNlIiwic3VtIiwibGV2ZWwiLCJzbGljZSIsInRvdGFsUGFnZXMiLCJNYXRoIiwiY2VpbCIsImNyZWF0ZVdpdGhUYWdzIiwidmlkZW9EYXRhIiwiY3JlYXRlIiwiZGF0YSIsImNvbm5lY3RPckNyZWF0ZSIsImluZm8iLCJ2aWRlb0lkIiwiZ2V0VmlkZW9TdGF0cyIsInRvdGFsUmF0aW5ncyIsInJhdGluZ3NCeVRhZyIsInJhdGluZyIsImdyb3VwQnkiLCJieSIsIl9hdmciLCJ0YWdJZHMiLCJ0YWdJZCIsInRhZ01hcCIsImFjYyIsImF2ZXJhZ2VSYXRpbmdCeVRhZyIsImdldFRyZW5kaW5nVmlkZW9zIiwic2V2ZW5EYXlzQWdvIiwiRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwiZ3RlIiwiYWRkVGFnVG9WaWRlbyIsIkVycm9yIiwibWVzc2FnZSIsImluY2x1ZGVzIiwicmVtb3ZlVGFnRnJvbVZpZGVvIiwiZGVsZXRlTWFueSIsInRhYmxlTmFtZSIsInZpZGVvUmVwb3NpdG9yeSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/repositories/video.repository.ts\n");

/***/ }),

/***/ "(api)/./src/services/rating-cache.service.ts":
/*!**********************************************!*\
  !*** ./src/services/rating-cache.service.ts ***!
  \**********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RatingCacheService: () => (/* binding */ RatingCacheService),\n/* harmony export */   ratingCacheService: () => (/* binding */ ratingCacheService)\n/* harmony export */ });\n/* harmony import */ var _repositories_rating_repository__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../repositories/rating.repository */ \"(api)/./src/repositories/rating.repository.ts\");\n/* harmony import */ var _lib_logger__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/logger */ \"(api)/./src/lib/logger.ts\");\n/* harmony import */ var _lib_performance_monitor__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/performance-monitor */ \"(api)/./src/lib/performance-monitor.ts\");\n\n\n\nclass RatingCacheService {\n    isExpired(entry) {\n        return Date.now() - entry.timestamp > entry.ttl;\n    }\n    cleanupExpiredEntries() {\n        const now = Date.now();\n        // Clean up video average cache\n        for (const [key, entry] of this.videoAverageCache.entries()){\n            if (now - entry.timestamp > entry.ttl) {\n                this.videoAverageCache.delete(key);\n            }\n        }\n        // Clean up video aggregate cache\n        for (const [key, entry] of this.videoAggregateCache.entries()){\n            if (now - entry.timestamp > entry.ttl) {\n                this.videoAggregateCache.delete(key);\n            }\n        }\n        // Clean up user rating cache\n        for (const [key, entry] of this.userRatingCache.entries()){\n            if (now - entry.timestamp > entry.ttl) {\n                this.userRatingCache.delete(key);\n            }\n        }\n    }\n    async getVideoAverageRatings(videoId, tagId) {\n        return (0,_lib_performance_monitor__WEBPACK_IMPORTED_MODULE_2__.timeRatingOperation)(\"cache_get_video_averages\", async ()=>{\n            const cacheKey = `${videoId}:${tagId || \"all\"}`;\n            const cached = this.videoAverageCache.get(cacheKey);\n            if (cached && !this.isExpired(cached)) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Cache hit for video average ratings\", {\n                    videoId,\n                    tagId,\n                    cacheKey\n                });\n                return cached.data;\n            }\n            try {\n                let averages;\n                if (tagId) {\n                    // Get average for specific tag\n                    const average = await _repositories_rating_repository__WEBPACK_IMPORTED_MODULE_0__.ratingRepository.getAverageRating(videoId, tagId);\n                    averages = new Map([\n                        [\n                            tagId,\n                            average\n                        ]\n                    ]);\n                } else {\n                    // Get averages for all tags for this video\n                    const ratings = await _repositories_rating_repository__WEBPACK_IMPORTED_MODULE_0__.ratingRepository.findByVideoId(videoId);\n                    const tagAverages = new Map();\n                    ratings.forEach((rating)=>{\n                        const tag = rating.tag.name;\n                        if (!tagAverages.has(tag)) {\n                            tagAverages.set(tag, {\n                                sum: 0,\n                                count: 0\n                            });\n                        }\n                        const current = tagAverages.get(tag);\n                        current.sum += rating.level;\n                        current.count += 1;\n                    });\n                    averages = new Map();\n                    tagAverages.forEach((value, tag)=>{\n                        averages.set(tag, value.count > 0 ? value.sum / value.count : 0);\n                    });\n                }\n                // Cache the result\n                this.videoAverageCache.set(cacheKey, {\n                    data: averages,\n                    timestamp: Date.now(),\n                    ttl: this.AVERAGE_CACHE_TTL\n                });\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Cached video average ratings\", {\n                    videoId,\n                    tagId,\n                    cacheKey,\n                    tagsCount: averages.size\n                });\n                return averages;\n            } catch (error) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(\"Error getting video average ratings\", {\n                    videoId,\n                    tagId,\n                    error\n                });\n                throw error;\n            }\n        }, {\n            videoId,\n            tagId,\n            cacheKey: `${videoId}:${tagId || \"all\"}`\n        });\n    }\n    async getBulkVideoAverageRatings(videoIds, tagId) {\n        const result = new Map();\n        const uncachedVideoIds = [];\n        // Check cache first\n        for (const videoId of videoIds){\n            const cacheKey = `${videoId}:${tagId || \"all\"}`;\n            const cached = this.videoAverageCache.get(cacheKey);\n            if (cached && !this.isExpired(cached)) {\n                result.set(videoId, cached.data);\n            } else {\n                uncachedVideoIds.push(videoId);\n            }\n        }\n        // Fetch uncached data in bulk\n        if (uncachedVideoIds.length > 0) {\n            try {\n                const bulkAverages = await _repositories_rating_repository__WEBPACK_IMPORTED_MODULE_0__.ratingRepository.getAverageRatingsByVideoIds(uncachedVideoIds, tagId);\n                // Process and cache the results\n                for (const videoId of uncachedVideoIds){\n                    const average = bulkAverages.get(videoId) || 0;\n                    const averageMap = tagId ? new Map([\n                        [\n                            tagId,\n                            average\n                        ]\n                    ]) : new Map([\n                        [\n                            \"overall\",\n                            average\n                        ]\n                    ]);\n                    result.set(videoId, averageMap);\n                    // Cache the result\n                    const cacheKey = `${videoId}:${tagId || \"all\"}`;\n                    this.videoAverageCache.set(cacheKey, {\n                        data: averageMap,\n                        timestamp: Date.now(),\n                        ttl: this.AVERAGE_CACHE_TTL\n                    });\n                }\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Bulk cached video average ratings\", {\n                    videoIds: uncachedVideoIds.length,\n                    tagId,\n                    cacheHits: videoIds.length - uncachedVideoIds.length,\n                    cacheMisses: uncachedVideoIds.length\n                });\n            } catch (error) {\n                _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(\"Error getting bulk video average ratings\", {\n                    videoIds: uncachedVideoIds.length,\n                    tagId,\n                    error\n                });\n                throw error;\n            }\n        }\n        return result;\n    }\n    async getUserRatingForVideo(userId, videoId, tagId) {\n        const cacheKey = `${userId}:${videoId}`;\n        const cached = this.userRatingCache.get(cacheKey);\n        if (cached && !this.isExpired(cached)) {\n            return cached.data.get(tagId) || null;\n        }\n        try {\n            const ratings = await _repositories_rating_repository__WEBPACK_IMPORTED_MODULE_0__.ratingRepository.findByUserAndVideo(userId, videoId);\n            const userRatings = new Map();\n            ratings.forEach((rating)=>{\n                userRatings.set(rating.tagId, rating.level);\n            });\n            // Cache the result\n            this.userRatingCache.set(cacheKey, {\n                data: userRatings,\n                timestamp: Date.now(),\n                ttl: this.USER_RATING_CACHE_TTL\n            });\n            return userRatings.get(tagId) || null;\n        } catch (error) {\n            _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.error(\"Error getting user rating for video\", {\n                userId,\n                videoId,\n                tagId,\n                error\n            });\n            throw error;\n        }\n    }\n    invalidateVideoCache(videoId) {\n        const keysToDelete = [];\n        // Find all cache keys related to this video\n        for (const [key] of this.videoAverageCache.entries()){\n            if (key.startsWith(`${videoId}:`)) {\n                keysToDelete.push(key);\n            }\n        }\n        for (const [key] of this.videoAggregateCache.entries()){\n            if (key === videoId) {\n                keysToDelete.push(key);\n            }\n        }\n        // Delete the keys\n        keysToDelete.forEach((key)=>{\n            this.videoAverageCache.delete(key);\n            this.videoAggregateCache.delete(key);\n        });\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Invalidated video cache\", {\n            videoId,\n            keysInvalidated: keysToDelete.length\n        });\n    }\n    invalidateUserCache(userId) {\n        const keysToDelete = [];\n        // Find all cache keys related to this user\n        for (const [key] of this.userRatingCache.entries()){\n            if (key.startsWith(`${userId}:`)) {\n                keysToDelete.push(key);\n            }\n        }\n        // Delete the keys\n        keysToDelete.forEach((key)=>{\n            this.userRatingCache.delete(key);\n        });\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Invalidated user cache\", {\n            userId,\n            keysInvalidated: keysToDelete.length\n        });\n    }\n    // Method to manually trigger cache cleanup\n    cleanup() {\n        this.cleanupExpiredEntries();\n        _lib_logger__WEBPACK_IMPORTED_MODULE_1__.logger.debug(\"Rating cache cleanup completed\", {\n            videoAverageEntries: this.videoAverageCache.size,\n            videoAggregateEntries: this.videoAggregateCache.size,\n            userRatingEntries: this.userRatingCache.size\n        });\n    }\n    // Get cache statistics\n    getStats() {\n        return {\n            videoAverageCache: {\n                size: this.videoAverageCache.size,\n                ttl: this.AVERAGE_CACHE_TTL\n            },\n            videoAggregateCache: {\n                size: this.videoAggregateCache.size,\n                ttl: this.AGGREGATE_CACHE_TTL\n            },\n            userRatingCache: {\n                size: this.userRatingCache.size,\n                ttl: this.USER_RATING_CACHE_TTL\n            }\n        };\n    }\n    constructor(){\n        this.videoAverageCache = new Map();\n        this.videoAggregateCache = new Map();\n        this.userRatingCache = new Map();\n        // Cache TTL configurations\n        this.AVERAGE_CACHE_TTL = 5 * 60 * 1000 // 5 minutes\n        ;\n        this.AGGREGATE_CACHE_TTL = 10 * 60 * 1000 // 10 minutes\n        ;\n        this.USER_RATING_CACHE_TTL = 2 * 60 * 1000 // 2 minutes\n        ;\n    }\n}\n// Export singleton instance\nconst ratingCacheService = new RatingCacheService();\n// Setup periodic cleanup\nif (true) {\n    setInterval(()=>{\n        ratingCacheService.cleanup();\n    }, 5 * 60 * 1000) // Cleanup every 5 minutes\n    ;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvcmF0aW5nLWNhY2hlLnNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBb0U7QUFDOUI7QUFDMEI7QUFjekQsTUFBTUc7SUFVSEMsVUFBYUMsS0FBb0IsRUFBVztRQUNsRCxPQUFPQyxLQUFLQyxHQUFHLEtBQUtGLE1BQU1HLFNBQVMsR0FBR0gsTUFBTUksR0FBRztJQUNqRDtJQUVRQyx3QkFBd0I7UUFDOUIsTUFBTUgsTUFBTUQsS0FBS0MsR0FBRztRQUVwQiwrQkFBK0I7UUFDL0IsS0FBSyxNQUFNLENBQUNJLEtBQUtOLE1BQU0sSUFBSSxJQUFJLENBQUNPLGlCQUFpQixDQUFDQyxPQUFPLEdBQUk7WUFDM0QsSUFBSU4sTUFBTUYsTUFBTUcsU0FBUyxHQUFHSCxNQUFNSSxHQUFHLEVBQUU7Z0JBQ3JDLElBQUksQ0FBQ0csaUJBQWlCLENBQUNFLE1BQU0sQ0FBQ0g7WUFDaEM7UUFDRjtRQUVBLGlDQUFpQztRQUNqQyxLQUFLLE1BQU0sQ0FBQ0EsS0FBS04sTUFBTSxJQUFJLElBQUksQ0FBQ1UsbUJBQW1CLENBQUNGLE9BQU8sR0FBSTtZQUM3RCxJQUFJTixNQUFNRixNQUFNRyxTQUFTLEdBQUdILE1BQU1JLEdBQUcsRUFBRTtnQkFDckMsSUFBSSxDQUFDTSxtQkFBbUIsQ0FBQ0QsTUFBTSxDQUFDSDtZQUNsQztRQUNGO1FBRUEsNkJBQTZCO1FBQzdCLEtBQUssTUFBTSxDQUFDQSxLQUFLTixNQUFNLElBQUksSUFBSSxDQUFDVyxlQUFlLENBQUNILE9BQU8sR0FBSTtZQUN6RCxJQUFJTixNQUFNRixNQUFNRyxTQUFTLEdBQUdILE1BQU1JLEdBQUcsRUFBRTtnQkFDckMsSUFBSSxDQUFDTyxlQUFlLENBQUNGLE1BQU0sQ0FBQ0g7WUFDOUI7UUFDRjtJQUNGO0lBRUEsTUFBTU0sdUJBQXVCQyxPQUFlLEVBQUVDLEtBQWMsRUFBZ0M7UUFDMUYsT0FBT2pCLDZFQUFtQkEsQ0FBQyw0QkFBNEI7WUFDckQsTUFBTWtCLFdB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RCxtQkFBbUIsQ0FBQzhCLElBQUk7WUFDcEQwQixtQkFBbUIsSUFBSSxDQUFDdkQsZUFBZSxDQUFDNkIsSUFBSTtRQUM5QztJQUNGO0lBRUEsdUJBQXVCO0lBQ3ZCMkIsV0FBVztRQUNULE9BQU87WUFDTDVELG1CQUFtQjtnQkFDakJpQyxNQUFNLElBQUksQ0FBQ2pDLGlCQUFpQixDQUFDaUMsSUFBSTtnQkFDakNwQyxLQUFLLElBQUksQ0FBQ2tDLGlCQUFpQjtZQUM3QjtZQUNBNUIscUJBQXFCO2dCQUNuQjhCLE1BQU0sSUFBSSxDQUFDOUIsbUJBQW1CLENBQUM4QixJQUFJO2dCQUNuQ3BDLEtBQUssSUFBSSxDQUFDZ0UsbUJBQW1CO1lBQy9CO1lBQ0F6RCxpQkFBaUI7Z0JBQ2Y2QixNQUFNLElBQUksQ0FBQzdCLGVBQWUsQ0FBQzZCLElBQUk7Z0JBQy9CcEMsS0FBSyxJQUFJLENBQUNxRCxxQkFBcUI7WUFDakM7UUFDRjtJQUNGOzthQXRQUWxELG9CQUFvQixJQUFJZ0I7YUFDeEJiLHNCQUFzQixJQUFJYTthQUMxQlosa0JBQWtCLElBQUlZO1FBRTlCLDJCQUEyQjthQUNWZSxvQkFBb0IsSUFBSSxLQUFLLEtBQUssWUFBWTs7YUFDOUM4QixzQkFBc0IsS0FBSyxLQUFLLEtBQUssYUFBYTs7YUFDbERYLHdCQUF3QixJQUFJLEtBQUssS0FBSyxZQUFZOzs7QUFnUHJFO0FBRUEsNEJBQTRCO0FBQ3JCLE1BQU1ZLHFCQUFxQixJQUFJdkUscUJBQW9CO0FBRTFELHlCQUF5QjtBQUN6QixJQUFJLElBQWtCLEVBQWE7SUFDakN3RSxZQUFZO1FBQ1ZELG1CQUFtQk4sT0FBTztJQUM1QixHQUFHLElBQUksS0FBSyxNQUFNLDBCQUEwQjs7QUFDOUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yYXRlbXktbmV4dGpzLy4vc3JjL3NlcnZpY2VzL3JhdGluZy1jYWNoZS5zZXJ2aWNlLnRzPzEzNzYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmF0aW5nUmVwb3NpdG9yeSB9IGZyb20gJy4uL3JlcG9zaXRvcmllcy9yYXRpbmcucmVwb3NpdG9yeSdcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL2xpYi9sb2dnZXInXG5pbXBvcnQgeyB0aW1lUmF0aW5nT3BlcmF0aW9uIH0gZnJvbSAnLi4vbGliL3BlcmZvcm1hbmNlLW1vbml0b3InXG5cbmludGVyZmFjZSBDYWNoZUVudHJ5PFQ+IHtcbiAgZGF0YTogVFxuICB0aW1lc3RhbXA6IG51bWJlclxuICB0dGw6IG51bWJlciAvLyBUaW1lIHRvIGxpdmUgaW4gbWlsbGlzZWNvbmRzXG59XG5cbmludGVyZmFjZSBWaWRlb1JhdGluZ0FnZ3JlZ2F0ZXMge1xuICBhdmVyYWdlQnlUYWc6IE1hcDxzdHJpbmcsIG51bWJlcj5cbiAgdG90YWxSYXRpbmdzOiBudW1iZXJcbiAgcmF0aW5nRGlzdHJpYnV0aW9uOiBNYXA8bnVtYmVyLCBudW1iZXI+XG59XG5cbmV4cG9ydCBjbGFzcyBSYXRpbmdDYWNoZVNlcnZpY2Uge1xuICBwcml2YXRlIHZpZGVvQXZlcmFnZUNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk8TWFwPHN0cmluZywgbnVtYmVyPj4+KClcbiAgcHJpdmF0ZSB2aWRlb0FnZ3JlZ2F0ZUNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk8VmlkZW9SYXRpbmdBZ2dyZWdhdGVzPj4oKVxuICBwcml2YXRlIHVzZXJSYXRpbmdDYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBDYWNoZUVudHJ5PE1hcDxzdHJpbmcsIG51bWJlcj4+PigpXG4gIFxuICAvLyBDYWNoZSBUVEwgY29uZmlndXJhdGlvbnNcbiAgcHJpdmF0ZSByZWFkb25seSBBVkVSQUdFX0NBQ0hFX1RUTCA9IDUgKiA2MCAqIDEwMDAgLy8gNSBtaW51dGVzXG4gIHByaXZhdGUgcmVhZG9ubHkgQUdHUkVHQVRFX0NBQ0hFX1RUTCA9IDEwICogNjAgKiAxMDAwIC8vIDEwIG1pbnV0ZXNcbiAgcHJpdmF0ZSByZWFkb25seSBVU0VSX1JBVElOR19DQUNIRV9UVEwgPSAyICogNjAgKiAxMDAwIC8vIDIgbWludXRlc1xuXG4gIHByaXZhdGUgaXNFeHBpcmVkPFQ+KGVudHJ5OiBDYWNoZUVudHJ5PFQ+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGxcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW51cEV4cGlyZWRFbnRyaWVzKCkge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KClcbiAgICBcbiAgICAvLyBDbGVhbiB1cCB2aWRlbyBhdmVyYWdlIGNhY2hlXG4gICAgZm9yIChjb25zdCBba2V5LCBlbnRyeV0gb2YgdGhpcy52aWRlb0F2ZXJhZ2VDYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChub3cgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGwpIHtcbiAgICAgICAgdGhpcy52aWRlb0F2ZXJhZ2VDYWNoZS5kZWxldGUoa2V5KVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiB1cCB2aWRlbyBhZ2dyZWdhdGUgY2FjaGVcbiAgICBmb3IgKGNvbnN0IFtrZXksIGVudHJ5XSBvZiB0aGlzLnZpZGVvQWdncmVnYXRlQ2FjaGUuZW50cmllcygpKSB7XG4gICAgICBpZiAobm93IC0gZW50cnkudGltZXN0YW1wID4gZW50cnkudHRsKSB7XG4gICAgICAgIHRoaXMudmlkZW9BZ2dyZWdhdGVDYWNoZS5kZWxldGUoa2V5KVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiB1cCB1c2VyIHJhdGluZyBjYWNoZVxuICAgIGZvciAoY29uc3QgW2tleSwgZW50cnldIG9mIHRoaXMudXNlclJhdGluZ0NhY2hlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKG5vdyAtIGVudHJ5LnRpbWVzdGFtcCA+IGVudHJ5LnR0bCkge1xuICAgICAgICB0aGlzLnVzZXJSYXRpbmdDYWNoZS5kZWxldGUoa2V5KVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldFZpZGVvQXZlcmFnZVJhdGluZ3ModmlkZW9JZDogc3RyaW5nLCB0YWdJZD86IHN0cmluZyk6IFByb21pc2U8TWFwPHN0cmluZywgbnVtYmVyPj4ge1xuICAgIHJldHVybiB0aW1lUmF0aW5nT3BlcmF0aW9uKCdjYWNoZV9nZXRfdmlkZW9fYXZlcmFnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjYWNoZUtleSA9IGAke3ZpZGVvSWR9OiR7dGFnSWQgfHwgJ2FsbCd9YFxuICAgICAgY29uc3QgY2FjaGVkID0gdGhpcy52aWRlb0F2ZXJhZ2VDYWNoZS5nZXQoY2FjaGVLZXkpXG4gICAgICBcbiAgICAgIGlmIChjYWNoZWQgJiYgIXRoaXMuaXNFeHBpcmVkKGNhY2hlZCkpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdDYWNoZSBoaXQgZm9yIHZpZGVvIGF2ZXJhZ2UgcmF0aW5ncycsIHsgdmlkZW9JZCwgdGFnSWQsIGNhY2hlS2V5IH0pXG4gICAgICAgIHJldHVybiBjYWNoZWQuZGF0YVxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBsZXQgYXZlcmFnZXM6IE1hcDxzdHJpbmcsIG51bWJlcj5cbiAgICAgICAgXG4gICAgICAgIGlmICh0YWdJZCkge1xuICAgICAgICAgIC8vIEdldCBhdmVyYWdlIGZvciBzcGVjaWZpYyB0YWdcbiAgICAgICAgICBjb25zdCBhdmVyYWdlID0gYXdhaXQgcmF0aW5nUmVwb3NpdG9yeS5nZXRBdmVyYWdlUmF0aW5nKHZpZGVvSWQsIHRhZ0lkKVxuICAgICAgICAgIGF2ZXJhZ2VzID0gbmV3IE1hcChbW3RhZ0lkLCBhdmVyYWdlXV0pXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gR2V0IGF2ZXJhZ2VzIGZvciBhbGwgdGFncyBmb3IgdGhpcyB2aWRlb1xuICAgICAgICAgIGNvbnN0IHJhdGluZ3MgPSBhd2FpdCByYXRpbmdSZXBvc2l0b3J5LmZpbmRCeVZpZGVvSWQodmlkZW9JZClcbiAgICAgICAgICBjb25zdCB0YWdBdmVyYWdlcyA9IG5ldyBNYXA8c3RyaW5nLCB7IHN1bTogbnVtYmVyOyBjb3VudDogbnVtYmVyIH0+KClcbiAgICAgICAgICBcbiAgICAgICAgICByYXRpbmdzLmZvckVhY2gocmF0aW5nID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRhZyA9IHJhdGluZy50YWcubmFtZVxuICAgICAgICAgICAgaWYgKCF0YWdBdmVyYWdlcy5oYXModGFnKSkge1xuICAgICAgICAgICAgICB0YWdBdmVyYWdlcy5zZXQodGFnLCB7IHN1bTogMCwgY291bnQ6IDAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0YWdBdmVyYWdlcy5nZXQodGFnKSFcbiAgICAgICAgICAgIGN1cnJlbnQuc3VtICs9IHJhdGluZy5sZXZlbFxuICAgICAgICAgICAgY3VycmVudC5jb3VudCArPSAxXG4gICAgICAgICAgfSlcbiAgICAgICAgICBcbiAgICAgICAgICBhdmVyYWdlcyA9IG5ldyBNYXAoKVxuICAgICAgICAgIHRhZ0F2ZXJhZ2VzLmZvckVhY2goKHZhbHVlLCB0YWcpID0+IHtcbiAgICAgICAgICAgIGF2ZXJhZ2VzLnNldCh0YWcsIHZhbHVlLmNvdW50ID4gMCA/IHZhbHVlLnN1bSAvIHZhbHVlLmNvdW50IDogMClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgICAgIHRoaXMudmlkZW9BdmVyYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCB7XG4gICAgICAgICAgZGF0YTogYXZlcmFnZXMsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIHR0bDogdGhpcy5BVkVSQUdFX0NBQ0hFX1RUTFxuICAgICAgICB9KVxuICAgICAgICBcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdDYWNoZWQgdmlkZW8gYXZlcmFnZSByYXRpbmdzJywgeyB2aWRlb0lkLCB0YWdJZCwgY2FjaGVLZXksIHRhZ3NDb3VudDogYXZlcmFnZXMuc2l6ZSB9KVxuICAgICAgICByZXR1cm4gYXZlcmFnZXNcbiAgICAgICAgXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdmlkZW8gYXZlcmFnZSByYXRpbmdzJywgeyB2aWRlb0lkLCB0YWdJZCwgZXJyb3IgfSlcbiAgICAgICAgdGhyb3cgZXJyb3JcbiAgICAgIH1cbiAgICB9LCB7IHZpZGVvSWQsIHRhZ0lkLCBjYWNoZUtleTogYCR7dmlkZW9JZH06JHt0YWdJZCB8fCAnYWxsJ31gIH0pXG4gIH1cblxuICBhc3luYyBnZXRCdWxrVmlkZW9BdmVyYWdlUmF0aW5ncyh2aWRlb0lkczogc3RyaW5nW10sIHRhZ0lkPzogc3RyaW5nKTogUHJvbWlzZTxNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBudW1iZXI+Pj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXA8c3RyaW5nLCBNYXA8c3RyaW5nLCBudW1iZXI+PigpXG4gICAgY29uc3QgdW5jYWNoZWRWaWRlb0lkcyA9IFtdXG4gICAgXG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBmb3IgKGNvbnN0IHZpZGVvSWQgb2YgdmlkZW9JZHMpIHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7dmlkZW9JZH06JHt0YWdJZCB8fCAnYWxsJ31gXG4gICAgICBjb25zdCBjYWNoZWQgPSB0aGlzLnZpZGVvQXZlcmFnZUNhY2hlLmdldChjYWNoZUtleSlcbiAgICAgIFxuICAgICAgaWYgKGNhY2hlZCAmJiAhdGhpcy5pc0V4cGlyZWQoY2FjaGVkKSkge1xuICAgICAgICByZXN1bHQuc2V0KHZpZGVvSWQsIGNhY2hlZC5kYXRhKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdW5jYWNoZWRWaWRlb0lkcy5wdXNoKHZpZGVvSWQpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEZldGNoIHVuY2FjaGVkIGRhdGEgaW4gYnVsa1xuICAgIGlmICh1bmNhY2hlZFZpZGVvSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGJ1bGtBdmVyYWdlcyA9IGF3YWl0IHJhdGluZ1JlcG9zaXRvcnkuZ2V0QXZlcmFnZVJhdGluZ3NCeVZpZGVvSWRzKHVuY2FjaGVkVmlkZW9JZHMsIHRhZ0lkKVxuICAgICAgICBcbiAgICAgICAgLy8gUHJvY2VzcyBhbmQgY2FjaGUgdGhlIHJlc3VsdHNcbiAgICAgICAgZm9yIChjb25zdCB2aWRlb0lkIG9mIHVuY2FjaGVkVmlkZW9JZHMpIHtcbiAgICAgICAgICBjb25zdCBhdmVyYWdlID0gYnVsa0F2ZXJhZ2VzLmdldCh2aWRlb0lkKSB8fCAwXG4gICAgICAgICAgY29uc3QgYXZlcmFnZU1hcCA9IHRhZ0lkID8gbmV3IE1hcChbW3RhZ0lkLCBhdmVyYWdlXV0pIDogbmV3IE1hcChbWydvdmVyYWxsJywgYXZlcmFnZV1dKVxuICAgICAgICAgIFxuICAgICAgICAgIHJlc3VsdC5zZXQodmlkZW9JZCwgYXZlcmFnZU1hcClcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgICAgICAgY29uc3QgY2FjaGVLZXkgPSBgJHt2aWRlb0lkfToke3RhZ0lkIHx8ICdhbGwnfWBcbiAgICAgICAgICB0aGlzLnZpZGVvQXZlcmFnZUNhY2hlLnNldChjYWNoZUtleSwge1xuICAgICAgICAgICAgZGF0YTogYXZlcmFnZU1hcCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgIHR0bDogdGhpcy5BVkVSQUdFX0NBQ0hFX1RUTFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQnVsayBjYWNoZWQgdmlkZW8gYXZlcmFnZSByYXRpbmdzJywgeyBcbiAgICAgICAgICB2aWRlb0lkczogdW5jYWNoZWRWaWRlb0lkcy5sZW5ndGgsIFxuICAgICAgICAgIHRhZ0lkLFxuICAgICAgICAgIGNhY2hlSGl0czogdmlkZW9JZHMubGVuZ3RoIC0gdW5jYWNoZWRWaWRlb0lkcy5sZW5ndGgsXG4gICAgICAgICAgY2FjaGVNaXNzZXM6IHVuY2FjaGVkVmlkZW9JZHMubGVuZ3RoXG4gICAgICAgIH0pXG4gICAgICAgIFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIGJ1bGsgdmlkZW8gYXZlcmFnZSByYXRpbmdzJywgeyB2aWRlb0lkczogdW5jYWNoZWRWaWRlb0lkcy5sZW5ndGgsIHRhZ0lkLCBlcnJvciB9KVxuICAgICAgICB0aHJvdyBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVzdWx0XG4gIH1cblxuICBhc3luYyBnZXRVc2VyUmF0aW5nRm9yVmlkZW8odXNlcklkOiBzdHJpbmcsIHZpZGVvSWQ6IHN0cmluZywgdGFnSWQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyIHwgbnVsbD4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYCR7dXNlcklkfToke3ZpZGVvSWR9YFxuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMudXNlclJhdGluZ0NhY2hlLmdldChjYWNoZUtleSlcbiAgICBcbiAgICBpZiAoY2FjaGVkICYmICF0aGlzLmlzRXhwaXJlZChjYWNoZWQpKSB7XG4gICAgICByZXR1cm4gY2FjaGVkLmRhdGEuZ2V0KHRhZ0lkKSB8fCBudWxsXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJhdGluZ3MgPSBhd2FpdCByYXRpbmdSZXBvc2l0b3J5LmZpbmRCeVVzZXJBbmRWaWRlbyh1c2VySWQsIHZpZGVvSWQpXG4gICAgICBjb25zdCB1c2VyUmF0aW5ncyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KClcbiAgICAgIFxuICAgICAgcmF0aW5ncy5mb3JFYWNoKHJhdGluZyA9PiB7XG4gICAgICAgIHVzZXJSYXRpbmdzLnNldChyYXRpbmcudGFnSWQsIHJhdGluZy5sZXZlbClcbiAgICAgIH0pXG4gICAgICBcbiAgICAgIC8vIENhY2hlIHRoZSByZXN1bHRcbiAgICAgIHRoaXMudXNlclJhdGluZ0NhY2hlLnNldChjYWNoZUtleSwge1xuICAgICAgICBkYXRhOiB1c2VyUmF0aW5ncyxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB0dGw6IHRoaXMuVVNFUl9SQVRJTkdfQ0FDSEVfVFRMXG4gICAgICB9KVxuICAgICAgXG4gICAgICByZXR1cm4gdXNlclJhdGluZ3MuZ2V0KHRhZ0lkKSB8fCBudWxsXG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHVzZXIgcmF0aW5nIGZvciB2aWRlbycsIHsgdXNlcklkLCB2aWRlb0lkLCB0YWdJZCwgZXJyb3IgfSlcbiAgICAgIHRocm93IGVycm9yXG4gICAgfVxuICB9XG5cbiAgaW52YWxpZGF0ZVZpZGVvQ2FjaGUodmlkZW9JZDogc3RyaW5nKSB7XG4gICAgY29uc3Qga2V5c1RvRGVsZXRlID0gW11cbiAgICBcbiAgICAvLyBGaW5kIGFsbCBjYWNoZSBrZXlzIHJlbGF0ZWQgdG8gdGhpcyB2aWRlb1xuICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcy52aWRlb0F2ZXJhZ2VDYWNoZS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChrZXkuc3RhcnRzV2l0aChgJHt2aWRlb0lkfTpgKSkge1xuICAgICAgICBrZXlzVG9EZWxldGUucHVzaChrZXkpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcy52aWRlb0FnZ3JlZ2F0ZUNhY2hlLmVudHJpZXMoKSkge1xuICAgICAgaWYgKGtleSA9PT0gdmlkZW9JZCkge1xuICAgICAgICBrZXlzVG9EZWxldGUucHVzaChrZXkpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIERlbGV0ZSB0aGUga2V5c1xuICAgIGtleXNUb0RlbGV0ZS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0aGlzLnZpZGVvQXZlcmFnZUNhY2hlLmRlbGV0ZShrZXkpXG4gICAgICB0aGlzLnZpZGVvQWdncmVnYXRlQ2FjaGUuZGVsZXRlKGtleSlcbiAgICB9KVxuICAgIFxuICAgIGxvZ2dlci5kZWJ1ZygnSW52YWxpZGF0ZWQgdmlkZW8gY2FjaGUnLCB7IHZpZGVvSWQsIGtleXNJbnZhbGlkYXRlZDoga2V5c1RvRGVsZXRlLmxlbmd0aCB9KVxuICB9XG5cbiAgaW52YWxpZGF0ZVVzZXJDYWNoZSh1c2VySWQ6IHN0cmluZykge1xuICAgIGNvbnN0IGtleXNUb0RlbGV0ZSA9IFtdXG4gICAgXG4gICAgLy8gRmluZCBhbGwgY2FjaGUga2V5cyByZWxhdGVkIHRvIHRoaXMgdXNlclxuICAgIGZvciAoY29uc3QgW2tleV0gb2YgdGhpcy51c2VyUmF0aW5nQ2FjaGUuZW50cmllcygpKSB7XG4gICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgoYCR7dXNlcklkfTpgKSkge1xuICAgICAgICBrZXlzVG9EZWxldGUucHVzaChrZXkpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIERlbGV0ZSB0aGUga2V5c1xuICAgIGtleXNUb0RlbGV0ZS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0aGlzLnVzZXJSYXRpbmdDYWNoZS5kZWxldGUoa2V5KVxuICAgIH0pXG4gICAgXG4gICAgbG9nZ2VyLmRlYnVnKCdJbnZhbGlkYXRlZCB1c2VyIGNhY2hlJywgeyB1c2VySWQsIGtleXNJbnZhbGlkYXRlZDoga2V5c1RvRGVsZXRlLmxlbmd0aCB9KVxuICB9XG5cbiAgLy8gTWV0aG9kIHRvIG1hbnVhbGx5IHRyaWdnZXIgY2FjaGUgY2xlYW51cFxuICBjbGVhbnVwKCkge1xuICAgIHRoaXMuY2xlYW51cEV4cGlyZWRFbnRyaWVzKClcbiAgICBsb2dnZXIuZGVidWcoJ1JhdGluZyBjYWNoZSBjbGVhbnVwIGNvbXBsZXRlZCcsIHtcbiAgICAgIHZpZGVvQXZlcmFnZUVudHJpZXM6IHRoaXMudmlkZW9BdmVyYWdlQ2FjaGUuc2l6ZSxcbiAgICAgIHZpZGVvQWdncmVnYXRlRW50cmllczogdGhpcy52aWRlb0FnZ3JlZ2F0ZUNhY2hlLnNpemUsXG4gICAgICB1c2VyUmF0aW5nRW50cmllczogdGhpcy51c2VyUmF0aW5nQ2FjaGUuc2l6ZVxuICAgIH0pXG4gIH1cblxuICAvLyBHZXQgY2FjaGUgc3RhdGlzdGljc1xuICBnZXRTdGF0cygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdmlkZW9BdmVyYWdlQ2FjaGU6IHtcbiAgICAgICAgc2l6ZTogdGhpcy52aWRlb0F2ZXJhZ2VDYWNoZS5zaXplLFxuICAgICAgICB0dGw6IHRoaXMuQVZFUkFHRV9DQUNIRV9UVExcbiAgICAgIH0sXG4gICAgICB2aWRlb0FnZ3JlZ2F0ZUNhY2hlOiB7XG4gICAgICAgIHNpemU6IHRoaXMudmlkZW9BZ2dyZWdhdGVDYWNoZS5zaXplLFxuICAgICAgICB0dGw6IHRoaXMuQUdHUkVHQVRFX0NBQ0hFX1RUTFxuICAgICAgfSxcbiAgICAgIHVzZXJSYXRpbmdDYWNoZToge1xuICAgICAgICBzaXplOiB0aGlzLnVzZXJSYXRpbmdDYWNoZS5zaXplLFxuICAgICAgICB0dGw6IHRoaXMuVVNFUl9SQVRJTkdfQ0FDSEVfVFRMXG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCByYXRpbmdDYWNoZVNlcnZpY2UgPSBuZXcgUmF0aW5nQ2FjaGVTZXJ2aWNlKClcblxuLy8gU2V0dXAgcGVyaW9kaWMgY2xlYW51cFxuaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7IC8vIE9ubHkgcnVuIG9uIHNlcnZlclxuICBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgcmF0aW5nQ2FjaGVTZXJ2aWNlLmNsZWFudXAoKVxuICB9LCA1ICogNjAgKiAxMDAwKSAvLyBDbGVhbnVwIGV2ZXJ5IDUgbWludXRlc1xufSJdLCJuYW1lcyI6WyJyYXRpbmdSZXBvc2l0b3J5IiwibG9nZ2VyIiwidGltZVJhdGluZ09wZXJhdGlvbiIsIlJhdGluZ0NhY2hlU2VydmljZSIsImlzRXhwaXJlZCIsImVudHJ5IiwiRGF0ZSIsIm5vdyIsInRpbWVzdGFtcCIsInR0bCIsImNsZWFudXBFeHBpcmVkRW50cmllcyIsImtleSIsInZpZGVvQXZlcmFnZUNhY2hlIiwiZW50cmllcyIsImRlbGV0ZSIsInZpZGVvQWdncmVnYXRlQ2FjaGUiLCJ1c2VyUmF0aW5nQ2FjaGUiLCJnZXRWaWRlb0F2ZXJhZ2VSYXRpbmdzIiwidmlkZW9JZCIsInRhZ0lkIiwiY2FjaGVLZXkiLCJjYWNoZWQiLCJnZXQiLCJkZWJ1ZyIsImRhdGEiLCJhdmVyYWdlcyIsImF2ZXJhZ2UiLCJnZXRBdmVyYWdlUmF0aW5nIiwiTWFwIiwicmF0aW5ncyIsImZpbmRCeVZpZGVvSWQiLCJ0YWdBdmVyYWdlcyIsImZvckVhY2giLCJyYXRpbmciLCJ0YWciLCJuYW1lIiwiaGFzIiwic2V0Iiwic3VtIiwiY291bnQiLCJjdXJyZW50IiwibGV2ZWwiLCJ2YWx1ZSIsIkFWRVJBR0VfQ0FDSEVfVFRMIiwidGFnc0NvdW50Iiwic2l6ZSIsImVycm9yIiwiZ2V0QnVsa1ZpZGVvQXZlcmFnZVJhdGluZ3MiLCJ2aWRlb0lkcyIsInJlc3VsdCIsInVuY2FjaGVkVmlkZW9JZHMiLCJwdXNoIiwibGVuZ3RoIiwiYnVsa0F2ZXJhZ2VzIiwiZ2V0QXZlcmFnZVJhdGluZ3NCeVZpZGVvSWRzIiwiYXZlcmFnZU1hcCIsImNhY2hlSGl0cyIsImNhY2hlTWlzc2VzIiwiZ2V0VXNlclJhdGluZ0ZvclZpZGVvIiwidXNlcklkIiwiZmluZEJ5VXNlckFuZFZpZGVvIiwidXNlclJhdGluZ3MiLCJVU0VSX1JBVElOR19DQUNIRV9UVEwiLCJpbnZhbGlkYXRlVmlkZW9DYWNoZSIsImtleXNUb0RlbGV0ZSIsInN0YXJ0c1dpdGgiLCJrZXlzSW52YWxpZGF0ZWQiLCJpbnZhbGlkYXRlVXNlckNhY2hlIiwiY2xlYW51cCIsInZpZGVvQXZlcmFnZUVudHJpZXMiLCJ2aWRlb0FnZ3JlZ2F0ZUVudHJpZXMiLCJ1c2VyUmF0aW5nRW50cmllcyIsImdldFN0YXRzIiwiQUdHUkVHQVRFX0NBQ0hFX1RUTCIsInJhdGluZ0NhY2hlU2VydmljZSIsInNldEludGVydmFsIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/services/rating-cache.service.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fratings%2Fflush&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fratings%2Fflush.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();